<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SuperNOVAS: SuperNOVAS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="smithsonian-logo-55x55.png"/></td>
  <td id="projectalign">
   <div id="projectname">SuperNOVAS<span id="projectnumber">&#160;v1.5</span>
   </div>
   <div id="projectbrief">The NOVAS C library, made better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SuperNOVAS </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <img src="CfA-logo.png" alt="CfA logo" width="400" height="67" align="right" class="inline"/> <br  clear="all" />
</p>
<h1><a class="anchor" id="autotoc_md68"></a>
User's guide</h1>
<p><a href="https://doi.org/10.5281/zenodo.14584983"><img src="748170057.svg" alt="Zenodo DOI badge" align="left" style="pointer-events: none;" class="inline"/> </a> <br  clear="all" />
</p>
<p>The NOVAS C astrometry library, made better.</p>
<ul>
<li><a href="https://smithsonian.github.io/SuperNOVAS/doc/html/files.html">API documentation</a></li>
<li><a href="https://smithsonian.github.io/SuperNOVAS">SuperNOVAS pages</a> on github.io</li>
</ul>
<p><a href="https://github.com/Smithsonian/SuperNOVAS/">SuperNOVAS</a> is a C/C++ astronomy software library, providing high-precision astrometry such as one might need for running an observatory, a precise planetarium program, or for analyzing astronomical datasets. It started as a fork of the Naval Observatory Vector Astrometry Software (<a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a>) C version 3.1, but since then it has grown into its own, providing bug fixes, tons of new features, and a much improved API compared to the original NOVAS.</p>
<p><b>SuperNOVAS</b> is easy to use and it is very fast, providing 3&ndash;5 orders of magnitude faster position calculations than <a href="https://www.astropy.org/">astropy</a> 7.0.0 in a single thread (see the <a class="el" href="#benchmarks">benchmarks</a>), and its performance will scale with the number of CPUs when calculations are performed in parallel threads.</p>
<p><b>SuperNOVAS</b> is entirely free to use without licensing restrictions. Its source code is compatible with the C99 standard, and hence should be suitable for old and new platforms alike. And, despite it being a light-weight library, it fully supports the IAU 2000/2006 standards for microarcsecond-level position calculations.</p>
<p>This document has been updated for the <code>v1.5</code> and later releases.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Table of Contents</h2>
<ul>
<li><a class="el" href="#introduction">Introduction</a></li>
<li><a class="el" href="#fixed-issues">Fixed NOVAS C 3.1 issues</a></li>
<li><a class="el" href="#compatibility">Compatibility with NOVAS C 3.1</a></li>
<li><a class="el" href="#installation">Building and installation</a></li>
<li><a class="el" href="#integration">Building your application with SuperNOVAS</a></li>
<li><a class="el" href="#methodologies">Celestial coordinate systems (old vs. new)</a></li>
<li><a class="el" href="#examples">Example usage</a></li>
<li><a class="el" href="#solarsystem">Incorporating Solar-system ephemeris data or services</a></li>
<li><a class="el" href="#precision">Notes on precision</a></li>
<li><a class="el" href="#tips">Tips and tricks</a></li>
<li><a class="el" href="#debug-support">Runtime debug support</a></li>
<li><a class="el" href="#benchmarks">Representative benchmarks</a></li>
<li><a class="el" href="#supernovas-features">SuperNOVAS added features</a></li>
<li><a class="el" href="#release-schedule">Release schedule</a></li>
</ul>
<hr  />
<p><a class="anchor" id="introduction"></a> </p>
<h2><a class="anchor" id="autotoc_md71"></a>
Introduction</h2>
<p><b>SuperNOVAS</b> is a fork of the The Naval Observatory Vector Astrometry Software (<a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a>). (It is not related to the separate NOVA / libnova library.)</p>
<p>The primary goal of <b>SuperNOVAS</b> is to improve on the original NOVAS C library via:</p>
<ul>
<li>Fixing <a class="el" href="#fixed-issues">outstanding issues</a>.</li>
<li>Improved <a href="https://smithsonian.github.io/SuperNOVAS/doc/html/files.html">API documentation</a>.</li>
<li><a class="el" href="#benchmarks">Faster calculations</a>.</li>
<li><a class="el" href="#added-functionality">New features</a>.</li>
<li><a class="el" href="#api-changes">Refining the API</a> to promote best programming practices.</li>
<li><a class="el" href="#multi-threading">Thread-safe calculations</a>.</li>
<li><a class="el" href="#debug-support">Debug mode</a> with informative error tracing.</li>
<li><a href="https://codecov.io/gh/Smithsonian/SuperNOVAS">Regression testing</a> and continuous integration on GitHub.</li>
</ul>
<p>At the same time, <b>SuperNOVAS</b> aims to be fully backward compatible with the intended functionality of the upstream NOVAS C library, such that it can be used as a <em>build-time</em> replacement for NOVAS in your application without having to change existing (functional) code you may have written for NOVAS C.</p>
<p><b>SuperNOVAS</b> is really quite easy to use. Its new API is just as simple and intuitive as that of <b>astropy</b> (or so we strive for it to be), and it is similarly well documented also (see the <a href="https://smithsonian.github.io/SuperNOVAS/doc/html/files.html">API documentation</a>). You can typically achieve the same results with <a href="https://github.com/Smithsonian/SuperNOVAS/blob/main/doc/SuperNOVAS_vs_astropy.md">similar lines of code</a> with <b>SuperNOVAS</b> as with <b>astropy</b>, notwithstanding a little more involved error handling at every step (due to the lack of <code>try / except</code> style constructs in C).</p>
<p><b>SuperNOVAS</b> is currently based on NOVAS C version 3.1. We plan to rebase <b>SuperNOVAS</b> to the latest upstream release of the NOVAS C library, if new releases become available.</p>
<p><b>SuperNOVAS</b> is maintained by <a href="https://github.com/attipaci">Attila Kov√°cs</a> at the Center for Astrophysics | Harvard &amp; Smithsonian, and it is available through the <a href="https://github.com/Smithsonian/SuperNOVAS">Smithsonian/SuperNOVAS</a> repository on GitHub.</p>
<p>Outside contributions are very welcome. See <a href="https://smithsonian.github.io/SuperNOVAS/doc/CONTRIBUTING.html">how you can contribute</a> on how you can make <b>SuperNOVAS</b> even better.</p>
<h3><a class="anchor" id="autotoc_md72"></a>
Related links</h3>
<ul>
<li><a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a> home page at the US Naval Observatory.</li>
<li><a href="https://calceph.imcce.fr">CALCEPH C library</a> for integrating Solar-system ephemerides from JPL and/or in INPOP 2.0/3.0 format.</li>
<li><a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF SPICE toolkit</a> for integrating Solar-system ephemerides from JPL.</li>
<li><a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> for building CSPICE as a shared library for dynamic linking.</li>
<li><a href="https://www.minorplanetcenter.net/iau/mpc.html">IAU Minor Planet Center</a> provides up-to-date orbital elements for asteroids, comets, and near-Earth objects (NEOs), including newly discovered objects.</li>
</ul>
<hr  />
<p><a class="anchor" id="fixed-issues"></a> </p>
<h2><a class="anchor" id="autotoc_md74"></a>
Fixed NOVAS C 3.1 issues</h2>
<p><b>SuperNOVAS</b> fixes a number of outstanding issues with NOVAS C 3.1:</p>
<details >
<summary >
Details</summary>
<p></p>
<ul>
<li>Fixes the <a href="https://aa.usno.navy.mil/software/novas_faq">sidereal_time bug</a>, whereby the <code><a class="el" href="earth_8c.html#a6eacba14d3c382d67307856a2ea290e3">sidereal_time()</a></code> function had an incorrect unit cast. This was a documented issue of NOVAS C 3.1.</li>
<li>Fixes the <a href="https://aa.usno.navy.mil/software/novas_faq">ephem_close bug</a>, whereby <code>ephem_close()</code> in <code>eph_manager.c</code> did not reset the <code>EPHFILE</code> pointer to NULL. This was a documented issue of NOVAS C 3.1.</li>
<li>Fixes antedating velocities and distances for light travel time in <code><a class="el" href="group__geometric.html#ga713982e1f2bae0a72b39d03007f00d23" title="Retrieves the position and velocity of a solar system body using the currently configured plugins tha...">ephemeris()</a></code>. When getting positions and velocities for Solar-system sources, it is important to use the values from the time light originated from the observed body rather than at the time that light arrives to the observer. This correction was done properly for positions, but not for velocities or distances, resulting in incorrect observed radial velocities or apparent distances being reported for spectroscopic observations or for angular-physical size conversions.</li>
<li>Fixes bug in <code><a class="el" href="group__equatorial.html#gaea0e1028baf14d16d9de800e36a17086" title="Compute the intermediate right ascension of the equinox at the input Julian date, using an analytical...">ira_equinox()</a></code> which may return the result for the wrong type of equinox (mean vs. true) if the <code>equinox</code> argument was changing from 1 to 0, and back to 1 again with the date being held the same. This affected routines downstream also, such as <code><a class="el" href="earth_8c.html#a6eacba14d3c382d67307856a2ea290e3">sidereal_time()</a></code>.</li>
<li>Fixes accuracy switching bug in <code><a class="el" href="cio_8c.html#a51bfbe9b491f50851326b2522dc2a29f">cio_basis()</a></code>, <code><a class="el" href="cio_8c.html#a65ffaaa2b527ed03149eadc7568f3714">cio_location()</a></code>, <code><a class="el" href="group__nonequatorial.html#ga41ca0cfd79ad07c9e857ba02fa94928e" title="Convert ecliptic longitude and latitude to right ascension and declination.">ecl2equ()</a></code>, <code><a class="el" href="group__nonequatorial.html#gaa05ecc76c1ccc0c3445f8b642d6c5311" title="Converts an equatorial position vector to an ecliptic position vector.">equ2ecl_vec()</a></code>, <code><a class="el" href="group__nonequatorial.html#ga6fa1eada41005ac70290d0bb5df1ec26" title="Converts an ecliptic position vector to an equatorial position vector.">ecl2equ_vec()</a></code>, <code><a class="el" href="group__geometric.html#gada5ca37110e66c8b65f623c9e26ae52e" title="Computes the geocentric GCRS position and velocity of an observer.">geo_posvel()</a></code>, <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, and <code><a class="el" href="earth_8c.html#a6eacba14d3c382d67307856a2ea290e3">sidereal_time()</a></code>. All these functions returned a cached value for the other accuracy if the other input parameters are the same as a prior call, except the accuracy.</li>
<li>Fixes multiple bugs related to using cached values in <code><a class="el" href="cio_8c.html#a51bfbe9b491f50851326b2522dc2a29f">cio_basis()</a></code> with alternating CIO location reference systems. This affected many CIRS-based position calculations downstream.</li>
<li>Fixes bug in <code><a class="el" href="group__nonequatorial.html#gaa05ecc76c1ccc0c3445f8b642d6c5311" title="Converts an equatorial position vector to an ecliptic position vector.">equ2ecl_vec()</a></code> and <code><a class="el" href="group__nonequatorial.html#ga6fa1eada41005ac70290d0bb5df1ec26" title="Converts an ecliptic position vector to an equatorial position vector.">ecl2equ_vec()</a></code> whereby a query with <code>coord_sys = 2</code> (GCRS) has overwritten the cached mean obliquity value for <code>coord_sys = 0</code> (mean equinox of date). As a result, a subsequent call with <code>coord_sys = 0</code> and the same date as before would return the results in GCRS coordinates instead of the requested mean equinox of date coordinates.</li>
<li>Some remainder calculations in NOVAS C 3.1 used the result from <code>fmod()</code> unchecked, which resulted in angles outside of the expected [0:2&pi;] range and was also the reason why <code><a class="el" href="group__time.html#ga044f1359abcf0a039ac6452a95729b5a" title="This function will compute a broken down date on the astronomical calendar given the Julian day input...">cal_date()</a></code> did not work for negative JD values.</li>
<li>Fixes <code><a class="el" href="observer_8c.html#a033f1bf4b01e0e21a0e05e13c19c02f6" title="Corrects position vector for aberration of light.">aberration()</a></code> returning NaN vectors if the <code>ve</code> argument is 0. It now returns the unmodified input vector appropriately instead.</li>
<li>Fixes unpopulated <code>az</code> output value in <code><a class="el" href="system_8c.html#ad932a8617973ef06e4a5c955b7897bb0">equ2hor()</a></code> at zenith. While any azimuth is acceptable really, it results in unpredictable behavior. Hence, we set <code>az</code> to 0.0 for zenith to be consistent.</li>
<li>Fixes potential string overflows and eliminates associated compiler warnings.</li>
<li>Nutation series used truncated expressions for the fundamental arguments, resulting in &mu;as-level errors in when dozens or more years away from the reference epoch of J2000.</li>
<li>[<b>v1.1</b>] Fixes division by zero bug in <code><a class="el" href="util_8c.html#ad799864f637c483fb49491bde5a93e25" title="Returns the difference in light-time, for a star, between the barycenter of the solar system and the ...">d_light()</a></code> if the first position argument is the ephemeris reference position (e.g. the Sun for <code><a class="el" href="solsys3_8c.html" title="Planet calculator functions for the Earth and Sun only, with an orbital model fitted to the DE405 eph...">solsys3.c</a></code>). The bug affects for example <code><a class="el" href="grav_8c.html#a48f90ac20950507fad9b880a7f7f2383" title="(primarily for internal use) Computes the total gravitational deflection of light for the observed ob...">grav_def()</a></code>, where it effectively results in the gravitational deflection due to the Sun being skipped.</li>
<li>[<b>v1.1</b>] The NOVAS C 3.1 implementation of <code><a class="el" href="group__spectral.html#gafca24d914664bb60d20fb428177f329a" title="Predicts the radial velocity of the observed object as it would be measured by spectroscopic means.">rad_vel()</a></code> has a number of issues that produce inaccurate results. The errors are typically at or below the tens of m/s level for objects not moving at relativistic speeds.</li>
<li>[<b>v1.4</b>] The NOVAS C 3.1 implementation of <code><a class="el" href="transform_8c.html#a6217852bfd7d3a58d3266d0daadfc6bc">cel2ter()</a></code> / <code><a class="el" href="transform_8c.html#ac8c5ff3cc13126aba2ec5a6cbe187a31">ter2cel()</a></code> was such that if both <code>xp</code> and <code>yp</code> parameters were zero, then no wobble correction was applied, not even for the TIO longitude (s'). The error from this omission is very small, at just a few &mu;as (microarcseconds) within a couple of centuries of J2000.</li>
</ul>
<p></p>
</details>
<hr  />
<p><a class="anchor" id="compatibility"></a> </p>
<h2><a class="anchor" id="autotoc_md76"></a>
Compatibility with NOVAS C 3.1</h2>
<p><b>SuperNOVAS</b> strives to maintain API compatibility with the upstream NOVAS C 3.1 library, but not binary (ABI) compatibility.</p>
<p>If you have code that was written for NOVAS C 3.1, it should work with <b>SuperNOVAS</b> as is, without modifications. Simply (re)build your application against <b>SuperNOVAS</b>, and you are good to go.</p>
<p>The lack of binary compatibility just means that you cannot drop-in replace the libraries (e.g. the static <code>libnovas.a</code>, or the shared <code>libnovas.so</code>), from NOVAS C 3.1 with those from <b>SuperNOVAS</b>. Instead, you will have to build (compile) your application referencing the <b>SuperNOVAS</b> headers and/or libraries from the start.</p>
<p>This is because some function signatures have changed, e.g. to use an <code>enum</code> argument instead of the nondescript <code>short int</code> option arguments used in NOVAS C 3.1, or because we added a return value to a function that was declared <code>void</code> in NOVAS C 3.1. We also changed the <code>object</code> structure to contain a <code>long</code> ID number instead of <code>short</code> to accommodate JPL NAIF codes, for which 16-bit storage is insufficient.</p>
<hr  />
<p><a class="anchor" id="installation"></a> </p>
<h2><a class="anchor" id="autotoc_md78"></a>
Building and installation</h2>
<ul>
<li><a class="el" href="#gnu-build">Build SuperNOVAS using GNU make</a></li>
<li><a class="el" href="#cmake-build">Build SuperNOVAS using CMake</a></li>
<li><a class="el" href="#vcpkg-port">Install SuperNOVAS via `vcpkg`</a></li>
<li><a class="el" href="#linux-packages">Linux packages</a></li>
<li><a class="el" href="#homebrew">Homebrew package</a></li>
</ul>
<p><a class="anchor" id="gnu-build"></a> </p>
<h3><a class="anchor" id="autotoc_md79"></a>
Build SuperNOVAS using GNU make</h3>
<p>The <b>SuperNOVAS</b> distribution contains a GNU <code>Makefile</code>, which is suitable for compiling the library (as well as local documentation, and tests, etc.) on POSIX systems such as Linux, Mac OS X, BSD, Cygwin or WSL &ndash; using <a href="https://www.gnu.org/software/make/">GNU <code>make</code></a>.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>Before compiling the library take a look a <code>config.mk</code> and edit it as necessary for your needs, or else define the necessary variables in the shell prior to invoking <code>make</code>. For example:</p>
<ul>
<li><a href="https://www.imcce.fr/recherche/equipes/asd/calceph/">CALCEPH</a> C library integration is automatic on Linux if <code>ldconfig</code> can locate the <code>libcalceph</code> shared library. You can also control CALCEPH integration manually, e.g. by setting <code>CALCEPH_SUPPORT = 1</code> in <code>config.mk</code> or in the shell prior to the build. CALCEPH integration will require an accessible installation of the CALCEPH development files (C headers and unversioned static or shared libraries depending on the needs of the build).</li>
<li><a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF CSPICE Toolkit</a> integration is automatic on Linux if <code>ldconfig</code> can locate the <code>libcspice</code> shared library. You can also control CSPICE integration manually, e.g. by setting <code>CSPICE_SUPPORT = 1</code> in <code>config.mk</code> or in the shell prior to the build. CSPICE integration will require an accessible installation of the CSPICE development files (C headers, under a <code>cspice/</code> subfolder in the header search path, and unversioned static or shared libraries depending on the needs of the build). You might want to check out the <a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> repository for building CSPICE as a shared library.</li>
<li>If your compiler does not support the C11 standard and it is not GCC &gt;=3.3, but provides some nonstandard support for declaring thread-local variables, you may want to pass the keyword to use to declare variables as thread local via <code>-DTHREAD_LOCAL=...</code> added to <code>CFLAGS</code>. (Don't forget to enclose the string value in escaped quotes in <code>config.mk</code>, or unescaped if defining the <code>THREAD_LOCAL</code> shell variable prior to invoking <code>make</code>.)</li>
</ul>
<p>Additionally, you may set number of environment variables to futher customize the build, such as:</p>
<ul>
<li><code>CC</code>: The C compiler to use (default: <code>gcc</code>).</li>
<li><code>CPPFLAGS</code>: C preprocessor flags, such as externally defined compiler constants.</li>
<li><code>CFLAGS</code>: Flags to pass onto the C compiler (default: <code>-g -Os -Wall</code>). Note, <code>-Iinclude</code> will be added automatically.</li>
<li><code>LDFLAGS</code>: Extra linker flags (default is <em>not set</em>). Note, <code>-lm</code> will be added automatically.</li>
<li><code>CSTANDARD</code>: Optionally, specify the C standard to compile for, e.g. <code>c99</code> to compile for the C99 standard. If defined then <code>-std=$(CSTANDARD)</code> is added to <code>CFLAGS</code> automatically.</li>
<li><code>WEXTRA</code>: If set to 1, <code>-Wextra</code> is added to <code>CFLAGS</code> automatically.</li>
<li><code>FORTIFY</code>: If set it will set the <code>_FORTIFY_SOURCE</code> macro to the specified value (<code>gcc</code> supports values 1 through 3). It affords varying levels of extra compile time / runtime checks.</li>
<li><code>CHECKEXTRA</code>: Extra options to pass to <code>cppcheck</code> for the <code>make check</code> target</li>
<li><code>DOXYGEN</code>: Specify the <code>doxygen</code> executable to use for generating documentation. If not set (default), <code>make</code> will use <code>doxygen</code> in your <code>PATH</code> (if any). You can also set it to <code>none</code> to disable document generation and the checking for a usable <code>doxygen</code> version entirely.</li>
</ul>
<p>Now you are ready to build the library:</p>
<div class="fragment"><div class="line">$ make</div>
</div><!-- fragment --><p>will compile the shared (e.g. <code>lib/libsupernovas.so</code>) libraries, and compile the API documentation (into <code>doc/</code>) using <code>doxygen</code> (if available). Alternatively, you can build select components of the above with the <code>make</code> targets <code>shared</code>, and <code>local-dox</code> respectively. And, if unsure, you can always call <code>make help</code> to see what build targets are available.</p>
<p>To build <b>SuperNOVAS</b> as static libraries, use <code>make static</code>.</p>
<p>After building the library you can install the above components to the desired locations on your system. For a system-wide install you may simply run:</p>
<div class="fragment"><div class="line">$ sudo make install</div>
</div><!-- fragment --><p>Or, to install in some other locations, you may set a prefix and/or <code>DESTDIR</code>. For example, to install under <code>/opt</code> instead, you can:</p>
<div class="fragment"><div class="line">$ sudo make prefix=&quot;/opt&quot; install</div>
</div><!-- fragment --><p>Or, to stage the installation (to <code>/usr</code>) under a 'build root':</p>
<div class="fragment"><div class="line">$ make DESTDIR=&quot;/tmp/stage&quot; install</div>
</div><!-- fragment --><p></p>
</details>
<dl class="section remark"><dt>Remarks</dt><dd>On BSD, you will need to use <code>gmake</code> instead of <code>make</code>.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>if you want to build <b>SuperNOVAS</b> for with your old NOVAS C applications you might want to further customize the build. See Section(s) on <a class="el" href="#legacy-application">legacy application</a> further below.</dd></dl>
<p><a class="anchor" id="cmake-build"></a> </p>
<h3><a class="anchor" id="autotoc_md80"></a>
Build SuperNOVAS using CMake</h3>
<p>As of v1.5, <b>SuperNOVAS</b> can be built using <a href="https://cmake.org/">CMake</a> (many thanks to Kiran Shila). CMake allows for greater portability than the regular GNU <code>Makefile</code>. Note, however, that the CMake configuration does not support all of the build options of the GNU <code>Makefile</code>, such as automatic CALCEPH and CSPICE integration on Linux, supporting legacy NOVAS C style builds, and code coverage tracking.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>The basic build recipe for CMake is:</p>
<div class="fragment"><div class="line">$ cmake -B build</div>
<div class="line">$ cmake --build build</div>
</div><!-- fragment --><p>The <b>SuperNOVAS</b> CMake build supports the following options (in addition to the standard CMake options):</p>
<ul>
<li><code>BUILD_SHARED_LIBS=ON|OFF</code> (default: OFF) - Build shared libraries instead of static</li>
<li><code>BUILD_DOC=ON|OFF</code> (default: ON) - Compile HTML documentation. Requires <code>doxygen</code>.</li>
<li><code>BUILD_EXAMPLES=ON|OFF</code> (default: ON) - Build the included examples</li>
<li><code>BUILD_TESTING=ON|OFF</code> (default: ON - Build regression tests</li>
<li><code>BUILD_BENCHMARK=ON|OFF</code> (default: OFF - Build benchmarking programs</li>
<li><code>ENABLE_CALCEPH=ON|OFF</code> (default: OFF) - Optional CALCEPH ephemeris plugin support. Requires <code>calceph</code> package.</li>
<li><code>ENABLE_CSPICE=ON|OFF</code> (default: OFF) - Optional CSPICE ephemeris plugin support. Requires <code>cspice</code> library installed.</li>
</ul>
<p>For example, to build <b>SuperNOVAS</b> as shared libraries with <a href="https://calceph.imcce.fr">CALCEPH</a> integration for ephemeris support:</p>
<div class="fragment"><div class="line">$ cmake -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DENABLE_CALCEPH=ON</div>
<div class="line">$ cmake --build build</div>
</div><!-- fragment --><p>If a <code>CMAKE_BUILD_TYPE</code> is not set, the build will only use the <code>CFLAGS</code> (if any) that were set in the environment. This is ideal for those who want to have full control of the compiler flags used in the build. Specifying <code>Release</code> or <code>Debug</code> will append a particular set of appropriate compiler options which are suited for the given build type. (If you want to use the MinGW compiler on Windows, you'll want to set <code>-DCMAKE_C_COMPILER=gcc -G "MinGW Makefiles"</code> options also.)</p>
<p>After a successful build, you can install the <code>Runtime</code> (libraries), and <code>Development</code> (headers, CMake config, and <code>pkg-config</code>) components, e.g. under <code>/usr/local</code>, as:</p>
<div class="fragment"><div class="line">$ cmake --build build</div>
</div><!-- fragment --><p>Or, on Windows (Microsoft Visual C) you will want:</p>
<div class="fragment"><div class="line">$ cmake --build build --config Release</div>
</div><!-- fragment --><p>After the build, you can install the <b>SuperNOVAS</b> files in the location of choice (e.g. <code>/usr/local</code>):</p>
<div class="fragment"><div class="line">$ cmake --install build --prefix /usr/local </div>
</div><!-- fragment --><p>You can also use the <code>--component</code> option to install just the selected components. For example to install just the <code>Runtime</code> component:</p>
<div class="fragment"><div class="line">$ cmake --install build --component Runtime --prefix /usr/local</div>
</div><!-- fragment --> </details>
<p><a class="anchor" id="vcpkg-port"></a> </p>
<h3><a class="anchor" id="autotoc_md81"></a>
Install SuperNOVAS via <code>vcpkg</code></h3>
<p>As of version 1.5, SuperNOVAS is available through the <a href="https://vcpkg.io/en/">vcpkg</a> registry. The <code>vcpkg</code> port supports a wide range of platforms, including Linux, Windows, MacOS, and Android &ndash; for both <code>arm64</code> and <code>x64</code> architectures (and in case of Windows also <code>x86</code>). It is effectively the same as the CMake build (above), only with more simplicity, convenience, and dependency resolution.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>You can install the core SuperNOVAS library with <code>vcpkg</code> as:</p>
<div class="fragment"><div class="line">$ vcpkg install supernovas</div>
</div><!-- fragment --><p>Or, including the <code>solsys-calceph</code> plugin library as:</p>
<div class="fragment"><div class="line">$ vcpkg install supernovas[solsys-calceph]</div>
</div><!-- fragment --><p>The latter will also install the <code>calceph</code> library dependency, as needed.</p>
<p></p>
</details>
<p><a class="anchor" id="linux-packages"></a> </p>
<h3><a class="anchor" id="autotoc_md82"></a>
Linux packages</h3>
<p>SuperNOVAS is packaged for both Debian and Fedora / EPEL Linux distributions, and derivatives based on these (Ubuntu, Mint, RHEL, CentOS Stream, Alma Linux, Rocky Linux, Oracle Linux...).</p>
<details >
<summary >
Details</summary>
<p></p>
<p>On Debian-based platforms you might install all components via:</p>
<div class="fragment"><div class="line">$ sudo apt-get install libsupernovas1 libsolsys-calceph1 libsupernovas-doc libsupernovas-dev</div>
</div><!-- fragment --><p>And or Fedora / EPEL based distributions as:</p>
<div class="fragment"><div class="line">$ sudo dnf install supernovas supernovas-solsys-calceph supernovas-doc supernovas-devel</div>
</div><!-- fragment --><p>In both cases the first package is the runtime library, the second is the runtime library for the <code>solsys-calceph</code> plugin, the third is documentation, and the last one is the files needed for application development.</p>
<p></p>
</details>
<dl class="section note"><dt>Note</dt><dd>The turnaround time for Debian packages is quite slow, and typically follows the 6-month Debian release cycle, whereas the Fedora / EPEL packages are usually fully up-to-date (i.e. in <code>stable</code>) within a week of a new SuperNOVAS release. Somewhat newer Debian versions may be found in <code>testing</code>, but even that tends to lag behind the <code>stable</code> Fedora / EPEL updates.</dd></dl>
<p><a class="anchor" id="homebrew"></a> </p>
<h3><a class="anchor" id="autotoc_md83"></a>
Homebrew package</h3>
<p>As of version 1.5, there is also a <a href="https://brew.sh/">Homebrew</a> package through the maintainer's own Tap, which includes the <code>solsys-calceph</code> plugin by default.</p>
<details >
<summary >
Details</summary>
<p></p>
<div class="fragment"><div class="line">$ brew tap attipaci/pub</div>
<div class="line">$ brew install supernovas</div>
</div><!-- fragment --><p></p>
</details>
<hr  />
<p><a class="anchor" id="integration"></a> </p>
<h2><a class="anchor" id="autotoc_md85"></a>
Building your application with SuperNOVAS</h2>
<p>There are a number of ways you can build your application with <b>SuperNOVAS</b>. See which of the options suits your needs best:</p>
<ul>
<li><a class="el" href="#makefile-application">Using a GNU `Makefile`</a></li>
<li><a class="el" href="#cmake-application">Using CMake</a></li>
<li><a class="el" href="#deprecations">Deprecated API</a></li>
<li><a class="el" href="#legacy-application">Legacy linking `solarsystem()` and `readeph()` modules</a></li>
<li><a class="el" href="#preferred-legacy-application">Legacy modules: a better way</a></li>
</ul>
<p><a class="anchor" id="makefile-application"></a> </p>
<h3><a class="anchor" id="autotoc_md86"></a>
Using a GNU <code>Makefile</code></h3>
<details >
<summary >
Details</summary>
<p></p>
<p>Provided you have installed the <b>SuperNOVAS</b> headers and (static or shared) libraries into a standard location, you can build your application against it easily. For example, to build <code>myastroapp.c</code> against <b>SuperNOVAS</b>, you might have a <code>Makefile</code> with contents like:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) $^ -lm -lsupernovas</div>
</div><!-- fragment --><p>If you have a legacy NOVAS C 3.1 application, it is possible that the compilation will give you errors due to missing includes for <code>stdio.h</code>, <code>stdlib.h</code>, <code>ctype.h</code> or <code>string.h</code>, because these headers were implicitly included with <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code> in NOVAS C 3.1, but not in <b>SuperNOVAS</b> (at least not by default), as a matter of best practice. If this is a problem for you can 'fix' it in one of two ways: (1) Add the missing <code>#include</code> directives to your application source explicitly, or if that's not an option for you, then (2) set the <code>-DCOMPAT</code> compiler flag when compiling your application:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) -DCOMPAT $^ -lm -lsupernovas</div>
</div><!-- fragment --><p>If your application uses optional planet or ephemeris calculator modules, you may need to specify the additional shared libraries also:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) $^ -lm -lsupernovas -lsolsys-calceph -lcalceph</div>
</div><!-- fragment --><p></p>
</details>
<p><a class="anchor" id="cmake-application"></a> </p>
<h3><a class="anchor" id="autotoc_md87"></a>
Using CMake</h3>
<details >
<summary >
Details</summary>
<p></p>
<p>Add the appropriate bits from below to the <code>CMakeLists.txt</code> file of your application (<code>my-application</code>):</p>
<div class="fragment"><div class="line">find_package(supernovas REQUIRED)</div>
<div class="line">target_include_directories(my-application PRIVATE ${supernovas_INCLUDE_DIRS})</div>
<div class="line">target_link_libraries(my-application PRIVATE ${supernovas_LIBRARIES})</div>
</div><!-- fragment --><p></p>
</details>
<p><a class="anchor" id="deprecations"></a> </p>
<h3><a class="anchor" id="autotoc_md88"></a>
Deprecated API</h3>
<p><b>SuperNOVAS</b> began deprecating some NOVAS C functions, either because they are no longer needed; or are not easy to use and have better alternatives around; or are internals that should never have been exposed to end-users. The deprecations are marked in the inline and HTML API documentations, suggesting also alternatives.</p>
<p>That said, the deprecated parts of the API are NOT removed, nor we plan on removing them for the foreseeable future. Instead, they serve as a gentle reminder to users that perhaps they should stay away from these features for their own good.</p>
<p>However, you have the option to force yourself to avoid using the deprecated API if you choose to do so, by compiling your application with <code>-D_EXCLUDE_DEPRECATED</code>, or equivalently, by defining <code>_EXCLUDE_DEPRECATED</code> in your source code <em>before</em> including <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code>. E.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Include novas.h without the deprecated definitions</span></div>
<div class="line"><span class="preprocessor">#define _EXCLUDE_DEPRECATED</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="ttc" id="anovas_8h_html"><div class="ttname"><a href="novas_8h.html">novas.h</a></div><div class="ttdoc">SuperNOVAS types, definitions, and function prototypes.</div></div>
</div><!-- fragment --><p>After that, your compiler will complain if your source code references any of the deprecated entities, so you may change that part of your code to use the recommended alternatives instead.</p>
<p><a class="anchor" id="legacy-application"></a> </p>
<h3><a class="anchor" id="autotoc_md89"></a>
Legacy linking <code>solarsystem()</code> / <code>solarsystem_hp()</code> and <code>readeph()</code> modules</h3>
<p>The NOVAS C way to handle planet or other ephemeris functions was to link particular modules to provide the <code>solarsystem()</code> / <code>solarsystem_hp()</code> and <code><a class="el" href="novas_8h.html#aa5f22db2fa785675372d45b88f2f1736">readeph()</a></code> functions. This approach is discouraged in <b>SuperNOVAS</b>, with preference for selecting implementations at runtime. The old, deprecated way, of incorporating Solar-system data is supported, nevertheless, for legacy applications with some caveats.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>To use your own existing default <code>solarsystem()</code> implementation in the NOVAS C way, you will have to build <b>SuperNOVAS</b> with <code>SOLSYS_SOURCE</code> set to the source file(s) of the implementation (<code>config.mk</code> or the environment).</p>
<p>The same principle applies to using your specific legacy <code><a class="el" href="novas_8h.html#aa5f22db2fa785675372d45b88f2f1736">readeph()</a></code> implementation, except that you must set <code>READEPH_SOURCE</code> to the source file(s) of the chosen implementation when building <b>SuperNOVAS</b>).</p>
<p>(You might have to also add additional include directories to <code>CPPFLAGS</code>, e.g. <code>-I/my-path/include</code> for you custom sources for their associated headers).</p>
<p></p>
</details>
<p><a class="anchor" id="preferred-legacy-application"></a> </p>
<h3><a class="anchor" id="autotoc_md90"></a>
Legacy modules: a better way</h3>
<p>A better way to recycle your old planet and ephemeris calculator modules may be to rename <code>solarsystem()</code> / <code>solarsystem_hp()</code> functions therein to e.g. <code>my_planet_calculator()</code> / <code>my_planet_calculator_hp()</code> and then in your application can specify these functions as the provider at runtime.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>E.g.:</p>
<div class="fragment"><div class="line">set_planet_calculator(my_planet_calculator);</div>
<div class="line">set_planet_calculator(my_planet_calculator_hp);</div>
</div><!-- fragment --><p>(You might also change the <code>short</code> type parameters to the SuperNOVAS enum types while at it, to conform to the SuperNOVAS <code><a class="el" href="group__solar-system.html#gaae2b06af367d7b0a70a8b89c258b00b0" title="Provides the position and velocity of major planets (as well as the Sun, Moon, Solar-system Barycente...">novas_planet_provider</a></code> / <code><a class="el" href="group__solar-system.html#gae8d7c10a8b9e69b1f0654ef4038482fd" title="Provides the position and velocity of major planets (as well as the Sun, Moon, Solar-system Barycente...">novas_planet_provider_hp</a></code> types.)</p>
<p>For <code><a class="el" href="novas_8h.html#aa5f22db2fa785675372d45b88f2f1736">readeph()</a></code> implementations, it is recommended that you change both the name and the footprint to e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_ephem_provider(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, <span class="keywordtype">double</span> jd_tdb_high, <span class="keywordtype">double</span> jd_tdb_low, </div>
<div class="line">                      <span class="keyword">enum</span> <a class="code hl_enumeration" href="group__solar-system.html#ga208120c5fa3e12853eb37cb99d3e27be">novas_origin</a> *origin, <span class="keywordtype">double</span> *pos, <span class="keywordtype">double</span> *vel);</div>
<div class="ttc" id="agroup__solar-system_html_ga208120c5fa3e12853eb37cb99d3e27be"><div class="ttname"><a href="group__solar-system.html#ga208120c5fa3e12853eb37cb99d3e27be">novas_origin</a></div><div class="ttdeci">novas_origin</div><div class="ttdoc">The origin of the ICRS system for referencing positions and velocities for solar-system bodies.</div><div class="ttdef"><b>Definition</b> novas.h:967</div></div>
</div><!-- fragment --><p>and then then apply it in your application as:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__solar-system.html#ga6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephem_provider);</div>
<div class="ttc" id="agroup__solar-system_html_ga6097083c438a8d1872c2e00a66360030"><div class="ttname"><a href="group__solar-system.html#ga6097083c438a8d1872c2e00a66360030">set_ephem_provider</a></div><div class="ttdeci">int set_ephem_provider(novas_ephem_provider func)</div><div class="ttdoc">Sets the function to use for obtaining position / velocity information for minor planets,...</div><div class="ttdef"><b>Definition</b> ephemeris.c:121</div></div>
</div><!-- fragment --><p>While all of that requires some minimal changes to your old code, the advantage of this preferred approach is that you do not need to re-build the library with <code>USER_SOLSYS</code> and/or <code>USER_READEPH</code> defined.</p>
<p></p>
</details>
<hr  />
<p><a class="anchor" id="methodologies"></a> </p>
<h2><a class="anchor" id="autotoc_md92"></a>
Celestial coordinate systems (old vs. new)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><p class="starttd"><img src="SuperNOVAS-systems.png" alt="" class="inline" title="SuperNOVAS coordinate systems and conversions"/>    </p>
<p class="endtd"></p>
</th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Figure 1.</b> SuperNOVAS Coordinate Systems and Conversions. Functions indicated in bold face are available in NOVAS C also. All other functions are available in SuperNOVAS only. SuperNOVAS also adds efficient <a class="el" href="#transforms">matrix transformations</a> between the equatorial systems.   </td></tr>
</table>
<p>The IAU 2000 and 2006 resolutions have completely overhauled the system of astronomical coordinate transformations to enable higher precision astrometry. (Super)NOVAS supports coordinate calculations both in the old (pre IAU 2000) ways, and in the new IAU standard method. The table below provides an overview of how the old and new methods define some of the terms differently:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Concept   </th><th class="markdownTableHeadNone">Old standard   </th><th class="markdownTableHeadNone">New IAU standard    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Catalog coordinate system   </td><td class="markdownTableBodyNone">MOD (e.g. FK4, FK5, HIP...)   </td><td class="markdownTableBodyNone">International Celestial Reference System (ICRS)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Dynamical system   </td><td class="markdownTableBodyNone">True of Date (TOD)   </td><td class="markdownTableBodyNone">Celestial Intermediate Reference System (CIRS)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Dynamical R.A. origin   </td><td class="markdownTableBodyNone">equinox of date   </td><td class="markdownTableBodyNone">Celestial Intermediate Origin (CIO)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Precession, nutation, bias   </td><td class="markdownTableBodyNone">no tidal terms   </td><td class="markdownTableBodyNone">IAU 2000/2006 precession/nutation model    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Celestial Pole offsets   </td><td class="markdownTableBodyNone">d&psi;, d&epsilon; (for TOD)   </td><td class="markdownTableBodyNone"><em>x</em><sub>p</sub>, <em>y</em><sub>p</sub> (for ITRS)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Earth rotation measure   </td><td class="markdownTableBodyNone">Greenwich Sidereal Time (GST)   </td><td class="markdownTableBodyNone">Earth Rotation Angle (ERA)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Pseudo Earth-fixed system   </td><td class="markdownTableBodyNone">PEF   </td><td class="markdownTableBodyNone">Terrestrial Intermediate Reference System (TIRS)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Earth rotation origin   </td><td class="markdownTableBodyNone">Greenwich Meridian   </td><td class="markdownTableBodyNone">Terrestrial Intermediate Origin (TIO)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Earth-fixed System   </td><td class="markdownTableBodyNone">WGS84   </td><td class="markdownTableBodyNone">International Terrestrial Reference System (ITRS)   </td></tr>
</table>
<p>See the various enums and constants defined in <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code>, as well as the descriptions on the various NOVAS routines on how they are appropriate for the old and new methodologies respectively. Figure 1 also shows the relation of the various old and new coordinate systems and the (Super)NOVAS functions for converting position / velocity vectors among them.</p>
<dl class="section note"><dt>Note</dt><dd>In NOVAS, the barycentric BCRS and the geocentric GCRS systems are effectively synonymous to ICRS, since the origin for positions and for velocities, in any reference system, is determined by the <code>observer</code> location. Aberration and gravitational deflection correction included for apparent places only (as seen from the observer location, regardless of where that is), but not for geometric places.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>Older catalogs, such as J2000 (FK5), HIP, B1950 (FK4) or B1900 are just special cases of MOD (mean-of-date) coordinates for the J2000, J1991.25, B1950, and B1900 epochs, respectively.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Applying residual polar offsets (&Delta;d&psi;, &Delta;d&epsilon; or <em>x</em><sub>p</sub>, <em>y</em><sub>p</sub>) to the TOD equator (via <code><a class="el" href="equator_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole()</a></code>) is discouraged. Instead, the sub-arcsecond level corrections to Earth orientation (<em>x</em><sub>p</sub>, <em>y</em><sub>p</sub>) should be used only for converting between the pseudo Earth-fixed (PEF or TIRS) and ITRS, and vice-versa (e.g. with <code><a class="el" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838" title="Sets up a observing frame for a specific observer location, time of observation, and accuracy require...">novas_make_frame()</a></code> or <code><a class="el" href="group__nonequatorial.html#gaead87744eeb3029ce7d5ffb1801ee652" title="Corrects a vector in the ITRS (rotating Earth-fixed system) for polar motion, and also corrects the l...">wobble()</a></code>).</dd></dl>
<dl class="section note"><dt>Note</dt><dd>WGS84 has been superseded by ITRS for higher accuracy definitions of Earth-based locations. WGS84 matches ITRS to the 10m level globally, but it does not account for continental drifts and crustal motion. In (Super)NOVAS all Earth-base locations are presumed ITRS. ITRS longitude, latitude, and altitude coordinates are referenced to the GRS80 ellipsoid, whereas GPS locations are referenced to the WGS84 ellipsoid. <b>SuperNOVAS</b> offers ways to convert between the two if needed.</dd></dl>
<hr  />
<p><a class="anchor" id="examples"></a> </p>
<h2><a class="anchor" id="autotoc_md94"></a>
Example usage</h2>
<ul>
<li><a class="el" href="#sidereal-example">Calculating positions for a sidereal source</a></li>
<li><a class="el" href="#solsys-example">Calculating positions for a Solar-system source</a></li>
<li><a class="el" href="#transforms">Coordinate and velocity transforms (change of coordinate system)</a></li>
</ul>
<p><b>SuperNOVAS v1.1</b> has introduced a new, more intuitive, more elegant, and more efficient approach for calculating astrometric positions of celestial objects. The guide below is geared towards this new method. However, the original NOVAS C approach remains viable also (albeit often less efficient).</p>
<dl class="section note"><dt>Note</dt><dd>You may find an equivalent legacy example showcasing the original NOVAS method in <a href="https://github.com/Smithsonian/SuperNOVAS/blob/main/doc/NOVAS-legacy.md"><code>NOVAS-legacy.md</code></a>.</dd></dl>
<p><a class="anchor" id="sidereal-example"></a> </p>
<h3><a class="anchor" id="autotoc_md95"></a>
Calculating positions for a sidereal source</h3>
<p>A sidereal source may be anything beyond the Solar system with 'fixed' catalog coordinates. It may be a star, or a galactic molecular cloud, or a distant quasar.</p>
<ul>
<li><a class="el" href="#specify-object">Specify the object of interest</a></li>
<li><a class="el" href="#specify-observer">Specify the observer location</a></li>
<li><a class="el" href="#specify-time">Specify the time of observation</a></li>
<li><a class="el" href="#observing-frame">Set up the observing frame</a></li>
<li><a class="el" href="#apparent-place">Calculate an apparent place on sky</a></li>
<li><a class="el" href="#horizontal-place">Calculate azimuth and elevation angles at the observing location</a></li>
<li><a class="el" href="#reverse-place">Going in reverse...</a></li>
<li><a class="el" href="#rise-set-transit">Calculate rise, set, and transit times</a></li>
<li><a class="el" href="#transforms">Coordinate and velocity transforms (change of coordinate system)</a></li>
</ul>
<p><a class="anchor" id="specify-object"></a> </p>
<h4><a class="anchor" id="autotoc_md96"></a>
Specify the object of interest</h4>
<p>First, you must provide the astrometric parameters (coordinates, and optionally radial velocity or redshift, proper motion, and/or parallax or distance also). Let's assume we pick a star for which we have B1950 (i.e. FK4) coordinates. We begin with the assigned name and the R.A. / Dec coordinates.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structcat__entry.html">cat_entry</a> star; <span class="comment">// Structure to contain information on sidereal source </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Let&#39;s assume we have B1950 (FK4) coordinates of</span></div>
<div class="line"><span class="comment">// 16h26m20.1918s, -26d19m23.138s</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#gaf0137aa791dd29278904e53498fb9515">novas_init_cat_entry</a>(&amp;star, <span class="stringliteral">&quot;Antares&quot;</span>, 16.43894213, -26.323094);</div>
<div class="ttc" id="agroup__source_html_gaf0137aa791dd29278904e53498fb9515"><div class="ttname"><a href="group__source.html#gaf0137aa791dd29278904e53498fb9515">novas_init_cat_entry</a></div><div class="ttdeci">int novas_init_cat_entry(cat_entry *restrict source, const char *restrict name, double ra, double dec)</div><div class="ttdoc">Initializes a catalog entry, such as a star or a distant galaxy, with a name and coordinates.</div><div class="ttdef"><b>Definition</b> target.c:112</div></div>
<div class="ttc" id="astructcat__entry_html"><div class="ttname"><a href="structcat__entry.html">cat_entry</a></div><div class="ttdoc">Basic astrometric data for any sidereal object located outside the solar system.</div><div class="ttdef"><b>Definition</b> novas.h:1164</div></div>
</div><!-- fragment --><p>If you have coordinates as strings in decimal or HMS / DMS format, you might use <code><a class="el" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a" title="Returns a time or time-like angleparsed from a string that contains either a decimal hours or else a ...">novas_str_hours()</a></code> and/or <code><a class="el" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd" title="Returns an angle parsed from a string that contains either a decimal degrees or else a broken-down DM...">novas_str_degrees()</a></code> to convert them to hours/degrees for <code><a class="el" href="group__source.html#gaf0137aa791dd29278904e53498fb9515" title="Initializes a catalog entry, such as a star or a distant galaxy, with a name and coordinates.">novas_init_cat_entry()</a></code>, with a fair bit of flexibility on the particulars of the representation, e.g.:</p>
<div class="fragment"><div class="line">novas_init_entry(&amp;star, <span class="stringliteral">&quot;Antares&quot;</span>,</div>
<div class="line">  <a class="code hl_function" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a>(<span class="stringliteral">&quot;16h 26m 20.1918s&quot;</span>),   <span class="comment">// e.g. using h,m,s and spaces as separators </span></div>
<div class="line">  <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;-26:19:23.138&quot;</span>));   <span class="comment">// e.g. using colons to separate components</span></div>
<div class="ttc" id="agroup__util_html_ga3ed26b6af870f6dbc353f651563afd4a"><div class="ttname"><a href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a></div><div class="ttdeci">double novas_str_hours(const char *restrict str)</div><div class="ttdoc">Returns a time or time-like angleparsed from a string that contains either a decimal hours or else a ...</div><div class="ttdef"><b>Definition</b> parse.c:777</div></div>
<div class="ttc" id="agroup__util_html_ga6d6ada07aab7ce09fb8ea7b12660ebcd"><div class="ttname"><a href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a></div><div class="ttdeci">double novas_str_degrees(const char *restrict str)</div><div class="ttdoc">Returns an angle parsed from a string that contains either a decimal degrees or else a broken-down DM...</div><div class="ttdef"><b>Definition</b> parse.c:738</div></div>
</div><!-- fragment --><p>Next, if it's a star or some other source within our own Galaxy, you'll want to specify its proper motion (in the same reference system as the above coordinates), so we can calculate its position for the epoch of observation.</p>
<div class="fragment"><div class="line"><span class="comment">// Now, let&#39;s add proper motion of 12.11, -23.30 mas/year.</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga8ac3513c266181baf92a6b3c22818c99">novas_set_proper_motion</a>(&amp;star, -12.11, -23.30);</div>
<div class="ttc" id="agroup__source_html_ga8ac3513c266181baf92a6b3c22818c99"><div class="ttname"><a href="group__source.html#ga8ac3513c266181baf92a6b3c22818c99">novas_set_proper_motion</a></div><div class="ttdeci">int novas_set_proper_motion(cat_entry *source, double pm_ra, double pm_dec)</div><div class="ttdoc">Sets the proper-motion for a (Galactic) catalog source.</div><div class="ttdef"><b>Definition</b> target.c:256</div></div>
</div><!-- fragment --><p>For Galactic sources you will also want to set the parallax using <code><a class="el" href="group__source.html#ga69274f4ac2631335e1e901142d31f541" title="Sets the parallax (a measure of distance) for a catalog source.">novas_set_parallax()</a></code> or equivalently the distance (in parsecs) using <code><a class="el" href="group__source.html#gaa076ebd4c967fb9afa24bd85feb84f63" title="Sets the distance for a catalog source.">novas_set_distance()</a></code>, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Add parallax of 5.89 mas</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga69274f4ac2631335e1e901142d31f541">novas_set_parallax</a>(&amp;star, 5.89);</div>
<div class="ttc" id="agroup__source_html_ga69274f4ac2631335e1e901142d31f541"><div class="ttname"><a href="group__source.html#ga69274f4ac2631335e1e901142d31f541">novas_set_parallax</a></div><div class="ttdeci">int novas_set_parallax(cat_entry *source, double mas)</div><div class="ttdoc">Sets the parallax (a measure of distance) for a catalog source.</div><div class="ttdef"><b>Definition</b> target.c:277</div></div>
</div><!-- fragment --><p>Finally, for spectroscopic applications you will also want to set the radial velocity. You can use <code><a class="el" href="group__source.html#ga45f7fdc15580138517ce452a236674d7" title="Sets a radial velocity for a catalog source, defined w.r.t.">novas_set_ssb_vel()</a></code> if you have standard radial velocities defined with respect to the Solar System Barycenter; or <code><a class="el" href="group__source.html#ga4aa0c52a1d4838feb4255974486462a7" title="Sets a radial velocity for a catalog source, defined w.r.t.">novas_set_lsr_vel()</a></code> if the velocity is relative to the Local Standard of Rest (LSR); or else <code><a class="el" href="group__source.html#ga4efac9e50efec20489d47726217e9c7e" title="Sets a redhift for a catalog source, as a relativistic measure of velocity.">novas_set_redshift()</a></code> if you have a redshift measure (as is typical for distant galaxies and quasars). E.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Add a radial velocity of -3.4 km/s (relative to SSB)</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga45f7fdc15580138517ce452a236674d7">novas_set_ssb_vel</a>(&amp;star, -3.4);</div>
<div class="ttc" id="agroup__source_html_ga45f7fdc15580138517ce452a236674d7"><div class="ttname"><a href="group__source.html#ga45f7fdc15580138517ce452a236674d7">novas_set_ssb_vel</a></div><div class="ttdeci">int novas_set_ssb_vel(cat_entry *source, double v_kms)</div><div class="ttdoc">Sets a radial velocity for a catalog source, defined w.r.t.</div><div class="ttdef"><b>Definition</b> target.c:182</div></div>
</div><!-- fragment --><p>Alternatively, if you prefer, you may use the original NOVAS C <code><a class="el" href="group__source.html#gaa040bcfe8bee7d8e1307800f48efddd7" title="Fully populates the data structure for a catalog source, such as a star, with all parameters provided...">make_cat_entry()</a></code> to set the astrometric parameters above all at once.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>E.g.:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__source.html#gaa040bcfe8bee7d8e1307800f48efddd7">make_cat_entry</a>(<span class="stringliteral">&quot;Antares&quot;</span>, <span class="stringliteral">&quot;FK4&quot;</span>, 1, </div>
<div class="line"> <a class="code hl_function" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a>(<span class="stringliteral">&quot;16h 26m 20.1918s&quot;</span>), </div>
<div class="line"> <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;-26:19:23.138&quot;</span>),</div>
<div class="line"> -12.11, -23.30, 5.89, -3.4, &amp;star);</div>
<div class="ttc" id="agroup__source_html_gaa040bcfe8bee7d8e1307800f48efddd7"><div class="ttname"><a href="group__source.html#gaa040bcfe8bee7d8e1307800f48efddd7">make_cat_entry</a></div><div class="ttdeci">short make_cat_entry(const char *restrict name, const char *restrict catalog, long cat_num, double ra, double dec, double pm_ra, double pm_dec, double parallax, double rad_vel, cat_entry *source)</div><div class="ttdoc">Fully populates the data structure for a catalog source, such as a star, with all parameters provided...</div><div class="ttdef"><b>Definition</b> target.c:335</div></div>
</div><!-- fragment --><p></p>
</details>
<p>Next, we wrap that catalog source into a generic celestial <code>object</code> structure. (An <code>object</code> handles various Solar-system sources also, as you'll see further below). Whereas the catalog source may have been defined in any epoch / catalog system, the <code>object</code> structure shall define ICRS coordinates always (no exceptions):</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> source;   <span class="comment">// Encapsulates a sidereal or a Solar-system source</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use the B1950 astrometric parameters to set up the observables in ICRS...</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga5104d7db66ce2d8c61c7ad21599fb45e">make_cat_object_sys</a>(&amp;star, <span class="stringliteral">&quot;B1950&quot;</span>, &amp;source);</div>
<div class="ttc" id="agroup__source_html_ga5104d7db66ce2d8c61c7ad21599fb45e"><div class="ttname"><a href="group__source.html#ga5104d7db66ce2d8c61c7ad21599fb45e">make_cat_object_sys</a></div><div class="ttdeci">int make_cat_object_sys(const cat_entry *star, const char *restrict system, object *source)</div><div class="ttdoc">Populates and object data structure with the data for a catalog source for a given system of catalog ...</div><div class="ttdef"><b>Definition</b> target.c:537</div></div>
</div><!-- fragment --><p>Alternatively, for high-_z_ sources you might simply use the 1-step <code><a class="el" href="group__source.html#ga257abae9391aec835dc2b94d9788b9f9" title="Populates a celestial object data structure with the parameters for a redhifted catalog source,...">make_redshifted_object_sys()</a></code> e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> quasar;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 12h29m6.6997s +2d3m8.598s (ICRS) z=0.158339</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga257abae9391aec835dc2b94d9788b9f9">make_redshifted_object_sys</a>(<span class="stringliteral">&quot;3c273&quot;</span>, 12.4851944, 2.0523883, <span class="stringliteral">&quot;ICRS&quot;</span>, 0.158339, &amp;quasar);</div>
<div class="ttc" id="agroup__source_html_ga257abae9391aec835dc2b94d9788b9f9"><div class="ttname"><a href="group__source.html#ga257abae9391aec835dc2b94d9788b9f9">make_redshifted_object_sys</a></div><div class="ttdeci">int make_redshifted_object_sys(const char *name, double ra, double dec, const char *restrict system, double z, object *source)</div><div class="ttdoc">Populates a celestial object data structure with the parameters for a redhifted catalog source,...</div><div class="ttdef"><b>Definition</b> target.c:647</div></div>
</div><!-- fragment --><p><a class="anchor" id="specify-observer"></a> </p>
<h4><a class="anchor" id="autotoc_md97"></a>
Specify the observer location</h4>
<p>Next, we define the location where we observe from. Let's assume we have a GPS location:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structobserver.html">observer</a> obs;    <span class="comment">// Structure to contain observer location </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Specify the location we are observing from, e.g. a GPS / WGS84 location</span></div>
<div class="line"><span class="comment">// 50.7374 deg N, 7.0982 deg E, 60m elevation</span></div>
<div class="line"><a class="code hl_function" href="group__observer.html#gaa2f9fc986f99c1ec7092330dbf233fef">make_gps_observer</a>(50.7374, 7.0982, 60.0, &amp;obs);</div>
<div class="ttc" id="agroup__observer_html_gaa2f9fc986f99c1ec7092330dbf233fef"><div class="ttname"><a href="group__observer.html#gaa2f9fc986f99c1ec7092330dbf233fef">make_gps_observer</a></div><div class="ttdeci">int make_gps_observer(double latitude, double longitude, double height, observer *obs)</div><div class="ttdoc">Initializes an observer data structure for a ground-based observer with the specified GPS / WGS84 loc...</div><div class="ttdef"><b>Definition</b> observer.c:282</div></div>
<div class="ttc" id="astructobserver_html"><div class="ttname"><a href="structobserver.html">observer</a></div><div class="ttdoc">Observer location.</div><div class="ttdef"><b>Definition</b> novas.h:1560</div></div>
</div><!-- fragment --><dl class="section remark"><dt>Remarks</dt><dd>You might use <code><a class="el" href="group__observer.html#gad8b2d2e6ca9570f09a0ca1f82957ed48" title="Initializes an observer data structure for a ground-based observer with the specified International T...">make_itrf_observer()</a></code> instead if the location is defined on the GRS80 reference ellipsoid, used e.g. for ITRF locations. Or, if you have geocentric Cartesian coordinates, you could use <code><a class="el" href="group__observer.html#ga9e3cbe310a40919ff94d2d530ffa74ee" title="Initializes an observing site with the specified Cartesian geocentric xyz location,...">make_xyz_site()</a></code> and then <code><a class="el" href="group__observer.html#gaa82db32ce7b115db4f0a077ca899589b" title="Initializes an observer data structure for a ground-based observer at the specified observing site,...">make_observer_at_site()</a></code>.</dd></dl>
<p>Again you might use <code><a class="el" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd" title="Returns an angle parsed from a string that contains either a decimal degrees or else a broken-down DM...">novas_str_degrees()</a></code> for typical string representations of the longitude and latitude coordinates here, such as:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__observer.html#gaa2f9fc986f99c1ec7092330dbf233fef">make_gps_observer</a>(</div>
<div class="line">  <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;50.7374N&quot;</span>),</div>
<div class="line">  <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;7.0982 deg E&quot;</span>),</div>
<div class="line">  60.0,</div>
<div class="line">  &amp;obs);</div>
</div><!-- fragment --><p>Alternatively, you can also specify airborne observers, or observers in Earth orbit, in heliocentric orbit, at the geocenter, or at the Solar-system barycenter. The above also sets default, mean annual weather parameters based on the location and a global model based on Feulner et al. (2013).</p>
<p>You can, of course, set actual weather values <em>after</em>, as appropriate, if you need them for the refraction models, e.g.:</p>
<div class="fragment"><div class="line">obs.<a class="code hl_variable" href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">on_surf</a>.temperature = 12.4;  <span class="comment">// [C] Ambient temperature</span></div>
<div class="line">obs.<a class="code hl_variable" href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">on_surf</a>.pressure = 973.47;   <span class="comment">// [mbar] Atmospheric pressure</span></div>
<div class="line">obs.<a class="code hl_variable" href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">on_surf</a>.humidity = 48.3;     <span class="comment">// [%] relative humidity to use for refraction.</span></div>
<div class="ttc" id="astructobserver_html_a45fe4eb871c346c1b8315c4c6a41e96d"><div class="ttname"><a href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">observer::on_surf</a></div><div class="ttdeci">struct novas_on_surface on_surf</div><div class="ttdoc">structure containing data for an observer&#39;s location on the surface of the Earth (if where = NOVAS_OB...</div><div class="ttdef"><b>Definition</b> novas.h:1565</div></div>
</div><!-- fragment --><p><a class="anchor" id="specify-time"></a> </p>
<h4><a class="anchor" id="autotoc_md98"></a>
Specify the time of observation</h4>
<p>Next, we set the time of observation. For a ground-based observer, you will need to provide <b>SuperNOVAS</b> with the UT1 - UTC time difference (a.k.a. DUT1), and the current leap seconds. You can obtain suitable values for DUT1 from IERS, and for the highest precision, interpolate for the time of observations. For the example, let's assume 37 leap seconds, and DUT1 = 0.042,</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> leap_seconds = 37;        <span class="comment">// [s] UTC - TAI time difference</span></div>
<div class="line"><span class="keywordtype">double</span> dut1 = 0.042;          <span class="comment">// [s] UT1 - UTC time difference</span></div>
</div><!-- fragment --><p>Then we can set the time of observation, for example, using the current UNIX time:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__timespec.html">novas_timespec</a> obs_time;       <span class="comment">// Structure that will define astrometric time</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the time of observation to the precise UTC-based UNIX time</span></div>
<div class="line"><a class="code hl_function" href="group__time.html#ga090f608cd5c82622e3534297fc27daa5">novas_set_current_time</a>(leap_seconds, dut1, &amp;obs_time);</div>
<div class="ttc" id="agroup__time_html_ga090f608cd5c82622e3534297fc27daa5"><div class="ttname"><a href="group__time.html#ga090f608cd5c82622e3534297fc27daa5">novas_set_current_time</a></div><div class="ttdeci">int novas_set_current_time(int leap, double dut1, novas_timespec *restrict time)</div><div class="ttdoc">Sets the time eith the UNIX time obtained from the system clock.</div><div class="ttdef"><b>Definition</b> timescale.c:914</div></div>
<div class="ttc" id="astructnovas__timespec_html"><div class="ttname"><a href="structnovas__timespec.html">novas_timespec</a></div><div class="ttdoc">A structure, which defines a precise instant of time that can be extpressed in any of the astronomica...</div><div class="ttdef"><b>Definition</b> novas.h:1672</div></div>
</div><!-- fragment --><p>Alternatively, you may set the time as a Julian date in the time measure of choice (UTC, UT1, TT, TDB, GPS, TAI, TCG, or TCB):</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> jd_tai = ...     <span class="comment">// TAI-based Julian Date </span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb">novas_set_time</a>(<a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a>, jd_tai, leap_seconds, dut1, &amp;obs_time);</div>
<div class="ttc" id="agroup__time_html_gaf4a1a5180905a7d8f76aeafe3f9a8ebb"><div class="ttname"><a href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb">novas_set_time</a></div><div class="ttdeci">int novas_set_time(enum novas_timescale timescale, double jd, int leap, double dut1, novas_timespec *restrict time)</div><div class="ttdoc">Sets an astronomical time to the fractional Julian Date value, defined in the specified timescale.</div><div class="ttdef"><b>Definition</b> timescale.c:475</div></div>
<div class="ttc" id="agroup__time_html_ggaa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b"><div class="ttname"><a href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a></div><div class="ttdeci">@ NOVAS_TAI</div><div class="ttdoc">Innternational Atomic Time (TAI)</div><div class="ttdef"><b>Definition</b> novas.h:1646</div></div>
</div><!-- fragment --><p>or, for the best precision we may do the same with an integer / fractional split:</p>
<div class="fragment"><div class="line"><span class="keywordtype">long</span> ijd_tai = ...     <span class="comment">// Integer part of the TAI-based Julian Date</span></div>
<div class="line"><span class="keywordtype">double</span> fjd_tai = ...   <span class="comment">// Fractional part of the TAI-based Julian Date </span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__time.html#gad47bcb1e3c5df56a0ffdf1a127e52598">novas_set_split_time</a>(<a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a>, ijd_tai, fjd_tai, leap_seconds, dut1, &amp;obs_time);</div>
<div class="ttc" id="agroup__time_html_gad47bcb1e3c5df56a0ffdf1a127e52598"><div class="ttname"><a href="group__time.html#gad47bcb1e3c5df56a0ffdf1a127e52598">novas_set_split_time</a></div><div class="ttdeci">int novas_set_split_time(enum novas_timescale timescale, long ijd, double fjd, int leap, double dut1, novas_timespec *restrict time)</div><div class="ttdoc">Sets an astronomical time to the split Julian Date value, defined in the specified timescale.</div><div class="ttdef"><b>Definition</b> timescale.c:558</div></div>
</div><!-- fragment --><p>Or, you might use string dates, such as an ISO timestamp:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__time.html#ga4b5b82161f8eb474aaa650815b7ca66f">novas_set_str_time</a>(<a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba01787464888b92c37b8340174c03cc8d">NOVAS_UTC</a>, <span class="stringliteral">&quot;2025-01-26T22:05:14.234+0200&quot;</span>, leap_seconds, dut1, &amp;obs_time);</div>
<div class="ttc" id="agroup__time_html_ga4b5b82161f8eb474aaa650815b7ca66f"><div class="ttname"><a href="group__time.html#ga4b5b82161f8eb474aaa650815b7ca66f">novas_set_str_time</a></div><div class="ttdeci">int novas_set_str_time(enum novas_timescale timescale, const char *restrict str, int leap, double dut1, novas_timespec *restrict time)</div><div class="ttdoc">Sets astronomical time in a specific timescale using a string specification.</div><div class="ttdef"><b>Definition</b> timescale.c:507</div></div>
<div class="ttc" id="agroup__time_html_ggaa642c4ccc7195dc62fd0dc56567ebd0ba01787464888b92c37b8340174c03cc8d"><div class="ttname"><a href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba01787464888b92c37b8340174c03cc8d">NOVAS_UTC</a></div><div class="ttdeci">@ NOVAS_UTC</div><div class="ttdoc">Universal Coordinated Time (UTC)</div><div class="ttdef"><b>Definition</b> novas.h:1648</div></div>
</div><!-- fragment --><p>Note, that the likes of <code><a class="el" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb" title="Sets an astronomical time to the fractional Julian Date value, defined in the specified timescale.">novas_set_time()</a></code> will automatically apply diurnal corrections to the supplied UT1-UTC time difference for libration and ocean tides. Thus, the supplied values should not include these. Rather you should pass <code>dut1</code> directly (or interpolated) from the IERS Bulletin values for the time of observation.</p>
<p><a class="anchor" id="observing-frame"></a> </p>
<h4><a class="anchor" id="autotoc_md99"></a>
Set up the observing frame</h4>
<p>Next, we set up an observing frame, which is defined for a unique combination of the observer location and the time of observation:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__frame.html">novas_frame</a> obs_frame;  <span class="comment">// Structure that will define the observing frame</span></div>
<div class="line"><span class="keywordtype">double</span> xp = ...         <span class="comment">// [mas] Earth polar offset x, e.g. from IERS Bulletin A.</span></div>
<div class="line"><span class="keywordtype">double</span> yp = ...         <span class="comment">// [mas] Earth polar offset y, from same source as above.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observing frame with the given observing parameters</span></div>
<div class="line"><a class="code hl_function" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838">novas_make_frame</a>(<a class="code hl_enumvalue" href="group__frame.html#gga3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846">NOVAS_REDUCED_ACCURACY</a>, &amp;obs, &amp;obs_time, xp, yp, &amp;obs_frame);</div>
<div class="ttc" id="agroup__frame_html_gadc72577f99a7b076b23e0e44ddbca838"><div class="ttname"><a href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838">novas_make_frame</a></div><div class="ttdeci">int novas_make_frame(enum novas_accuracy accuracy, const observer *obs, const novas_timespec *time, double xp, double yp, novas_frame *frame)</div><div class="ttdoc">Sets up a observing frame for a specific observer location, time of observation, and accuracy require...</div><div class="ttdef"><b>Definition</b> frames.c:519</div></div>
<div class="ttc" id="agroup__frame_html_gga3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846"><div class="ttname"><a href="group__frame.html#gga3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846">NOVAS_REDUCED_ACCURACY</a></div><div class="ttdeci">@ NOVAS_REDUCED_ACCURACY</div><div class="ttdoc">Calculate with truncated terms.</div><div class="ttdef"><b>Definition</b> novas.h:859</div></div>
<div class="ttc" id="astructnovas__frame_html"><div class="ttname"><a href="structnovas__frame.html">novas_frame</a></div><div class="ttdoc">A set of parameters that uniquely define the place and time of observation.</div><div class="ttdef"><b>Definition</b> novas.h:1768</div></div>
</div><!-- fragment --><p>Here <code>xp</code> and <code>yp</code> are small (sub-arcsec level) corrections to Earth orientation. Values for these are are published in the <a href="https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html">IERS Bulletins</a>. These values should be interpolated for the time of observation, but should NOT be corrected for libration and ocean tides (<code><a class="el" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838" title="Sets up a observing frame for a specific observer location, time of observation, and accuracy require...">novas_make_frame()</a></code> will apply such corrections as appropriate for full accuracy frames). The Earth orientation parameters (EOP) are needed only when converting positions from the celestial CIRS (or TOD) frame to the Earth-fixed ITRS (or PEF) frames. You may ignore these and set zeroes if not interested in Earth-fixed calculations or if sub-arcsecond precision is not required.</p>
<p>The advantage of using the observing frame, is that it enables very fast position calculations for multiple objects in that frame (see the <a class="el" href="#benchmarks">benchmarks</a>), since all sources in a frame have well-defined, fixed, topological positions on the celestial sphere. It is only a matter of expressing these positions as coordinates (and velocities) in a particular coordinate system. So, if you need to calculate positions for thousands of sources for the same observer and time, it will be significantly faster than using the low-level NOVAS C routines instead. You can create derivative frames for different observer locations, if need be, via <code><a class="el" href="group__frame.html#ga2972b3eafa2d7f6c29cff34bad9fcf0d" title="Change the observer location for an observing frame.">novas_change_observer()</a></code>.</p>
<dl class="section important"><dt>Important</dt><dd>Without a proper ephemeris provider for the major planets, you are invariably restricted to working with <code>NOVAS_REDUCED_ACCURACY</code> frames, providing milliarcsecond precision at most. Attempting to construct high-accuracy frames without an appropriate high-precision ephemeris provider will result in an error from the requisite <code><a class="el" href="group__geometric.html#ga713982e1f2bae0a72b39d03007f00d23" title="Retrieves the position and velocity of a solar system body using the currently configured plugins tha...">ephemeris()</a></code> calls.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd><code>NOVAS_FULL_ACCURACY</code> frames require a high-precision ephemeris provider for the major planets, e.g. to account for the gravitational deflections. Without it, &mu;as accuracy cannot be ensured, in general. See section on <a class="el" href="#solarsystem">Incorporating Solar-system ephemeris data or services</a> further below.</dd></dl>
<p><a class="anchor" id="apparent-place"></a> </p>
<h4><a class="anchor" id="autotoc_md100"></a>
Calculate an apparent place on sky</h4>
<p>Now we can calculate the apparent R.A. and declination for our source, which includes proper motion (for sidereal sources) or light-time correction (for Solar-system bodies), and also aberration corrections for the moving observer and gravitational deflection around the major Solar System bodies (in full accuracy mode). You can calculate an apparent location in the coordinate system of choice (ICRS/GCRS, CIRS, J2000, MOD, TOD, TIRS, or ITRS) using <code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code>. E.g.:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structsky__pos.html">sky_pos</a> apparent;    <span class="comment">// Structure containing the precise observed position</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f">novas_sky_pos</a>(&amp;source, &amp;obs_frame, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, &amp;apparent);</div>
<div class="ttc" id="agroup__apparent_html_gac365a1e015ae1f875dc5a66fd5435b2f"><div class="ttname"><a href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f">novas_sky_pos</a></div><div class="ttdeci">int novas_sky_pos(const object *restrict object, const novas_frame *restrict frame, enum novas_reference_system sys, sky_pos *restrict out)</div><div class="ttdoc">Calculates an apparent location on sky for the source.</div><div class="ttdef"><b>Definition</b> frames.c:832</div></div>
<div class="ttc" id="agroup__equatorial_html_gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044"><div class="ttname"><a href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a></div><div class="ttdeci">@ NOVAS_CIRS</div><div class="ttdoc">Celestial Intermediate Reference System: dynamical system of the true equator, with its origin at the...</div><div class="ttdef"><b>Definition</b> novas.h:763</div></div>
<div class="ttc" id="astructsky__pos_html"><div class="ttname"><a href="structsky__pos.html">sky_pos</a></div><div class="ttdoc">Celestial object&#39;s place on the sky; contains the output from place()</div><div class="ttdef"><b>Definition</b> novas.h:1591</div></div>
</div><!-- fragment --><p>Apart from providing precise apparent R.A. and declination coordinates, the <code><a class="el" href="structsky__pos.html" title="Celestial object&#39;s place on the sky; contains the output from place()">sky_pos</a></code> structure also provides the <em>x,y,z</em> unit vector pointing in the observed direction of the source (in the designated coordinate system). We also get radial velocity (for spectroscopy), and apparent distance for Solar-system bodies (e.g. for apparent-to-physical size conversion).</p>
<dl class="section note"><dt>Note</dt><dd>If you want geometric positions (and/or velocities) instead, without aberration and gravitational deflection, you might use <code><a class="el" href="group__geometric.html#gac6652ee3257621080dac342313d0a0a7" title="Calculates the geometric position and velocity vectors, relative to the observer, for a source in the...">novas_geom_posvel()</a></code>.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>Regardless, which reference system you have used in the calculations above, you can always easily and efficiently change the coordinate reference system in which your results are expressed, by creating an appropriate transform via <code><a class="el" href="group__frame.html#ga4d179c8573319fc25c775ce56ba055dc" title="Calculates a transformation matrix that can be used to convert positions and velocities from one coor...">novas_make_transform()</a></code> and then using <code><a class="el" href="group__geometric.html#gaa77895c891e9eeb4b1541f03acfd154e" title="Transforms a position or velocity 3-vector from one coordinate reference system to another.">novas_transform_vector()</a></code> or <code>novas_transform_skypos()</code>. More on <a class="el" href="#transforms">coordinate transforms</a> further below.</dd></dl>
<p><a class="anchor" id="horizontal-place"></a> </p>
<h4><a class="anchor" id="autotoc_md101"></a>
Calculate azimuth and elevation angles at the observing location</h4>
<p>If your ultimate goal is to calculate the azimuth and elevation angles of the source at the specified observing location, you can proceed from the <code><a class="el" href="structsky__pos.html" title="Celestial object&#39;s place on the sky; contains the output from place()">sky_pos</a></code> data you obtained above (in whichever coordinate system!):</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> az, el;   <span class="comment">// [deg] local azimuth and elevation angles to populate</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert the apparent position in CIRS on sky to horizontal coordinates</span></div>
<div class="line"><a class="code hl_function" href="group__apparent.html#ga3cd947f2e48d6c5cc88ad7a1bab9b8ca">novas_app_to_hor</a>(&amp;obs_frame, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, apparent.<a class="code hl_variable" href="structsky__pos.html#a713a0c71a86d92fa6892fdb2cb7c9422">ra</a>, apparent.<a class="code hl_variable" href="structsky__pos.html#ac4ae7989694321b540abb75c30eec690">dec</a>, <a class="code hl_function" href="group__refract.html#gab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a>, </div>
<div class="line">  &amp;az, &amp;el);</div>
<div class="ttc" id="agroup__apparent_html_ga3cd947f2e48d6c5cc88ad7a1bab9b8ca"><div class="ttname"><a href="group__apparent.html#ga3cd947f2e48d6c5cc88ad7a1bab9b8ca">novas_app_to_hor</a></div><div class="ttdeci">int novas_app_to_hor(const novas_frame *restrict frame, enum novas_reference_system sys, double ra, double dec, RefractionModel ref_model, double *restrict az, double *restrict el)</div><div class="ttdoc">Converts an observed apparent position vector in the specified coordinate system to local horizontal ...</div><div class="ttdef"><b>Definition</b> frames.c:999</div></div>
<div class="ttc" id="agroup__refract_html_gab04bff3b97c132e358e11c3a5b7a3081"><div class="ttname"><a href="group__refract.html#gab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a></div><div class="ttdeci">double novas_standard_refraction(double jd_tt, const on_surface *loc, enum novas_refraction_type type, double el)</div><div class="ttdoc">Returns an optical refraction correction for a standard atmosphere.</div><div class="ttdef"><b>Definition</b> refract.c:263</div></div>
<div class="ttc" id="astructsky__pos_html_a713a0c71a86d92fa6892fdb2cb7c9422"><div class="ttname"><a href="structsky__pos.html#a713a0c71a86d92fa6892fdb2cb7c9422">sky_pos::ra</a></div><div class="ttdeci">double ra</div><div class="ttdoc">[h] apparent, topocentric, or astrometric right ascension (hours)</div><div class="ttdef"><b>Definition</b> novas.h:1593</div></div>
<div class="ttc" id="astructsky__pos_html_ac4ae7989694321b540abb75c30eec690"><div class="ttname"><a href="structsky__pos.html#ac4ae7989694321b540abb75c30eec690">sky_pos::dec</a></div><div class="ttdeci">double dec</div><div class="ttdoc">[deg] apparent, topocentric, or astrometric declination (degrees)</div><div class="ttdef"><b>Definition</b> novas.h:1594</div></div>
</div><!-- fragment --><p>Above we converted the apparent coordinates, that were calculated in CIRS, to refracted azimuth and elevation coordinates at the observing location, using the <code><a class="el" href="group__refract.html#gab04bff3b97c132e358e11c3a5b7a3081" title="Returns an optical refraction correction for a standard atmosphere.">novas_standard_refraction()</a></code> function to provide a suitable refraction correction. We could have used <code><a class="el" href="group__refract.html#gae4511a80a1defbb1e1fdc29c289e7de4" title="Returns an optical refraction correction using the weather parameters defined for the observer locati...">novas_optical_refraction()</a></code> instead to use the weather data embedded in the frame's <code>observer</code> structure, or some user-defined refraction model, or else <code>NULL</code> to calculate unrefracted elevation angles.</p>
<p><a class="anchor" id="reverse-place"></a> </p>
<h4><a class="anchor" id="autotoc_md102"></a>
Going in reverse...</h4>
<p>Of course, <b>SuperNOVAS</b> allows you to go in reverse, for example from an observed Az/El position all the way to proper ICRS R.A./Dec coordinates.</p>
<p>E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> az = ..., el = ...; <span class="comment">// [deg] measured azimuth and elevation angles</span></div>
<div class="line"><span class="keywordtype">double</span> pos[3];             <span class="comment">// [arb. u.] xyz position vector</span></div>
<div class="line"><span class="keywordtype">double</span> ra, dec;            <span class="comment">// [h, deg] R.A. and declination to populate</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate the observer&#39;s apparent coordinates from the observed Az/El values,</span></div>
<div class="line"><span class="comment">// lets say in CIRS (but it could also be ICRS, for all that matters). </span></div>
<div class="line"><a class="code hl_function" href="group__nonequatorial.html#gaa57cbcae2001fece2ee4a2babfbc5f89">novas_hor_to_app</a>(&amp;obs_frame, az, el, <a class="code hl_function" href="group__refract.html#gab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a>, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, &amp;ra, &amp;dec);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert apparent to ICRS geometric positions (no parallax)</span></div>
<div class="line"><a class="code hl_function" href="group__apparent.html#gab7db8026c598e8e126a4725ac3b388bf">novas_app_to_geom</a>(&amp;obs_frame, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, ra, dec, 0.0, pos);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert ICRS rectangular equatorial to R.A. and Dec</span></div>
<div class="line"><a class="code hl_function" href="group__util.html#ga84f672dc1c37e3af374198f29cbcfba9">vector2radec</a>(pos, &amp;ra, &amp;dec);</div>
<div class="ttc" id="agroup__apparent_html_gab7db8026c598e8e126a4725ac3b388bf"><div class="ttname"><a href="group__apparent.html#gab7db8026c598e8e126a4725ac3b388bf">novas_app_to_geom</a></div><div class="ttdeci">int novas_app_to_geom(const novas_frame *restrict frame, enum novas_reference_system sys, double ra, double dec, double dist, double *restrict geom_icrs)</div><div class="ttdoc">Converts an observed apparent sky position of a source to an ICRS geometric position,...</div><div class="ttdef"><b>Definition</b> frames.c:1184</div></div>
<div class="ttc" id="agroup__nonequatorial_html_gaa57cbcae2001fece2ee4a2babfbc5f89"><div class="ttname"><a href="group__nonequatorial.html#gaa57cbcae2001fece2ee4a2babfbc5f89">novas_hor_to_app</a></div><div class="ttdeci">int novas_hor_to_app(const novas_frame *restrict frame, double az, double el, RefractionModel ref_model, enum novas_reference_system sys, double *restrict ra, double *restrict dec)</div><div class="ttdoc">Converts an observed azimuth and elevation coordinate to right ascension (R.A.) and declination coord...</div><div class="ttdef"><b>Definition</b> frames.c:1094</div></div>
<div class="ttc" id="agroup__util_html_ga84f672dc1c37e3af374198f29cbcfba9"><div class="ttname"><a href="group__util.html#ga84f672dc1c37e3af374198f29cbcfba9">vector2radec</a></div><div class="ttdeci">short vector2radec(const double *restrict pos, double *restrict ra, double *restrict dec)</div><div class="ttdoc">Converts an vector in equatorial rectangular coordinates to equatorial spherical coordinates.</div><div class="ttdef"><b>Definition</b> util.c:482</div></div>
</div><!-- fragment --><p>Voila! And, of course you might want the coordinates in some other reference systems, such as B1950. For that you can simply add a transformation before <code><a class="el" href="group__util.html#ga84f672dc1c37e3af374198f29cbcfba9" title="Converts an vector in equatorial rectangular coordinates to equatorial spherical coordinates.">vector2radec()</a></code> above, e.g. as:</p>
<div class="fragment"><div class="line">...</div>
<div class="line"><span class="comment">// Transform position from ICRS to B1950</span></div>
<div class="line">gcrs_to_mod(<a class="code hl_define" href="group__time.html#ga3785083ae52bbbc1e749dbedd7e5d85e">NOVAS_JD_B1950</a>, pos, pos);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert B1950 xyz position to R.A. and Dec</span></div>
<div class="line"><a class="code hl_function" href="group__util.html#ga84f672dc1c37e3af374198f29cbcfba9">vector2radec</a>(pos, &amp;ra, &amp;dec);</div>
<div class="ttc" id="agroup__time_html_ga3785083ae52bbbc1e749dbedd7e5d85e"><div class="ttname"><a href="group__time.html#ga3785083ae52bbbc1e749dbedd7e5d85e">NOVAS_JD_B1950</a></div><div class="ttdeci">#define NOVAS_JD_B1950</div><div class="ttdoc">[day] Julian date at B1950 (NASA / NAIF SPICE definition) precession(), transform_cat()</div><div class="ttdef"><b>Definition</b> novas.h:161</div></div>
</div><!-- fragment --><p><a class="anchor" id="rise-set-transit"></a> </p>
<h4><a class="anchor" id="autotoc_md103"></a>
Calculate rise, set, and transit times</h4>
<p>You may be interested to know when sources rise above or set below some specific elevation angle, or at what time they appear to transit at the observer location. <b>SuperNOVAS</b> has routines to help you with that too.</p>
<p>Given that rise, set, or transit times are dependent on the day of observation, and observer location, they are effectively tied to an observer frame.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__frame.html">novas_frame</a> frame = ...;  <span class="comment">// Earth-based observer location and lower-bound time of interest.</span></div>
<div class="line"><span class="keywordtype">object</span> source = ...;      <span class="comment">// Source of interest</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// UTC-based Julian day *after* observer frame, when source rises above 30 degrees of elevation </span></div>
<div class="line"><span class="comment">// next, given a standard optical refraction model.</span></div>
<div class="line"><span class="keywordtype">double</span> jd_rise = <a class="code hl_function" href="group__time.html#gaaf38f64304fa0b00c9c56cead62043f3">novas_rises_above</a>(30.0, &amp;source, &amp;frame, <a class="code hl_function" href="group__refract.html#gab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// UTC-based Julian day *after* observer frame, of next source transit</span></div>
<div class="line"><span class="keywordtype">double</span> jd_transit = <a class="code hl_function" href="group__time.html#gad04f1ebd7b2d39e5258b152fec231001">novas_transit_time</a>(&amp;source, &amp;frame);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// UTC-based Julian day *after* observer frame, when source sets below 30 degrees of elevation </span></div>
<div class="line"><span class="comment">// next, not accounting for refraction.</span></div>
<div class="line"><span class="keywordtype">double</span> jd_rise = <a class="code hl_function" href="group__time.html#ga23af09cd8e5ec5ef4d0b03a347a4add0">novas_sets_below</a>(30.0, &amp;source, &amp;frame, NULL);</div>
<div class="ttc" id="agroup__time_html_ga23af09cd8e5ec5ef4d0b03a347a4add0"><div class="ttname"><a href="group__time.html#ga23af09cd8e5ec5ef4d0b03a347a4add0">novas_sets_below</a></div><div class="ttdeci">double novas_sets_below(double el, const object *restrict source, const novas_frame *restrict frame, RefractionModel ref_model)</div><div class="ttdoc">Returns the UTC date at which a distant source appears to set below the specified elevation angle.</div><div class="ttdef"><b>Definition</b> frames.c:1717</div></div>
<div class="ttc" id="agroup__time_html_gaaf38f64304fa0b00c9c56cead62043f3"><div class="ttname"><a href="group__time.html#gaaf38f64304fa0b00c9c56cead62043f3">novas_rises_above</a></div><div class="ttdeci">double novas_rises_above(double el, const object *restrict source, const novas_frame *restrict frame, RefractionModel ref_model)</div><div class="ttdoc">Returns the UTC date at which a distant source appears to rise above the specified elevation angle.</div><div class="ttdef"><b>Definition</b> frames.c:1677</div></div>
<div class="ttc" id="agroup__time_html_gad04f1ebd7b2d39e5258b152fec231001"><div class="ttname"><a href="group__time.html#gad04f1ebd7b2d39e5258b152fec231001">novas_transit_time</a></div><div class="ttdeci">double novas_transit_time(const object *restrict source, const novas_frame *restrict frame)</div><div class="ttdoc">Returns the UTC date at which a source transits the local meridian.</div><div class="ttdef"><b>Definition</b> frames.c:1642</div></div>
</div><!-- fragment --><p>Note, that in the current implementation these calls are not well suited sources that are at or within the geostationary orbit, such as such as Low Earth Orbit satellites (LEOs), geostationary satellites (which never really rise, set, or transit), or some Near Earth Objects (NEOs), which will rise set multiple times per day. For the latter, the above calls may still return a valid time, only without the guarantee that it is the time of the first such event after the specified frame instant. A future implementation may address near-Earth orbits better, so stay tuned for updates.</p>
<p><a class="anchor" id="solsys-example"></a> </p>
<h3><a class="anchor" id="autotoc_md104"></a>
Calculating positions for a Solar-system source</h3>
<p>Solar-system sources work similarly to the above with a few important differences at the start.</p>
<h4><a class="anchor" id="autotoc_md105"></a>
Planets and/or ephemeris type objects</h4>
<p>Historically, NOVAS divided Solar-system objects into two categories: (1) major planets (including also the Sun, the Moon, and the Solar-system Barycenter); and (2) 'ephemeris' type objects, which are all other Solar-system objects. The main difference is the numbering convention. NOVAS major planets have definitive ID numbers (see <code>enum <a class="el" href="group__source.html#ga219df36b21dc4476656e708d14d08045" title="Enumeration for the &#39;major planet&#39; numbers in NOVAS to use as the solar-system body number whenever t...">novas_planet</a></code>), whereas 'ephemeris' objects have user-defined IDs. They are also handled by two separate adapter functions (although <b>SuperNOVAS</b> has the option of using the same ephemeris provider for both types of objects also).</p>
<p>Thus, instead of <code><a class="el" href="group__source.html#gab9b7a622486f2904615ceed1ba94cd8f" title="Populates and object data structure with the data for a catalog source.">make_cat_object()</a></code> you define your source as a planet or ephemeris type <code>object</code> with a name or ID number that is used by the ephemeris service you provided. For major planets you might want to use <code><a class="el" href="group__source.html#ga4c7846be95299769f4d0377bf127bcf5" title="Sets a celestial object to be a major planet, or the Sun, Moon, Solar-system Barycenter,...">make_planet()</a></code>, if they use a <code><a class="el" href="group__solar-system.html#gaae2b06af367d7b0a70a8b89c258b00b0" title="Provides the position and velocity of major planets (as well as the Sun, Moon, Solar-system Barycente...">novas_planet_provider</a></code> function to access ephemeris data with their NOVAS IDs, or else <code><a class="el" href="group__source.html#gaa22303f98df2d63edf6d8452ff3a43b2" title="Sets a celestial object to be a Solar-system ephemeris body.">make_ephem_object()</a></code> for more generic ephemeris handling via a user-provided <code><a class="el" href="group__solar-system.html#gaebb3d71006e8d93de242df61510374ad" title="Function to obtain ephemeris data for minor planets, which are not handled by the solarsystem() type ...">novas_ephem_provider</a></code>. E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> mars, ceres; <span class="comment">// Hold data on solar-system bodies.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Mars will be handled by the planet provider function</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga4c7846be95299769f4d0377bf127bcf5">make_planet</a>(<a class="code hl_enumvalue" href="group__source.html#gga219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a>, &amp;mars);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Ceres will be handled by the generic ephemeris provider function, which let&#39;s say </span></div>
<div class="line"><span class="comment">// uses the NAIF ID of 2000001 _or_ the name &#39;Ceres&#39; (depending on the implementation)</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#gaa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a>(<span class="stringliteral">&quot;Ceres&quot;</span>, 2000001, &amp;ceres);</div>
<div class="ttc" id="agroup__source_html_ga4c7846be95299769f4d0377bf127bcf5"><div class="ttname"><a href="group__source.html#ga4c7846be95299769f4d0377bf127bcf5">make_planet</a></div><div class="ttdeci">int make_planet(enum novas_planet num, object *restrict planet)</div><div class="ttdoc">Sets a celestial object to be a major planet, or the Sun, Moon, Solar-system Barycenter,...</div><div class="ttdef"><b>Definition</b> target.c:460</div></div>
<div class="ttc" id="agroup__source_html_gaa22303f98df2d63edf6d8452ff3a43b2"><div class="ttname"><a href="group__source.html#gaa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a></div><div class="ttdeci">int make_ephem_object(const char *name, long num, object *body)</div><div class="ttdoc">Sets a celestial object to be a Solar-system ephemeris body.</div><div class="ttdef"><b>Definition</b> target.c:683</div></div>
<div class="ttc" id="agroup__source_html_gga219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e"><div class="ttname"><a href="group__source.html#gga219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a></div><div class="ttdeci">@ NOVAS_MARS</div><div class="ttdoc">Major planet number for Mars in NOVAS.</div><div class="ttdef"><b>Definition</b> novas.h:498</div></div>
</div><!-- fragment --><dl class="section important"><dt>Important</dt><dd>Before you can handle all major planets and other ephemeris objects this way, you will have to provide one or more functions to obtain the barycentric ICRS positions for your Solar-system source(s) of interest for the specific Barycentric Dynamical Time (TDB) of observation. See section on <a class="el" href="#solarsystem">Incorporating Solar-system ephemeris data or services</a>.</dd></dl>
<p>And then, it's the same spiel as before, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f">novas_sky_pos</a>(&amp;mars, &amp;obs_frame, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3">NOVAS_TOD</a>, &amp;apparent);</div>
<div class="line"><span class="keywordflow">if</span>(status) {</div>
<div class="line">  <span class="comment">// Oops, something went wrong...</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__equatorial_html_gga7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3"><div class="ttname"><a href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3">NOVAS_TOD</a></div><div class="ttdeci">@ NOVAS_TOD</div><div class="ttdoc">True equinox Of Date: dynamical system of the &#39;true&#39; equator, with its origin at the &#39;true&#39; equinox (...</div><div class="ttdef"><b>Definition</b> novas.h:759</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md106"></a>
Solar-system objects with Keplerian orbital parameters</h4>
<p>As of version <b>1.2</b> you can also define solar system sources with Keplerian orbital elements (such as the most up-to-date ones provided by the <a href="https://minorplanetcenter.net/data">Minor Planet Center</a> for asteroids, comets, etc.):</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> NEA;        <span class="comment">// e.g. a Near-Earth Asteroid</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fill in the orbital parameters (pay attention to units!)</span></div>
<div class="line"><a class="code hl_struct" href="structnovas__orbital.html">novas_orbital</a> orbit = <a class="code hl_define" href="group__source.html#ga85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a>;</div>
<div class="line">orbit.<a class="code hl_variable" href="structnovas__orbital.html#a1031d0e0a97a340abfe0a6ab9e831045">a</a> = ...;         <span class="comment">// Major axis in AU...</span></div>
<div class="line">...                    <span class="comment">// ... and the rest of the orbital elements</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an object for that orbit</span></div>
<div class="line"><a class="code hl_function" href="group__source.html#ga3c5e215babeeba078ca7b3e9be42e555">make_orbital_object</a>(<span class="stringliteral">&quot;NEAxxx&quot;</span>, -1, &amp;orbit, &amp;NEA);</div>
<div class="ttc" id="agroup__source_html_ga3c5e215babeeba078ca7b3e9be42e555"><div class="ttname"><a href="group__source.html#ga3c5e215babeeba078ca7b3e9be42e555">make_orbital_object</a></div><div class="ttdeci">int make_orbital_object(const char *name, long num, const novas_orbital *orbit, object *body)</div><div class="ttdoc">Sets a celestial object to be a Solar-system orbital body.</div><div class="ttdef"><b>Definition</b> target.c:706</div></div>
<div class="ttc" id="agroup__source_html_ga85243a6b9eee259d3fb84ee1a587e065"><div class="ttname"><a href="group__source.html#ga85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a></div><div class="ttdeci">#define NOVAS_ORBIT_INIT</div><div class="ttdoc">Initializer for novas_orbital for heliocentric orbits using GCRS ecliptic parametrization.</div><div class="ttdef"><b>Definition</b> novas.h:1301</div></div>
<div class="ttc" id="astructnovas__orbital_html"><div class="ttname"><a href="structnovas__orbital.html">novas_orbital</a></div><div class="ttdoc">Keplerian orbital elements for NOVAS_ORBITAL_OBJECT type.</div><div class="ttdef"><b>Definition</b> novas.h:1270</div></div>
<div class="ttc" id="astructnovas__orbital_html_a1031d0e0a97a340abfe0a6ab9e831045"><div class="ttname"><a href="structnovas__orbital.html#a1031d0e0a97a340abfe0a6ab9e831045">novas_orbital::a</a></div><div class="ttdeci">double a</div><div class="ttdoc">[AU] semi-major axis</div><div class="ttdef"><b>Definition</b> novas.h:1273</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Even with orbital elements, you will, in general, still require an ephemeris provider also, to obtain precise positions for the Sun, an Earth-based observer, or the planet, around which the orbit is defined.</dd></dl>
<h4><a class="anchor" id="autotoc_md107"></a>
Approximate planet and Moon orbitals</h4>
<p>Finally, as of version <b>1.4</b>, you might generate approximate (arcmin-level) orbitals for the major planets (but not Earth!), the Moon, and the Earth-Moon Barycenter (EMB) also. E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> jd_tdb = ... <span class="comment">// Time (epoch) for which to calculate orbital parameters  </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Planet orbitals, e.g. for Mars</span></div>
<div class="line"><a class="code hl_struct" href="structnovas__orbital.html">novas_orbital</a> mars_orbit = <a class="code hl_define" href="group__source.html#ga85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a>;</div>
<div class="line"><a class="code hl_function" href="group__source.html#ga63b094e813d8b752a6f3344419e80031">novas_make_planet_orbit</a>(<a class="code hl_enumvalue" href="group__source.html#gga219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a>, jd_tdb, &amp;mars_orbit);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Moon&#39;s orbital around Earth</span></div>
<div class="line"><a class="code hl_struct" href="structnovas__orbital.html">novas_orbital</a> moon_orbit = <a class="code hl_define" href="group__source.html#ga85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a>;</div>
<div class="line"><a class="code hl_function" href="group__source.html#gad6e6c7f6dc2745030e3fd4d407e982bd">novas_make_moon_orbit</a>(jd_tdb, &amp;moon_orbit);</div>
<div class="ttc" id="agroup__source_html_ga63b094e813d8b752a6f3344419e80031"><div class="ttname"><a href="group__source.html#ga63b094e813d8b752a6f3344419e80031">novas_make_planet_orbit</a></div><div class="ttdeci">int novas_make_planet_orbit(enum novas_planet id, double jd_tdb, novas_orbital *restrict orbit)</div><div class="ttdoc">Get approximate current heliocentric orbital elements for the major planets.</div><div class="ttdef"><b>Definition</b> planets.c:112</div></div>
<div class="ttc" id="agroup__source_html_gad6e6c7f6dc2745030e3fd4d407e982bd"><div class="ttname"><a href="group__source.html#gad6e6c7f6dc2745030e3fd4d407e982bd">novas_make_moon_orbit</a></div><div class="ttdeci">int novas_make_moon_orbit(double jd_tdb, novas_orbital *restrict orbit)</div><div class="ttdoc">Gets an approximation of the current Keplerian orbital elements for the Moon relative to the geocente...</div><div class="ttdef"><b>Definition</b> planets.c:411</div></div>
</div><!-- fragment --><p>While the planet and Moon orbitals are not suitable for precision applications, they can be useful for determining approximate positions (e.g. via the <code><a class="el" href="group__geometric.html#ga9ead627eed7fabd8583f1353e89f42e7" title="Returns the approximate geometric heliocentric orbital positions and velocities for the major planets...">novas_approx_heliocentric()</a></code> and <code><a class="el" href="group__apparent.html#ga4cb01609f76b0ff8487817b9446a3a62" title="Calculates an approximate apparent location on sky for a major planet, Sun, Moon, Earth-Moon Barycent...">novas_approx_sky_pos()</a></code> functions), and for rise/set time calculations.</p>
<p><a class="anchor" id="transforms"></a> </p>
<h3><a class="anchor" id="autotoc_md108"></a>
Coordinate and velocity transforms (change of coordinate system)</h3>
<p><b>SuperNOVAS</b> introduces matrix transforms (correctly since version <b>1.4</b>), which can take a position or velocity vector (geometric or apparent), obtained for an observer frame, from one coordinate system to another efficiently. E.g.:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__frame.html">novas_frame</a> frame = ...       <span class="comment">// The observer frame (time and location)</span></div>
<div class="line"><span class="keywordtype">double</span> j2000_vec[3] = ...;    <span class="comment">// IN: original position vector, say in J2000.</span></div>
<div class="line"><span class="keywordtype">double</span> tirs_vec[3] = {0.0};   <span class="comment">// OUT: equivalent vector in TIRS we want to obtain</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structnovas__transform.html">novas_transform</a> T;            <span class="comment">// Coordinate transformation data</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate the transformation matrix from J2000 to TIRS in the given observer frame.</span></div>
<div class="line"><a class="code hl_function" href="group__frame.html#ga4d179c8573319fc25c775ce56ba055dc">novas_make_transform</a>(&amp;frame, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9">NOVAS_J2000</a>, <a class="code hl_enumvalue" href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651ea524041fc2059f8432b76fad1b8edb89f">NOVAS_TIRS</a>, &amp;T);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Transform the J2000 position or velocity vector to TIRS...</span></div>
<div class="line"><a class="code hl_function" href="group__geometric.html#gaa77895c891e9eeb4b1541f03acfd154e">novas_transform_vector</a>(j2000_vec, &amp;T, tirs_vec);</div>
<div class="ttc" id="agroup__equatorial_html_gga7ba038ea34eb901ccfb8f785708c651ea524041fc2059f8432b76fad1b8edb89f"><div class="ttname"><a href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651ea524041fc2059f8432b76fad1b8edb89f">NOVAS_TIRS</a></div><div class="ttdeci">@ NOVAS_TIRS</div><div class="ttdoc">Terrestrial Intermediate Reference System.</div><div class="ttdef"><b>Definition</b> novas.h:783</div></div>
<div class="ttc" id="agroup__equatorial_html_gga7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9"><div class="ttname"><a href="group__equatorial.html#gga7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9">NOVAS_J2000</a></div><div class="ttdeci">@ NOVAS_J2000</div><div class="ttdoc">The J2000 dynamical reference system.</div><div class="ttdef"><b>Definition</b> novas.h:771</div></div>
<div class="ttc" id="agroup__frame_html_ga4d179c8573319fc25c775ce56ba055dc"><div class="ttname"><a href="group__frame.html#ga4d179c8573319fc25c775ce56ba055dc">novas_make_transform</a></div><div class="ttdeci">int novas_make_transform(const novas_frame *frame, enum novas_reference_system from_system, enum novas_reference_system to_system, novas_transform *transform)</div><div class="ttdoc">Calculates a transformation matrix that can be used to convert positions and velocities from one coor...</div><div class="ttdef"><b>Definition</b> frames.c:1257</div></div>
<div class="ttc" id="agroup__geometric_html_gaa77895c891e9eeb4b1541f03acfd154e"><div class="ttname"><a href="group__geometric.html#gaa77895c891e9eeb4b1541f03acfd154e">novas_transform_vector</a></div><div class="ttdeci">int novas_transform_vector(const double *in, const novas_transform *restrict transform, double *out)</div><div class="ttdoc">Transforms a position or velocity 3-vector from one coordinate reference system to another.</div><div class="ttdef"><b>Definition</b> frames.c:1434</div></div>
<div class="ttc" id="astructnovas__transform_html"><div class="ttname"><a href="structnovas__transform.html">novas_transform</a></div><div class="ttdoc">A transformation between two astronomical coordinate systems for the same observer location and time.</div><div class="ttdef"><b>Definition</b> novas.h:1829</div></div>
</div><!-- fragment --><p>Transformations support all <b>SupeNOVAS</b> reference systems, that is ICRS/GCRS, J2000, TOD, MOD, CIRS, TIRS, and ITRS. The same transform can also be used to convert apparent positions in a <code><a class="el" href="structsky__pos.html" title="Celestial object&#39;s place on the sky; contains the output from place()">sky_pos</a></code> structure also, e.g.:</p>
<div class="fragment"><div class="line">...</div>
<div class="line"> </div>
<div class="line">sky_pos j2000_pos = ...        <span class="comment">// IN: in J2000, e.g. via novas_sky_pos()...</span></div>
<div class="line"><a class="code hl_struct" href="structsky__pos.html">sky_pos</a> tirs_pos;              <span class="comment">// OUT: equivalent TIRS position to calculate...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Transform the J2000 apparent positions to TIRS....</span></div>
<div class="line"><a class="code hl_function" href="group__apparent.html#gacfcfb90637cd1fdb25ef9afd1bda8e30">novas_transform_sky_pos</a>(&amp;j2000_pos, &amp;T, &amp;tirs_pos);</div>
<div class="ttc" id="agroup__apparent_html_gacfcfb90637cd1fdb25ef9afd1bda8e30"><div class="ttname"><a href="group__apparent.html#gacfcfb90637cd1fdb25ef9afd1bda8e30">novas_transform_sky_pos</a></div><div class="ttdeci">int novas_transform_sky_pos(const sky_pos *in, const novas_transform *restrict transform, sky_pos *out)</div><div class="ttdoc">Transforms a position or velocity 3-vector from one coordinate reference system to another.</div><div class="ttdef"><b>Definition</b> frames.c:1460</div></div>
</div><!-- fragment --><hr  />
<p><a class="anchor" id="solarsystem"></a> </p>
<h2><a class="anchor" id="autotoc_md110"></a>
Incorporating Solar-system ephemeris data or services</h2>
<p>If you want to use <b>SuperNOVAS</b> to calculate positions for a range of Solar-system objects, and/or to do it with precision, you will have to interface it to a suitable provider of ephemeris data. The preferred ways to do that in <b>SuperNOVAS</b> enumerated below. (The legacy NOVAS C ways are not covered here, since they require specialized builds of <b>SuperNOVAS</b>, which are covered <a class="el" href="#legacy-application">further above</a>.)</p>
<p>NASA/JPL provides <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/">generic ephemerides</a> for the major planets, satellites thereof, the 300 largest asteroids, the Lagrange points, and some Earth orbiting stations. For example, <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de440.bsp">DE440</a> covers the major planets, and the Sun, Moon, and barycenters for times between 1550 AD and 2650 AD. Or, you can use the <a href="https://ssd.jpl.nasa.gov/horizons/">JPL HORIZONS</a> system (via the command-line / telnet or API interfaces) to generate custom ephemerides (SPK/BSP) for just about all known solar systems bodies, down to the tiniest rocks.</p>
<ul>
<li><a class="el" href="#calceph-integration">CALCEPH integration</a></li>
<li><a class="el" href="#cspice-integration">NAIF CSPICE toolkit integration</a></li>
<li><a class="el" href="#universal-ephemerides">Universal ephemeris data / service integration</a></li>
</ul>
<p><a class="anchor" id="calceph-integration"></a> </p>
<h3><a class="anchor" id="autotoc_md111"></a>
CALCEPH integration</h3>
<p>The <a href="https://www.imcce.fr/recherche/equipes/asd/calceph/">CALCEPH</a> library provides easy-to-use access to JPL and INPOP ephemeris files from C/C++. As of version 1.2, we provide optional support for interfacing <b>SuperNOVAS</b> with the the CALCEPH C library for handling Solar-system objects.</p>
<details  open="true">
<summary >
Details</summary>
<p></p>
<p>Prior to building <b>SuperNOVAS</b> simply set <code>CALCEPH_SUPPORT</code> to 1 in <code>config.mk</code> or in your environment (or for CMake configure with the <code>-DENABLE_CALCEPH=ON</code>). Depending on the build target (or type), it will build <code>libsolsys-calceph.so[.1]</code> (target <code>shared</code> or CMake option <code>-DBUILD_SHARED_LIBS=ON1</code>) or <code>libsolsys-calceph.a</code> (target <code>static</code> or default CMake build) libraries or <code>solsys-calceph.o</code> (target <code>solsys</code>, no CMake equivalent), which provide the <code><a class="el" href="group__solar-system.html#ga35fc86a939602ec910dbdfde180d7f31" title="Sets a ephemeris provider for Solar-system objects using the CALCEPH C library and the specified set ...">novas_use_calceph()</a></code> and <code><a class="el" href="group__solar-system.html#gab86ec03898e658c86c671a8b6399e331" title="Sets the CALCEPH C library and the specified ephemeris data as the ephemeris provider for the major p...">novas_use_calceph_planets()</a></code>, and <code><a class="el" href="group__solar-system.html#ga5531b937a5bb5491cb475d2536346ad8" title="Sets the type of Solar-system body IDs to use as object.number with NOVAS_EPHEM_OBJECT types.">novas_calceph_use_ids()</a></code> functions.</p>
<p>Of course, you will need access to the CALCEPH C development files (C headers and unversioned <code>libcalceph.so</code> or <code>.a</code> library) for the build to succeed. Here is an example on how you'd use CALCEPH with <b>SuperNOVAS</b> in your application code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas-calceph_8h.html">novas-calceph.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can open a set of JPL/INPOP ephemeris files with CALCEPH...</span></div>
<div class="line">t_calcephbin *eph = calceph_open_array(...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then use them as your generic SuperNOVAS ephemeris provider</span></div>
<div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="group__solar-system.html#ga35fc86a939602ec910dbdfde180d7f31">novas_use_calceph</a>(eph);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// Oops something went wrong...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Optionally you may use a separate ephemeris dataset for major planets</span></div>
<div class="line"><span class="comment">// (or if planet ephemeris was included in &#39;eph&#39; above, you don&#39;t have to) </span></div>
<div class="line">t_calcephbin *pleph = calceph_open(...);</div>
<div class="line">status = <a class="code hl_function" href="group__solar-system.html#gab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets</a>(pleph);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// Oops something went wrong...</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__solar-system_html_ga35fc86a939602ec910dbdfde180d7f31"><div class="ttname"><a href="group__solar-system.html#ga35fc86a939602ec910dbdfde180d7f31">novas_use_calceph</a></div><div class="ttdeci">int novas_use_calceph(t_calcephbin *eph)</div><div class="ttdoc">Sets a ephemeris provider for Solar-system objects using the CALCEPH C library and the specified set ...</div><div class="ttdef"><b>Definition</b> solsys-calceph.c:452</div></div>
<div class="ttc" id="agroup__solar-system_html_gab86ec03898e658c86c671a8b6399e331"><div class="ttname"><a href="group__solar-system.html#gab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets</a></div><div class="ttdeci">int novas_use_calceph_planets(t_calcephbin *eph)</div><div class="ttdoc">Sets the CALCEPH C library and the specified ephemeris data as the ephemeris provider for the major p...</div><div class="ttdef"><b>Definition</b> solsys-calceph.c:495</div></div>
<div class="ttc" id="anovas-calceph_8h_html"><div class="ttname"><a href="novas-calceph_8h.html">novas-calceph.h</a></div><div class="ttdoc">SuperNOVAS functions interfacing with the CALCEPH C library.</div></div>
</div><!-- fragment --><p>All modern JPL (SPK) ephemeris files should work with the <code>solsys-calceph</code> plugin. When linking your application, add <code>-lsolsys-calceph</code> to your link flags (or else link with <code>solsys-calceph.o</code>), and link against the CALCEPH library also (<code>-lcalceph</code>). That's all there is to it.</p>
<p>When using CALCEPH, ephemeris objects are referenced by their ID numbers (<code><a class="el" href="structobject.html#a7d578acc2a3e88ef2435fe0e88d01a74" title="enum novas_planet, or minor planet ID (e.g. NAIF), or star catalog ID.">object.number</a></code>), unless it is set to -1, in which case name-based lookup will be used instead. ID numbers are assumed to be NAIF by default, but <code><a class="el" href="group__solar-system.html#ga5531b937a5bb5491cb475d2536346ad8" title="Sets the type of Solar-system body IDs to use as object.number with NOVAS_EPHEM_OBJECT types.">novas_calceph_use_ids()</a></code> can select between NAIF or CALCEPH numbering systems, if necessary.</p>
<p></p>
</details>
<p><a class="anchor" id="cspice-integration"></a> </p>
<h3><a class="anchor" id="autotoc_md112"></a>
NAIF CSPICE toolkit integration</h3>
<p>The <a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF CSPICE Toolkit</a> is the canonical standard library for JPL ephemeris files from C/C++. As of version 1.2, we provide optional support for interfacing <b>SuperNOVAS</b> with CSPICE for handling Solar-system objects.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>Prior to building <b>SuperNOVAS</b> simply set <code>CSPICE_SUPPORT</code> to 1 in <code>config.mk</code> or in your environment (or for CMake configure with <code>-DENABLE_CSPICE=ON</code>). Depending on the build target, it will build <code>libsolsys-cspice.so[.1]</code> (target <code>shared</code> or CMake option <code>-DBUILD_SHARED_LIBS=ON</code>) or <code>libsolsys-cspice.a</code> (target <code>static</code> or default CMake build) libraries or <code>solsys-cspice.o</code> (target <code>solsys</code>, no CMake equivalent), which provide the <code><a class="el" href="group__solar-system.html#ga9b44218bca5fce1e9e5103494c15dde4" title="Sets CSPICE as the default ephemeris provider for all types of Solar-system objects (both NOVAS_PLANE...">novas_use_cspice()</a></code>, <code><a class="el" href="group__solar-system.html#ga943549e395b19f6a91064e3d6fa1c577" title="Sets CSPICE as the ephemeris provider for the major planets (and Sun, Moon, SSB......">novas_use_cspice_planets()</a></code>, and <code><a class="el" href="group__solar-system.html#gafb078e1df9b5b08999d24e68d7b4ecdc" title="Sets a ephemeris provider for NOVAS_EPHEM_OBJECT types using the NAIF CSPICE library.">novas_use_cspice_ephem()</a></code> functions to enable CSPICE for providing data for all Solar-system sources, or for major planets only, or for other bodies only, respectively. You can also manage the active kernels with the <code><a class="el" href="group__solar-system.html#gae02d26964099f56c375dc78172ad135b" title="Adds a SPICE kernel to the currently managed open kernels.">cspice_add_kernel()</a></code> and <code><a class="el" href="group__solar-system.html#ga38e3b3155cad3b3822fbc3e553060ab1" title="Removes a SPICE kernel from the currently managed open kernels.">cspice_remove_kernel()</a></code> functions.</p>
<p>Of course, you will need access to the CSPICE development files (C headers, installed under a <code>cspice/</code> directory of an header search location, and the unversioned <code>libcspice.so</code> or <code>.a</code> library) for the build to succeed. You may want to check out the <a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> GitHub repository to help you build CSPICE with shared libraries and dynamically linked tools.</p>
<p>Here is an example on how you might use CSPICE with <b>SuperNOVAS</b> in your application code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas-cspice_8h.html">novas-cspice.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can load the desired kernels for CSPICE</span></div>
<div class="line"><span class="comment">// E.g. load DE440s and the Mars satellites:</span></div>
<div class="line"><span class="keywordtype">int</span> status;</div>
<div class="line"> </div>
<div class="line">status = <a class="code hl_function" href="group__solar-system.html#gae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a>(<span class="stringliteral">&quot;/path/to/de440s.bsp&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// oops, the kernels must not have loaded...</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load additional kernels as needed...</span></div>
<div class="line">status = <a class="code hl_function" href="group__solar-system.html#gae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a>(<span class="stringliteral">&quot;/path/to/mar097.bsp&quot;</span>);</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then use CSPICE as your SuperNOVAS ephemeris provider</span></div>
<div class="line"><a class="code hl_function" href="group__solar-system.html#ga9b44218bca5fce1e9e5103494c15dde4">novas_use_cspice</a>();</div>
<div class="ttc" id="agroup__solar-system_html_ga9b44218bca5fce1e9e5103494c15dde4"><div class="ttname"><a href="group__solar-system.html#ga9b44218bca5fce1e9e5103494c15dde4">novas_use_cspice</a></div><div class="ttdeci">int novas_use_cspice()</div><div class="ttdoc">Sets CSPICE as the default ephemeris provider for all types of Solar-system objects (both NOVAS_PLANE...</div><div class="ttdef"><b>Definition</b> solsys-cspice.c:643</div></div>
<div class="ttc" id="agroup__solar-system_html_gae02d26964099f56c375dc78172ad135b"><div class="ttname"><a href="group__solar-system.html#gae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a></div><div class="ttdeci">int cspice_add_kernel(const char *filename)</div><div class="ttdoc">Adds a SPICE kernel to the currently managed open kernels.</div><div class="ttdef"><b>Definition</b> solsys-cspice.c:214</div></div>
<div class="ttc" id="anovas-cspice_8h_html"><div class="ttname"><a href="novas-cspice_8h.html">novas-cspice.h</a></div><div class="ttdoc">SuperNOVAS functions interfacing with the NAIF CSPICE Toolkit.</div></div>
</div><!-- fragment --><p>All JPL ephemeris data will work with the <code>solsys-cspice</code> plugin. When linking your application, add <code>-lsolsys-cspice</code> to your link flags (or else link with <code>solsys-cspice.o</code>), and of course the CSPICE library also. That's all there is to it.</p>
<p>When using CSPICE, ephemeris objects are referenced by their NAIF ID numbers (<code><a class="el" href="structobject.html#a7d578acc2a3e88ef2435fe0e88d01a74" title="enum novas_planet, or minor planet ID (e.g. NAIF), or star catalog ID.">object.number</a></code>), unless that number is set to -1, in which case name-based lookup will be used instead.</p>
<p></p>
</details>
<p><a class="anchor" id="universal-ephemerides"></a> </p>
<h3><a class="anchor" id="autotoc_md113"></a>
Universal ephemeris data / service integration</h3>
<p>Possibly the most universal way to integrate ephemeris data with <b>SuperNOVAS</b> is to write your own <code><a class="el" href="group__solar-system.html#gaebb3d71006e8d93de242df61510374ad" title="Function to obtain ephemeris data for minor planets, which are not handled by the solarsystem() type ...">novas_ephem_provider</a></code> function.</p>
<details >
<summary >
Details</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_ephem_reader(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, <span class="keywordtype">double</span> jd_tdb_high, <span class="keywordtype">double</span> jd_tdb_low, </div>
<div class="line">                    <span class="keyword">enum</span> <a class="code hl_enumeration" href="group__solar-system.html#ga208120c5fa3e12853eb37cb99d3e27be">novas_origin</a> *restrict origin, </div>
<div class="line">                    <span class="keywordtype">double</span> *restric pos, <span class="keywordtype">double</span> *restrict vel) {</div>
<div class="line">  <span class="comment">// Your custom ephemeris reader implementation here</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>which takes an object ID number (such as a NAIF), an object name, and a split TDB date (for precision) as it inputs, and returns the type of origin with corresponding ICRS position and velocity vectors in the supplied pointer locations. The function can use either the ID number or the name to identify the object or file (whatever is the most appropriate for the implementation and for the supplied parameters). The positions and velocities may be returned either relative to the SSB or relative to the heliocenter, and accordingly, your function should set the value pointed at by origin to <code>NOVAS_BARYCENTER</code> or <code>NOVAS_HELIOCENTER</code> accordingly. Positions and velocities are rectangular ICRS <em>x,y,z</em> vectors in units of AU and AU/day respectively.</p>
<p>This way you can easily integrate current ephemeris data, e.g. for the Minor Planet Center (MPC), or whatever other ephemeris service you prefer.</p>
<p></p>
</details>
<p>Once you have your adapter function, you can set it as your ephemeris service via <code><a class="el" href="group__solar-system.html#ga6097083c438a8d1872c2e00a66360030" title="Sets the function to use for obtaining position / velocity information for minor planets,...">set_ephem_provider()</a></code>:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__solar-system.html#ga6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephem_reader);</div>
</div><!-- fragment --><p>By default, your custom <code>my_ephem_reader</code> function will be used for <code>NOVAS_EPHEM_OBJECT</code> type objects only (i.e. anything other than the major planets, the Sun, Moon, Solar-system Barycenter...). But, you can use the same function for the major planets (<code>NOVAS_PLANET</code> type objects) also via:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__solar-system.html#ga9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(<a class="code hl_function" href="group__solar-system.html#ga9d0f54c0ab00827768e61a353488b0ee">planet_ephem_provider</a>);</div>
<div class="line"><a class="code hl_function" href="group__solar-system.html#ga418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(<a class="code hl_function" href="group__solar-system.html#ga93d0f96d81f3c52e05163643bd23eb7d">planet_ephem_provider_hp</a>);</div>
<div class="ttc" id="agroup__solar-system_html_ga418f45a11ce7f92ba0ef817558415640"><div class="ttname"><a href="group__solar-system.html#ga418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a></div><div class="ttdeci">int set_planet_provider_hp(novas_planet_provider_hp func)</div><div class="ttdoc">Set a custom function to use for high precision (see NOVAS_FULL_ACCURACY) ephemeris calculations inst...</div><div class="ttdef"><b>Definition</b> ephemeris.c:227</div></div>
<div class="ttc" id="agroup__solar-system_html_ga93d0f96d81f3c52e05163643bd23eb7d"><div class="ttname"><a href="group__solar-system.html#ga93d0f96d81f3c52e05163643bd23eb7d">planet_ephem_provider_hp</a></div><div class="ttdeci">short planet_ephem_provider_hp(const double jd_tdb[restrict 2], enum novas_planet body, enum novas_origin origin, double *restrict position, double *restrict velocity)</div><div class="ttdoc">Major planet ephemeris data via the same generic ephemeris provider that is configured by set_ephem_p...</div><div class="ttdef"><b>Definition</b> solsys-ephem.c:49</div></div>
<div class="ttc" id="agroup__solar-system_html_ga9904c454bc7148b42d0f927b82ea3973"><div class="ttname"><a href="group__solar-system.html#ga9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a></div><div class="ttdeci">int set_planet_provider(novas_planet_provider func)</div><div class="ttdoc">Set a custom function to use for regular precision (see NOVAS_REDUCED_ACCURACY) ephemeris calculation...</div><div class="ttdef"><b>Definition</b> ephemeris.c:190</div></div>
<div class="ttc" id="agroup__solar-system_html_ga9d0f54c0ab00827768e61a353488b0ee"><div class="ttname"><a href="group__solar-system.html#ga9d0f54c0ab00827768e61a353488b0ee">planet_ephem_provider</a></div><div class="ttdeci">short planet_ephem_provider(double jd_tdb, enum novas_planet body, enum novas_origin origin, double *restrict position, double *restrict velocity)</div><div class="ttdoc">Major planet ephemeris data via the same generic ephemeris provider that is configured by set_ephem_p...</div><div class="ttdef"><b>Definition</b> solsys-ephem.c:107</div></div>
</div><!-- fragment --><p>The above simply instructs <b>SuperNOVAS</b> to use the same ephemeris provider function for planets as what was set for <code>NOVAS_EPHEM_OBJECT</code> type objects, provided you compiled <b>SuperNOVAS</b> with <code>BUILTIN_SOLSYS_EPHEM = 1</code> (in <code>config.mk</code>), or else you link your code against <code><a class="el" href="solsys-ephem_8c.html" title="Major planet ephemeris lookup via the function, which was configured by set_ephem_provider().">solsys-ephem.c</a></code> explicitly. Easy-peasy.</p>
<p><a class="anchor" id="precision"></a> </p>
<h2><a class="anchor" id="autotoc_md114"></a>
Notes on precision</h2>
<p>Many of the (Super)NOVAS functions take an accuracy argument, which determines to what level of precision quantities are calculated. The argument can have one of two values, which correspond to typical precisions around:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>enum <a class="el" href="group__frame.html#ga3cba2735c32163fab062b1a904a83b56" title="Constants to control the precision of NOVAS nutation calculations.">novas_accuracy</a></code> value   </th><th class="markdownTableHeadLeft">Typical precision    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_REDUCED_ACCURACY</code>   </td><td class="markdownTableBodyLeft">~ 1 milli-arcsecond (mas)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NOVAS_FULL_ACCURACY</code>   </td><td class="markdownTableBodyLeft">~ 1 micro-arcsecond (&mu;as)   </td></tr>
</table>
<p>Note, that some functions will not support full accuracy calculations, unless you have provided a high-precision ephemeris provider for the major planets (and any Solar-system bodies of interest), which does not come with <b>SuperNOVAS</b> out of the box. In the absence of a suitable high-precision ephemeris provider, some functions might return an error if called with <code>NOVAS_FULL_ACCURACY</code>. (Click on the wedges next to each component to expand the details...)</p>
<h3><a class="anchor" id="autotoc_md115"></a>
Prerequisites to precise results</h3>
<p>The <b>SuperNOVAS</b> library is in principle capable of calculating positions to microarcsecond, and velocities to mm/s, precision for all types of celestial sources. However, there are certain prerequisites and practical considerations before that level of accuracy is reached. (Click on the wedge next to each heading below to expand the details.)</p>
<details >
<summary >
The IAU 2000/2006 conventions and methods</summary>
<p></p>
<p>High precision calculations will generally require that you use <b>SuperNOVAS</b> with the new IAU standard quantities and methods. The old ways were simply not suited for precision much below the milliarcsecond level. In particular, Earth orientation parameters (EOP) should be applied only for converting between TIRS and ITRS systems, and defined either with <code><a class="el" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838" title="Sets up a observing frame for a specific observer location, time of observation, and accuracy require...">novas_make_frame()</a></code> or else with <code><a class="el" href="group__nonequatorial.html#gaead87744eeb3029ce7d5ffb1801ee652" title="Corrects a vector in the ITRS (rotating Earth-fixed system) for polar motion, and also corrects the l...">wobble()</a></code>. The old ways of incorporating (global) offsets in TOD coordinates via <code><a class="el" href="equator_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole()</a></code> should be avoided.</p>
<p></p>
</details>
<details >
<summary >
Gravitational effects</summary>
<p></p>
<p>Calculations much below the milliarcsecond level will require accounting for gravitational bending around massive Solar-system bodies, and hence will require you to provide a high-precision ephemeris provider for the major planets. Without it, there is no guarantee of achieving precision below the milli-arcsecond level in general, especially when observing near the Sun or massive planets (e.g. observing Jupiter's or Saturn's moons, near conjunction with their host planet). Therefore, some functions will return with an error, if used with <code>NOVAS_FULL_ACCURACY</code> in the absence of a suitable high-precision planetary ephemeris provider.</p>
<p></p>
</details>
<details >
<summary >
Solar-system ephemeris</summary>
<p></p>
<p>Precise calculations for Solar-system sources requires precise ephemeris data for both the target object as well as for Earth, and the Sun. For the highest precision calculations you also need positions for all major planets to calculate gravitational deflection precisely. By default, <b>SuperNOVAS</b> can only provide approximate positions for the Earth and Sun (see <code><a class="el" href="group__solar-system.html#ga580f5949c8a29cdd7bf4787aee891f2b" title="Provides the position and velocity of the Earth and Sun only at epoch &#39;jd_tdb&#39; by evaluating a closed...">earth_sun_calc()</a></code>) at the tens of arcsecond level. You will need to provide a way to interface <b>SuperNOVAS</b> with a suitable ephemeris source (such as CALCEPH, or the CSPICE toolkit from JPL) to obtain precise positions for Solar-system bodies. See the <a class="el" href="#solarsystem">section further above</a> for more information how you can do that.</p>
<p></p>
</details>
<details >
<summary >
Earth orientation parameters (EOP)</summary>
<p></p>
<p>Calculating precise positions for any Earth-based observations requires precise knowledge of Earth orientation parameters (EOP) at the time of observation. Earth's pole is subject to predictable precession and nutation, but also small irregular and diurnal variations in the orientation of the rotational axis and the rotation period (a.k.a. polar wobble). You can apply the EOP values in <code><a class="el" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb" title="Sets an astronomical time to the fractional Julian Date value, defined in the specified timescale.">novas_set_time()</a></code> (for UT1-UTC), and <code><a class="el" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838" title="Sets up a observing frame for a specific observer location, time of observation, and accuracy require...">novas_make_frame()</a></code> (<em>x</em><sub>p</sub> and <em>y</em><sub>p</sub>) to improve the astrometric precision of Earth based coordinate calculations. Without the EOP values, positions for Earth-based calculations will be accurate at the tenths of arcsecond level only.</p>
<p>The <a href="https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html">IERS Bulletins</a> provide up-to-date measurements, historical data, and near-term projections for the polar offsets, the UT1-UTC time difference, and leap-seconds (UTC-TAI). For sub-milliarcsecond accuracy the values published by IERS should be interpolated before passing to the likes of <code><a class="el" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb" title="Sets an astronomical time to the fractional Julian Date value, defined in the specified timescale.">novas_set_time()</a></code> or <code><a class="el" href="group__frame.html#gadc72577f99a7b076b23e0e44ddbca838" title="Sets up a observing frame for a specific observer location, time of observation, and accuracy require...">novas_make_frame()</a></code>. At the micro-arcsecond (&mu;as) level, you will need to ensure also that the EOP values are provided for the same ITRF realization as the observer's location, e.g. via <code><a class="el" href="group__earth.html#ga3c8c9b8f709d1e5a7aa3a915f8fafcbb" title="Transforms Earth orientation parameters (xp, yp, dUT1) from one ITRF realization to another.">novas_itrf_transform_eop()</a></code>.</p>
<p></p>
</details>
<details >
<summary >
Atmospheric refraction model</summary>
<p></p>
<p>Ground based observations are subject to atmospheric refraction. <b>SuperNOVAS</b> offers the option to include refraction corrections with a set of atmospheric models. Estimating refraction accurately requires local weather parameters (pressure, temperature, and humidity), which may be be specified within the <code><a class="el" href="structon__surface.html" title="Data for an observer&#39;s location on the surface of the Earth, and optional local weather data for refr...">on_surface</a></code> data structure alongside the observer location. A standard radio refraction model is included as of version <b>1.1</b>, as well as our implementation of the wavelength-dependent IAU refraction model (<code><a class="el" href="group__refract.html#ga7b9ad6dfbd86e4faa2d8068c7d64fac4" title="The wavelength-dependent IAU atmospheric refraction model, based on the SOFA iauRefco() function,...">novas_wave_refraction()</a></code> since version 1.4) based on the SOFA <code>iauRefco()</code> function. If none of the supplied options satisfies your needs, you may also implement your own refraction correction to use.</p>
<p></p>
</details>
<hr  />
<p><a class="anchor" id="tips"></a> </p>
<h2><a class="anchor" id="autotoc_md117"></a>
Tips and tricks</h2>
<ul>
<li><a class="el" href="#cpp-headers">SuperNOVAS and C++</a></li>
<li><a class="el" href="#accuracy-notes">Reduced accuracy shortcuts</a></li>
<li><a class="el" href="#multi-threading">Multi-threaded calculations</a></li>
<li><a class="el" href="#physical-units">Physical units</a></li>
<li><a class="el" href="#string-times-and-angles">String times and angles</a></li>
<li><a class="el" href="#string-dates">String dates</a></li>
</ul>
<p><a class="anchor" id="cpp-headers"></a> </p>
<h3><a class="anchor" id="autotoc_md118"></a>
SuperNOVAS and C++</h3>
<p>When including <b>SuperNOVAS</b> (C90) headers in your C++ source files, it is necessary to reconcile the different C and C++ namespaces. Therefore, you will have to include the <b>SuperNOVAS</b> headers inside an <code>extern "C" {}</code> block in your source code, such as:</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><span class="preprocessor">#  include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The above is the standard way to include C headers in C++ sources, in general.</p>
<p><a class="anchor" id="accuracy-notes"></a> </p>
<h3><a class="anchor" id="autotoc_md119"></a>
Reduced accuracy shortcuts</h3>
<p>When one does not need positions at the microarcsecond level, some shortcuts can be made to the recipe above:</p>
<ul>
<li>You may forgo reconciling the ITRF realizations of EOP vs. an Earth-based observing site, if precision at the microarcsecond level is not required.</li>
<li>You may skip the interpolation of published EOP values, if accuracy below the milliarcsecond level is not required.</li>
<li>You can use <code>NOVAS_REDUCED_ACCURACY</code> instead of <code>NOVAS_FULL_ACCURACY</code> for the calculations. This typically has an effect at or below the milliarcsecond level only, but may be much faster to calculate.</li>
<li>You might skip the pole offsets <em>x</em><sub>p</sub>, <em>y</em><sub>p</sub>. These are tenths of arcsec, typically.</li>
<li>You may not need to interface to an ephemeris provider if you don't need positions for Solar-system objects, and you are willing to ignore gravitational redhifts / deflections around Solar-system bodies.</li>
</ul>
<p><a class="anchor" id="multi-threading"></a> </p>
<h3><a class="anchor" id="autotoc_md120"></a>
Multi-threaded calculations</h3>
<p>Some of the calculations involved can be expensive from a computational perspective. For the most typical use case however, NOVAS (and <b>SuperNOVAS</b>) has a trick up its sleeve: it caches the last result of intensive calculations so they may be re-used if the call is made with the same environmental parameters again (such as JD time and accuracy).</p>
<p>A direct consequence of the caching of results is that calculations are generally not thread-safe as implemented by the original NOVAS C 3.1 library. One thread may be in the process of returning cached values for one set of input parameters while, at the same time, another thread is saving cached values for a different set of parameters. Thus, when running calculations in more than one thread, the NOVAS C results returned may at times be incorrect, or more precisely they may not correspond to the requested input parameters.</p>
<p>While you should never call the original NOVAS C library from multiple threads simultaneously, <b>SuperNOVAS</b> caches the results in thread local variables (provided your compiler supports it), and is therefore generally safe to use in multi-threaded applications. Just make sure that you:</p>
<ul>
<li>use a compiler which supports the C11 language standard;</li>
<li>or, compile with GCC &gt;= 3.3;</li>
<li>or else, set the appropriate non-standard keyword to use for declaring thread-local variables for your compiler in <code>config.mk</code> or in your equivalent build setup.</li>
</ul>
<p><a class="anchor" id="physical-units"></a> </p>
<h3><a class="anchor" id="autotoc_md121"></a>
Physical units</h3>
<p>The NOVAS API has been using conventional units (e.g. AU, km, day, deg, h) typically for its parameters and return values alike. Hence, <b>SuperNOVAS</b> follows the same conventions for its added functions and data structures also. However, when interfacing <b>SuperNOVAS</b> with other programs, libraries, or data files, it is often necessary to use quantities that are expressed in different units, such as SI or CGS. To facilitate such conversions, <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code> provides a set of unit constants, which can be used for converting to/from SI units (and radians).</p>
<p>For example, <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code> contains the following definitions:</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define NOVAS_DAY                 86400.0</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define NOVAS_DEGREE              (M_PI / 180.0)</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define NOVAS_HOURANGLE           (M_PI / 12.0)</span></div>
</div><!-- fragment --><p>You can use these, for example, to convert quantities expressed in conventional units for NOVAS to standard (SI) values, by multiplying NOVAS quantities with the corresponding unit definition. E.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// A difference in Julian Dates [day] in seconds.</span></div>
<div class="line"><span class="keywordtype">double</span> delta_t = (tjd - tjd0) * <a class="code hl_define" href="group__time.html#ga0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// R.A. [h] / declination [deg] converted radians (e.g. for trigonometric functions).</span></div>
<div class="line"><span class="keywordtype">double</span> ra_rad = ra_h * <a class="code hl_define" href="group__util.html#gaee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a>;</div>
<div class="line"><span class="keywordtype">double</span> dec_rad = dec_d * <a class="code hl_define" href="group__util.html#ga6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a>; </div>
<div class="ttc" id="agroup__time_html_ga0b0c2c5ccc61c8740de2e2ac277cd836"><div class="ttname"><a href="group__time.html#ga0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a></div><div class="ttdeci">#define NOVAS_DAY</div><div class="ttdoc">[s] The length of a synodic day, that is 24 hours exactly.</div><div class="ttdef"><b>Definition</b> novas.h:180</div></div>
<div class="ttc" id="agroup__util_html_ga6d9698dbaf6260d7fe8a531a0e96d2a8"><div class="ttname"><a href="group__util.html#ga6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a></div><div class="ttdeci">#define NOVAS_DEGREE</div><div class="ttdoc">[rad] A degree expressed in radians.</div><div class="ttdef"><b>Definition</b> novas.h:200</div></div>
<div class="ttc" id="agroup__util_html_gaee2680f03d1dfa4c9fbeea2be806dbf7"><div class="ttname"><a href="group__util.html#gaee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a></div><div class="ttdeci">#define NOVAS_HOURANGLE</div><div class="ttdoc">[rad] An hour of angle expressed in radians.</div><div class="ttdef"><b>Definition</b> novas.h:215</div></div>
</div><!-- fragment --><p>And vice-versa: to convert values expressed in standard (SI) units, you can divide by the appropriate constant to 'cast' an SI value into the particular physical unit, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Increment a Julian Date [day] with some time differential [s].</span></div>
<div class="line"><span class="keywordtype">double</span> tjd = tjd0 + delta_t / <a class="code hl_define" href="group__time.html#ga0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// convert R.A. / declination in radians to hours and degrees</span></div>
<div class="line"><span class="keywordtype">double</span> ra_h = ra_rad / <a class="code hl_define" href="group__util.html#gaee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a>;</div>
<div class="line"><span class="keywordtype">double</span> dec_d = dec_rad / <a class="code hl_define" href="group__util.html#ga6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a>;</div>
</div><!-- fragment --><p>Finally, you can combine them to convert between two different conventional units, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Convert angle from [h] -&gt; [rad] -&gt; [deg]</span></div>
<div class="line"><span class="keywordtype">double</span> lst_d = lst_h * <a class="code hl_define" href="group__util.html#gaee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a> / <a class="code hl_define" href="group__util.html#ga6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a>; </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert [AU/day] -&gt; [m/s] (SI) -&gt; [km/s]</span></div>
<div class="line"><span class="keywordtype">double</span> v_kms = v_auday * (<a class="code hl_define" href="group__source.html#gabc8f275a2d431e59a1ec9e276abaca1a">NOVAS_AU</a> / <a class="code hl_define" href="group__time.html#ga0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>) / <a class="code hl_define" href="group__source.html#ga7822b81ad3f75b448f446ed4da774e75">NOVAS_KMS</a></div>
<div class="ttc" id="agroup__source_html_ga7822b81ad3f75b448f446ed4da774e75"><div class="ttname"><a href="group__source.html#ga7822b81ad3f75b448f446ed4da774e75">NOVAS_KMS</a></div><div class="ttdeci">#define NOVAS_KMS</div><div class="ttdoc">[m] One km/s in m/s.</div><div class="ttdef"><b>Definition</b> novas.h:225</div></div>
<div class="ttc" id="agroup__source_html_gabc8f275a2d431e59a1ec9e276abaca1a"><div class="ttname"><a href="group__source.html#gabc8f275a2d431e59a1ec9e276abaca1a">NOVAS_AU</a></div><div class="ttdeci">#define NOVAS_AU</div><div class="ttdoc">[m] Astronomical unit (AU).</div><div class="ttdef"><b>Definition</b> novas.h:231</div></div>
</div><!-- fragment --><p><a class="anchor" id="string-times-and-angles"></a> </p>
<h3><a class="anchor" id="autotoc_md122"></a>
String times and angles</h3>
<p><b>SuperNOVAS</b> functions typically input and output times and angles as decimal values (hours and degrees, but also as days and hour-angles), but that is not how these are represented in many cases. Time and right-ascention are often given as string values indicating hours, minutes, and seconds (e.g. "11:32:31.595", or "11h 32m 31.595s"). Similarly angles, are commonly represented as degrees, arc-minutes, and arc-seconds (e.g. "+53 60 19.9"). For that reason, <b>SuperNOVAS</b> provides a set of functions to convert string values expressed in decimal or broken-down format to floating point representation. E.g.,</p>
<div class="fragment"><div class="line"><span class="comment">// Right ascention from string</span></div>
<div class="line"><span class="keywordtype">double</span> ra_h = <a class="code hl_function" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a>(<span class="stringliteral">&quot;9 18 49.068&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Declination from string</span></div>
<div class="line"><span class="keywordtype">double</span> dec_d = <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;-53 10 07.33&quot;</span>);</div>
</div><!-- fragment --><p>The conversions have a lot of flexibility. Components can be separated by spaces (as above), by colons, commas, or underscores, by the letters 'h'/'d', 'm', and 's', by single (minutes) and double quotes (seconds), or any combination thereof. Decimal values may be followed by 'h' or 'd' unit markers. Additionally, angles can end with a compass direction, such as 'N', 'E', 'S' or 'W'. So the above could also have been:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> ra_h = <a class="code hl_function" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a>(<span class="stringliteral">&quot;9h_18:49.068\&quot;&quot;</span>);</div>
<div class="line"><span class="keywordtype">double</span> dec_d = <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;53d 10&#39;_07.33S&quot;</span>);</div>
</div><!-- fragment --><p>or as decimals:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> ra_h = <a class="code hl_function" href="group__util.html#ga3ed26b6af870f6dbc353f651563afd4a">novas_str_hours</a>(<span class="stringliteral">&quot;9.31363&quot;</span>);</div>
<div class="line"><span class="keywordtype">double</span> dec_d = <a class="code hl_function" href="group__util.html#ga6d6ada07aab7ce09fb8ea7b12660ebcd">novas_str_degrees</a>(<span class="stringliteral">&quot;53.16870278d South&quot;</span>);</div>
</div><!-- fragment --><p><a class="anchor" id="string-dates"></a> </p>
<h3><a class="anchor" id="autotoc_md123"></a>
String dates</h3>
<p>Dates are typically represented broken down into year, month, and day (e.g. "2025-02-16", or "16.02.2025", or "2/16/2025"), with or without a time marker, which itself may or may not include a time zone specification. In astronomy, the most commonly used string representation of dates is with ISO 8601 timestamps. The following are all valid ISO date specifications:</p>
<div class="fragment"><div class="line">2025-02-16         # Date only (0 UTC)</div>
<div class="line">2025-02-16T19:35:21Z       # UTC date/time</div>
<div class="line">2025-02-16T19:35:21.832Z   # UTC date/time with decimals</div>
<div class="line">2025-02-16T14:35:21+0500   # date in time zone (e.g. EST)</div>
<div class="line">2025-02-16T14:35:21.832+05:00  # alternative time zone specification</div>
</div><!-- fragment --><p><b>SuperNOVAS</b> provides functions to convert between ISO dates/times and their string representation for convenience. E.g.,</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__timespec.html">novas_timespec</a> time;           <span class="comment">// Astronomical time specification</span></div>
<div class="line"><span class="keywordtype">char</span> timestamp[40];            <span class="comment">// A string to contain an ISO representation</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parse an ISO timestamp into a Julian day (w/o returning the tail).</span></div>
<div class="line"><span class="keywordtype">double</span> jd = <a class="code hl_function" href="group__util.html#gad53b3be5b92ea244cfb0347feb3bec9f">novas_parse_iso_date</a>(<span class="stringliteral">&quot;2025-02-16T19:35:21Z&quot;</span>, NULL);</div>
<div class="line"><span class="keywordflow">if</span>(isnan(jd)) {</div>
<div class="line">  <span class="comment">// Oops could not parse date.</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line"><span class="comment">// Use the parsed JD date (in UTC) with the appropriate leap seconds </span></div>
<div class="line"><span class="comment">// and UT1-UTC time difference</span></div>
<div class="line"><a class="code hl_function" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb">novas_set_time</a>(<a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba01787464888b92c37b8340174c03cc8d">NOVAS_UTC</a>, jd, leap_seconds, dut1, &amp;time);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print an ISO timestamp, with millisecond precision, into the </span></div>
<div class="line"><span class="comment">// designated string buffer.</span></div>
<div class="line"><a class="code hl_function" href="group__time.html#ga4d6da26d0a7d7d904f25d2be00030b25">novas_iso_timestamp</a>(&amp;time, timestamp, <span class="keyword">sizeof</span>(timestamp));</div>
<div class="ttc" id="agroup__time_html_ga4d6da26d0a7d7d904f25d2be00030b25"><div class="ttname"><a href="group__time.html#ga4d6da26d0a7d7d904f25d2be00030b25">novas_iso_timestamp</a></div><div class="ttdeci">int novas_iso_timestamp(const novas_timespec *restrict time, char *restrict dst, int maxlen)</div><div class="ttdoc">Prints a UTC-based ISO timestamp to millisecond precision to the specified string buffer.</div><div class="ttdef"><b>Definition</b> timescale.c:1096</div></div>
<div class="ttc" id="agroup__util_html_gad53b3be5b92ea244cfb0347feb3bec9f"><div class="ttname"><a href="group__util.html#gad53b3be5b92ea244cfb0347feb3bec9f">novas_parse_iso_date</a></div><div class="ttdeci">double novas_parse_iso_date(const char *restrict date, char **restrict tail)</div><div class="ttdoc">Parses an ISO 8601 timestamp, converting it to a Julian day.</div><div class="ttdef"><b>Definition</b> parse.c:1112</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>ISO 8601 timestamps are always UTC-based and expressed in the Gregorian calendar, as per specification, even for dates that preceded the Gregorian calendar reform of 1582 (i.e. 'proleptic Gregorian' dates).</dd></dl>
<p>Other <b>SuperNOVAS</b> string date functions will process dates in the astronomical calendar of date by default, that is in the Gregorian calendar after the Gregorian calendar reform of 1582, or the Julian/Roman calendar for dates prior, and support timescales other than UTC also. E.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Print a TDB timestamp in the astronomical calendar of date instead</span></div>
<div class="line"><a class="code hl_function" href="group__time.html#gac8e83c48005d5aabb3e7bbf8d9f8ed81">novas_timestamp</a>(&amp;time, <a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0baf5d992bdf01b4f3fd7b22e3e24c6974d">NOVAS_TDB</a>, timestamp, <span class="keyword">sizeof</span>(timestamp));</div>
<div class="ttc" id="agroup__time_html_gac8e83c48005d5aabb3e7bbf8d9f8ed81"><div class="ttname"><a href="group__time.html#gac8e83c48005d5aabb3e7bbf8d9f8ed81">novas_timestamp</a></div><div class="ttdeci">int novas_timestamp(const novas_timespec *restrict time, enum novas_timescale scale, char *restrict dst, int maxlen)</div><div class="ttdoc">Prints an astronomical timestamp to millisecond precision in the specified timescale to the specified...</div><div class="ttdef"><b>Definition</b> timescale.c:1167</div></div>
<div class="ttc" id="agroup__time_html_ggaa642c4ccc7195dc62fd0dc56567ebd0baf5d992bdf01b4f3fd7b22e3e24c6974d"><div class="ttname"><a href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0baf5d992bdf01b4f3fd7b22e3e24c6974d">NOVAS_TDB</a></div><div class="ttdeci">@ NOVAS_TDB</div><div class="ttdoc">Barycentric Dynamical Time (TDB)</div><div class="ttdef"><b>Definition</b> novas.h:1643</div></div>
</div><!-- fragment --><p>Or, parse an astronomical date:</p>
<div class="fragment"><div class="line"><span class="comment">// Parse astronomical dates into a Julian day...</span></div>
<div class="line"><span class="keywordtype">double</span> jd = <a class="code hl_function" href="group__time.html#gabaac8a4ea28bc8b811277051e3168468">novas_date</a>(<span class="stringliteral">&quot;2025-02-16T19:35:21&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(isnan(jd)) {</div>
<div class="line">  <span class="comment">// Oops could not parse date.</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__time_html_gabaac8a4ea28bc8b811277051e3168468"><div class="ttname"><a href="group__time.html#gabaac8a4ea28bc8b811277051e3168468">novas_date</a></div><div class="ttdeci">double novas_date(const char *restrict date)</div><div class="ttdoc">Returns a Julian date (in non-specific timescale) corresponding the specified input string date / tim...</div><div class="ttdef"><b>Definition</b> timescale.c:984</div></div>
</div><!-- fragment --><p>Or, parse an astronomical date, including the timescale specification:</p>
<div class="fragment"><div class="line"><span class="comment">// Parse a TAI-based timestamp into a Julian day and corresponding timescale</span></div>
<div class="line"><span class="keywordtype">double</span> jd = <a class="code hl_function" href="group__time.html#ga66656c3f5a1256f4bfc3ed2e168c70c2">novas_date_scale</a>(<span class="stringliteral">&quot;2025-02-16T19:35:21+0200 TAI&quot;</span>, &amp;scale);</div>
<div class="line"><span class="keywordflow">if</span>(isnan(jd)) {</div>
<div class="line">  <span class="comment">// Oops could not parse date.</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__time_html_ga66656c3f5a1256f4bfc3ed2e168c70c2"><div class="ttname"><a href="group__time.html#ga66656c3f5a1256f4bfc3ed2e168c70c2">novas_date_scale</a></div><div class="ttdeci">double novas_date_scale(const char *restrict date, enum novas_timescale *restrict scale)</div><div class="ttdoc">Returns a Julian date and the timescale corresponding the specified input string date/time and timesc...</div><div class="ttdef"><b>Definition</b> timescale.c:1012</div></div>
</div><!-- fragment --><p>Sometimes your input dates are represented in various other formats. You can have additional flexibility for parsing dates using the <code><a class="el" href="group__util.html#ga5ec9d054b7d363b3db1d065507a1ba41" title="Parses a calendar date/time string, expressed in the specified type of calendar, into a Julian day (J...">novas_parse_date_format()</a></code> and <code><a class="el" href="group__time.html#gab344242721ca00709d4dc482a7934e2a" title="Returns the timescale constant for a string that denotes the timescale in with a standard abbreviatio...">novas_timescale_for_string()</a></code> functions.</p>
<details >
<summary >
Details</summary>
<p></p>
<p>E.g.,</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *pos = NULL;            <span class="comment">// We&#39;ll keep track of the string parse position here</span></div>
<div class="line"><span class="keyword">enum</span> <a class="code hl_enumeration" href="group__time.html#gaa642c4ccc7195dc62fd0dc56567ebd0b">novas_timescale</a> scale;  <span class="comment">// We&#39;ll parse the timescale here (if we can)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parse the M/D/Y date up to the &#39;TAI&#39; timescale specification...</span></div>
<div class="line"><span class="keywordtype">double</span> jd = <a class="code hl_function" href="group__util.html#ga5ec9d054b7d363b3db1d065507a1ba41">novas_parse_date_format</a>(<a class="code hl_enumvalue" href="group__time.html#ggaa8cfc18bfdf8ebd0198065c9d07e3bbaa90f19bf1771802f4ad20cf14660c8322">NOVAS_GREGORIAN_CALENDAR</a>, <a class="code hl_enumvalue" href="group__time.html#gga9f2b43ae4b048783dc09c2a3d9b46ca4ab13cba930f91e5e907bfc72489ffbc61">NOVAS_MDY</a>, </div>
<div class="line">  <span class="stringliteral">&quot;2/16/2025 20:08:49.082 TAI&quot;</span>, &amp;pos);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then parse the &#39;TAI&#39; timescale marker, after the date/time specification</span></div>
<div class="line">scale = <a class="code hl_function" href="group__time.html#gab344242721ca00709d4dc482a7934e2a">novas_timescale_for_string</a>(pos);</div>
<div class="line"><span class="keywordflow">if</span>(scale &lt; 0) {</div>
<div class="line">  <span class="comment">// Oops, not a valid timescale marker. Perhaps assume UTC...</span></div>
<div class="line">  scale = <a class="code hl_enumvalue" href="group__time.html#ggaa642c4ccc7195dc62fd0dc56567ebd0ba01787464888b92c37b8340174c03cc8d">NOVAS_UTC</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now set the time for the given calendar, date format, and timescale of the </span></div>
<div class="line"><span class="comment">// string representation.</span></div>
<div class="line"><a class="code hl_function" href="group__time.html#gaf4a1a5180905a7d8f76aeafe3f9a8ebb">novas_set_time</a>(scale, jd, leap_seconds, dut1, &amp;time);</div>
<div class="ttc" id="agroup__time_html_gaa642c4ccc7195dc62fd0dc56567ebd0b"><div class="ttname"><a href="group__time.html#gaa642c4ccc7195dc62fd0dc56567ebd0b">novas_timescale</a></div><div class="ttdeci">novas_timescale</div><div class="ttdoc">Constants to reference various astrnomical timescales used.</div><div class="ttdef"><b>Definition</b> novas.h:1641</div></div>
<div class="ttc" id="agroup__time_html_gab344242721ca00709d4dc482a7934e2a"><div class="ttname"><a href="group__time.html#gab344242721ca00709d4dc482a7934e2a">novas_timescale_for_string</a></div><div class="ttdeci">enum novas_timescale novas_timescale_for_string(const char *restrict str)</div><div class="ttdoc">Returns the timescale constant for a string that denotes the timescale in with a standard abbreviatio...</div><div class="ttdef"><b>Definition</b> parse.c:1180</div></div>
<div class="ttc" id="agroup__time_html_gga9f2b43ae4b048783dc09c2a3d9b46ca4ab13cba930f91e5e907bfc72489ffbc61"><div class="ttname"><a href="group__time.html#gga9f2b43ae4b048783dc09c2a3d9b46ca4ab13cba930f91e5e907bfc72489ffbc61">NOVAS_MDY</a></div><div class="ttdeci">@ NOVAS_MDY</div><div class="ttdoc">month, then day, then year</div><div class="ttdef"><b>Definition</b> novas.h:1929</div></div>
<div class="ttc" id="agroup__time_html_ggaa8cfc18bfdf8ebd0198065c9d07e3bbaa90f19bf1771802f4ad20cf14660c8322"><div class="ttname"><a href="group__time.html#ggaa8cfc18bfdf8ebd0198065c9d07e3bbaa90f19bf1771802f4ad20cf14660c8322">NOVAS_GREGORIAN_CALENDAR</a></div><div class="ttdeci">@ NOVAS_GREGORIAN_CALENDAR</div><div class="ttdoc">The Gregorian calendar introduced on 15 October 1582, the day after 4 October.</div><div class="ttdef"><b>Definition</b> novas.h:1945</div></div>
<div class="ttc" id="agroup__util_html_ga5ec9d054b7d363b3db1d065507a1ba41"><div class="ttname"><a href="group__util.html#ga5ec9d054b7d363b3db1d065507a1ba41">novas_parse_date_format</a></div><div class="ttdeci">double novas_parse_date_format(enum novas_calendar_type calendar, enum novas_date_format format, const char *restrict date, char **restrict tail)</div><div class="ttdoc">Parses a calendar date/time string, expressed in the specified type of calendar, into a Julian day (J...</div><div class="ttdef"><b>Definition</b> parse.c:910</div></div>
</div><!-- fragment --><p></p>
</details>
<hr  />
<p><a class="anchor" id="debug-support"></a> </p>
<h2><a class="anchor" id="autotoc_md125"></a>
Runtime debug support</h2>
<p>You can enable or disable debugging output to <code>stderr</code> with <code><a class="el" href="group__util.html#ga5f35633b872751df4dacd2fb2cbe4ac3" title="Enables or disables reporting errors and traces to the standard error stream.">novas_debug(enum novas_debug_mode)</a></code>, where the argument is one of the defined constants from <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code><a class="el" href="group__util.html#ga9d8d2a1f5c06b488e4c817bc9877e3ba" title="Settings for &#39;novas_debug()&#39;.">novas_debug_mode</a></code> value   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_OFF</code>   </td><td class="markdownTableBodyLeft">No debugging output (<em>default</em>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_ON</code>   </td><td class="markdownTableBodyLeft">Prints error messages and traces to <code>stderr</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_EXTRA</code>   </td><td class="markdownTableBodyLeft">Same as above but with stricter error checking   </td></tr>
</table>
<p>The main difference between <code>NOVAS_DEBUG_ON</code> and <code>NOVAS_DEBUG_EXTRA</code> is that the latter will treat minor issues as errors also, while the former may ignore them. For example, <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> will return normally by default if it cannot calculate gravitational bending around massive planets in full accuracy mode. It is unlikely that this omission would significantly alter the result in most cases, except for some very specific ones when observing in a direction close to a major planet. Thus, with <code>NOVAS_DEBUG_ON</code>, <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> go about as usual even if the Jupiter's position is not known. However, <code>NOVAS_DEBUG_EXTRA</code> will not give it a free pass, and will make <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> return an error (and print the trace) if it cannot properly account for gravitational bending around the major planets as it is expected to.</p>
<p>When debug mode is enabled, any error condition (such as NULL pointer arguments, or invalid input values etc.) will be reported to the standard error, complete with call tracing within the <b>SuperNOVAS</b> library, s.t. users can have a better idea of what exactly did not go to plan (and where). The debug messages can be disabled by passing <code>NOVAS_DEBUG_OFF</code> (0) as the argument to the same call. Here is an example error trace when your application calls <code><a class="el" href="grav_8c.html#a48f90ac20950507fad9b880a7f7f2383" title="(primarily for internal use) Computes the total gravitational deflection of light for the observed ob...">grav_def()</a></code> with <code>NOVAS_FULL_ACCURACY</code> while <code>solsys3</code> provides Earth and Sun positions only and when debug mode is <code>NOVAS_DEBUG_EXTRA</code> (otherwise we'll ignore that we skipped the almost always negligible deflection due to planets):</p>
<div class="fragment"><div class="line">ERROR! earth_sun_calc: invalid or unsupported planet number: 6 [=&gt; 2]</div>
<div class="line">     @ earth_sun_calc_hp [=&gt; 2]</div>
<div class="line">     @ ephemeris:planet [=&gt; 12]</div>
<div class="line">     @ light_time2 [=&gt; 22]</div>
<div class="line">     @ obs_planets [=&gt; 12]</div>
<div class="line">     @ grav_def [=&gt; 12]</div>
</div><!-- fragment --><hr  />
<p><a class="anchor" id="benchmarks"></a> </p>
<h2><a class="anchor" id="autotoc_md127"></a>
Representative benchmarks</h2>
<p>To get an idea of the speed of <b>SuperNOVAS</b>, you can use <code>make benchmark</code> on your machine. Figure 2 below summarizes the single-threaded results obtained on an AMD Ryzen 5 PRO 6650U laptop. While this is clearly not the state of the art for today's server class machines, it nevertheless gives you a ballpark idea for how a typical, not so new, run-of-the-mill PC might perform.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><p class="starttd"><img src="SuperNOVAS-benchmark.png" alt="" class="inline" title="SuperNOVAS benchmarks"/>    </p>
<p class="endtd"></p>
</th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Figure 2.</b> SuperNOVAS apparent position calculation benchmarks, including proper motion, the IAU 2000 precession-nutation model, polar wobble, aberration, and gravitational deflection corrections, and precise spectroscopic redhift calculations.   </td></tr>
</table>
<p>The tests calculate apparent positions (in CIRS) for a set of sidereal sources with random parameters, using either the <b>SuperNOVAS</b> <code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code> or the legacy NOVAS C <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, both in full accuracy and reduced accuracy modes. The two methods are equivalent, and both include calculating a precise geometric position, as well as aberration and gravitational deflection corrections from the observer's point of view.</p>
<details >
<summary >
Details</summary>
<p></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadCenter">accuracy   </th><th class="markdownTableHeadRight">positions / sec    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code>, same frame   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">3130414    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyCenter">full   </td><td class="markdownTableBodyRight">3149028    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, same time, same observer   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">831101    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyCenter">full   </td><td class="markdownTableBodyRight">831015    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code>, individual   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">168212    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyCenter">full   </td><td class="markdownTableBodyRight">25943    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, individual   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">167475    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"></td><td class="markdownTableBodyCenter">full   </td><td class="markdownTableBodyRight">25537   </td></tr>
</table>
<p>For reference, we also provide the reduced accuracy benchmarks from NOVAS C 3.1.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadCenter">accuracy   </th><th class="markdownTableHeadRight">positions / sec    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NOVAS C 3.1 <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, same frame   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">371164    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NOVAS C 3.1 <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code>, individual   </td><td class="markdownTableBodyCenter">reduced   </td><td class="markdownTableBodyRight">55484   </td></tr>
</table>
<p>For comparison, a very similar benchmark with <a href="https://www.astropy.org/">astropy</a> (v7.0.0 on Python v3.13.1) on the same machine, provides ~70 positions / second both for a fixed frame and for individual frames. As such, <b>SuperNOVAS</b> is a whopping ~40000 times faster than <b>astropy</b> for calculations in the same observing frame, and 400&ndash;2000 times faster than <b>astropy</b> for individual frames. (The <b>astropy</b> benchmarking code is also provided under the <code>benchmark/</code> folder in the <b>SuperNOVAS</b> GitHub repository).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadRight">positions / sec    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>astropy</b> 7.0.0 (python 3.13.1), same frame   </td><td class="markdownTableBodyRight">71    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>astropy</b> 7.0.0 (python 3.13.1), individual   </td><td class="markdownTableBodyRight">70   </td></tr>
</table>
<p></p>
</details>
<p>As one may observe, the <b>SuperNOVAS</b> <code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code> significantly outperforms the legacy <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> function, when repeatedly calculating positions for sources for the same instant of time and same observer location, providing 3&ndash;4 times faster performance than <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> with the same observer and time. The same performance is maintained even when cycling through different frames, a usage scenario in which the performance advantage over <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> may be up to 2 orders of magnitude. When observing frames are reused, the performance is essentially independent of the accuracy. By contrast, calculations for individual observing times or observer locations are generally around twice a fast if reduced accuracy is sufficient.</p>
<p>The above benchmarks are all for single-threaded performance. Since <b>SuperNOVAS</b> is generally thread-safe, you can expect that performance shall scale with the number of concurrent CPUs used. So, on a 16-core PC, with similar single core performance, you could calculate up to 32 million precise positions per second, if you wanted to. To put that into perspective, you could calculate precise apparent positions for the entire Gaia dataset (1.7 billion stars) in under one minute.</p>
<hr  />
<p><a class="anchor" id="supernovas-features"></a> </p>
<h2><a class="anchor" id="autotoc_md129"></a>
SuperNOVAS added features</h2>
<ul>
<li><a class="el" href="#added-functionality">Newly functionality highlights</a></li>
<li><a class="el" href="#api-changes">Refinements to the NOVAS C API</a></li>
</ul>
<p><a class="anchor" id="added-functionality"></a> </p>
<h3><a class="anchor" id="autotoc_md130"></a>
New functionality highlights</h3>
<p>Below is a non-exhaustive overview new features added by <b>SuperNOVAS</b> on top of the existing NOVAS C API. See <a href="https://github.com/Smithsonian/SuperNOVAS/blob/main/CHANGELOG.md"><code>CHANGELOG.md</code></a> for more details.</p>
<details >
<summary >
New in v1.0</summary>
<p></p>
<ul>
<li>New runtime configuration:<ul>
<li>The planet position, and generic Solar-system position calculator functions can be set at runtime, and users can provide their own custom implementations, e.g. to read ephemeris data, such as from a JPL <code>.bsp</code> file.</li>
<li>If CIO locations vs GCRS are important to the user, the user may call <code><a class="el" href="cio_8c.html#ade20b8035266dfe5b082b12248f5affa">set_cio_locator_file()</a></code> at runtime to specify the location of the binary CIO interpolation table (e.g. <code>CIO_RA.TXT</code> or <code>cio_ra.bin</code>) to use, even if the library was compiled with the different default CIO locator path.</li>
<li>The default low-precision nutation calculator <code><a class="el" href="group__earth.html#gabd066c2857d1b1cc06d8bd51b912d841" title="Computes the forced nutation of the non-rigid Earth: Model NU2000K.">nu2000k()</a></code> can be replaced by another suitable IAU 2006 nutation approximation. For example, the user may want to use the <code><a class="el" href="group__earth.html#ga6f9cddeb8c3dd906b9b0b5941249ad0c" title="Computes the forced nutation of the non-rigid Earth based at reduced precision.">iau2000b()</a></code> model or some custom algorithm instead.</li>
</ul>
</li>
<li>New constants, and enums &ndash; adding more specificity and transparency to option switches and physical units.</li>
<li>Many new functions to provide more coordinate transformations, inverse calculations, and more intuitive usage.</li>
</ul>
<p></p>
</details>
<details >
<summary >
New in v1.1</summary>
<p></p>
<ul>
<li>New observing-frame based approach for calculations (<code><a class="el" href="frames_8c.html" title="High-level and efficient astrometric calculations using observing frames.">frames.c</a></code>). A <code><a class="el" href="structnovas__frame.html" title="A set of parameters that uniquely define the place and time of observation.">novas_frame</a></code> object uniquely defines both the place and time of observation, with a set of precalculated transformations and constants. Once the frame is defined it can be used very efficiently to calculate positions for multiple celestial objects with minimum additional computational cost. The frames API is also more elegant and more versatile than the low-level NOVAS C approach for performing the same kind of calculations. And, frames are inherently thread-safe since post-creation their internal state is never modified during the calculations.</li>
<li>New <code><a class="el" href="structnovas__timespec.html" title="A structure, which defines a precise instant of time that can be extpressed in any of the astronomica...">novas_timespec</a></code> structure for the self-contained definition of precise astronomical time (<code><a class="el" href="timescale_8c.html" title="Functions to define and use different astronomical timescales and to convert among them.">timescale.c</a></code>). You can set the time to a JD date in the timescale of choice (UTC, UT1, GPS, TAI, TT, TCG, TDB, or TCB), or to a UNIX time. Once set, you can obtain an expression of that time in any timescale of choice. And, you can create a new time specification by incrementing an existing one, or measure precise time differences.</li>
<li>New coordinate reference systems <code>NOVAS_MOD</code> (Mean of Date) which includes precession but not nutation and <code>NOVAS_J2000</code> for the J2000 dynamical reference system.</li>
<li>New observer locations <code>NOVAS_AIRBORNE_OBSERVER</code> and <code>NOVAS_SOLAR_SYSTEM_OBSERVER</code>, and corresponding <code><a class="el" href="group__observer.html#gaa423a88cd3f434642fc89d47390184f4" title="Populates an &#39;observer&#39; data structure for an observer moving relative to the surface of Earth,...">make_airborne_observer()</a></code> and <code><a class="el" href="group__observer.html#ga9c3f1a1bc3fd9ac6d211806913d2d529" title="Populates an &#39;observer&#39; data structure, for an observer situated on a near-Earth spacecraft,...">make_solar_system_observer()</a></code> functions. Airborne observers have an Earth-fixed momentary location, defined by longitude, latitude, and altitude, the same way as for a stationary observer on Earth, but are moving relative to the surface, such as in an aircraft or balloon based observatory. Solar-system observers are similar to observers in Earth-orbit but their momentary position and velocity is defined relative to the Solar System Barycenter (SSB), instead of the geocenter.</li>
<li>New set of built-in refraction models to use with the frame-based functions, including a radio refraction model based on the formulae by Berman &amp; Rockwell 1976. Users may supply their own custom refraction model also, and may make use of the generic reversal function <code><a class="el" href="group__refract.html#ga81da80ae3ab1d0a444f39bde2af3a732" title="Computes the reverse atmospheric refraction for a given refraction model.">novas_inv_refract()</a></code> to calculate refraction in the reverse direction (observed vs astrometric elevations as the input) as needed.</li>
</ul>
<p></p>
</details>
<details >
<summary >
New in v1.2</summary>
<p></p>
<ul>
<li>New functions to calculate and apply additional gravitational redshift corrections for light that originates near massive gravitating bodies (other than major planets, or Sun or Moon), or for observers located near massive gravitating bodies (other than the Sun and Earth).</li>
<li><a class="el" href="#calceph-integration">CALCEPH integration</a> to specify and use ephemeris data via the CALCEPH library for Solar-system sources in general, and for major planets specifically.</li>
<li><a class="el" href="#cspice-integration">NAIF CSPICE integration</a> to use the NAIF CSPICE library for all Solar-system sources, or for major planets or other bodies only.</li>
<li>Added support for using orbital elements. <code><a class="el" href="structobject.html#a2cc80aad5c0303449e2412b122504a10" title="NOVAS object type.">object.type</a></code> can now be set to <code>NOVAS_ORBITAL_OBJECT</code>, whose orbit can be defined by <code><a class="el" href="structnovas__orbital.html" title="Keplerian orbital elements for NOVAS_ORBITAL_OBJECT type.">novas_orbital</a></code>, relative to a <code><a class="el" href="structnovas__orbital__system.html" title="Specification of an orbital system, in which orbital elements are defined.">novas_orbital_system</a></code>. While orbital elements do not always yield precise positions, they can for shorter periods, provided that the orbital elements are up-to-date. For example, the <a href="https://www.minorplanetcenter.net/iau/mpc.html">Minor Planet Center</a> (MPC) publishes accurate orbital elements for all known asteroids and comets regularly. For newly discovered objects, this may be the only and/or most accurate information available anywhere.</li>
<li>Added <code>NOVAS_EMB</code> (Earth-Moon Barycenter) and <code>NOVAS_PLUTO_BARYCENTER</code> to <code>enum novas_planets</code> to distinguish from the corresponding planet centers in calculations.</li>
<li>Added more physical unit constants to <code><a class="el" href="novas_8h.html" title="SuperNOVAS types, definitions, and function prototypes.">novas.h</a></code>.</li>
</ul>
<p></p>
</details>
<details >
<summary >
New in v1.3</summary>
<p></p>
<ul>
<li>New functions to aid the conversion of LSR velocities to SSB-based velocities, and vice-versa. (Super)NOVAS always defines catalog sources with SSB-based radial velocities, but some catalogs provide LSR velocities.</li>
<li>New functions to convert dates/times and angles to/from their string representations.</li>
<li>New functions to convert between Julian Days and calendar dates in the calendar of choice (astronomical, Gregorian, or Roman/Julian).</li>
<li>New convenience functions for oft-used astronomical calculations, such as rise/set times, LST, parallactic angle (a.k.a. Vertical Position Angle), heliocentric distance, illumination fraction, or incident solar power, Sun and Moon angles, and much more.</li>
<li>New functions and data structures provide second order Taylor series expansion of the apparent horizontal or equatorial positions, distances, and redshifts for sources. These values, including rates and accelerations, can be directly useful for controlling telescope drives in horizontal or equatorial mounts to track sources. You can also use them to obtain instantaneous projected (extrapolated) positions at low computational cost.</li>
</ul>
<p></p>
</details>
<details >
<summary >
New in v1.4</summary>
<p></p>
<ul>
<li>Updated nutation model from IAU2000 to IAU2006 (P03) model, by applying scaling factors (Capitaine et al. 2005) to match the IAU2006 precession model that was already implemented in NOVAS.</li>
<li>Approximate Keplerian orbital models for the major planets (Standish &amp; Williams, 1992), EMB, and the Moon (Chapront et al. 2002), for when arcmin-scale accuracy is sufficient (e.g. rise or set times, approximate sky positions).</li>
<li>Moon phase calculator functions, based on above orbital modeling.</li>
<li>Improved support for expressing and using coordinates in TIRS (Terrestrial Intermediate Reference System) and ITRS (International Terrestrial Reference System).</li>
<li>Improvements to atmospheric refraction modeling.</li>
</ul>
<p></p>
</details>
<details  open="true">
<summary >
New in v1.5</summary>
<p></p>
<ul>
<li>Simpler functions to calculate Greenwich Mean and Apparent Sidereal Time (GMST / GAST).</li>
<li>Functions to calculate corrections to the Earth orientation parameters published by IERS, to include the effect of libration and ocean tides. Such corrections are necessary to include if needing or using ITRS / TIRS coordinates with accuracy below the milliarcsecond (mas) level.</li>
<li>New functions to simplify the handling ground-based observing locations (GPS vs ITRF vs Cartesian locations), including setting default weather values, at least until actual values are specified if needed, and conversion between geodetic (longitude, latitude, altitude) and geocentric Cartesian (x, y, z) site coordinates using the reference ellipsoid of choice (e.g. GRS80 or WGS84).</li>
<li>Transformations of site coordinates and Earth orientation parameters between different ITRF realizations (e.g. ITRF2000 and ITRF2014).</li>
<li>Functions to calculate the rate at which an observer's clock ticks differently from a standard astronomical timescale, due to the gravitational potential around the observer and the observer's movement.</li>
<li>No longer using a CIO vs GCRS locator data file in any way, thus eliminating an annoying external soft dependency. This change has absolutely zero effect on backward compatibility and functionality.</li>
<li>GNU <code>make</code> build support for Mac OS X and FreeBSD (co-authored with Kiran Shila).</li>
<li>CMake build support (co-authored with Kiran Shila).</li>
</ul>
<p></p>
</details>
<p><a class="anchor" id="api-changes"></a> </p>
<h3><a class="anchor" id="autotoc_md131"></a>
Refinements to the NOVAS C API</h3>
<p>Many <b>SuperNOVAS</b> changes are focused on improving the usability and promote best coding practices so that both the library and your application will be safer, and less prone to nagging errors. Below is a detailed listing of the principal ways <b>SuperNOVAS</b> has improved on the original NOVAS C library in these respects.</p>
<details >
<summary >
Details</summary>
<p></p>
<ul>
<li>Changed to <a class="el" href="#multi-threading">support for calculations in parallel threads</a> by making cached results thread-local. This works using the C11 standard <code>_Thread_local</code>, or the C23 <code>thread_local</code>, or else the earlier GNU C &gt;= 3.3 standard <code>__thread</code> modifier. You can also set the preferred thread-local keyword for your compiler by passing it via <code>-DTHREAD_LOCAL=...</code> in <code>config.mk</code> to ensure that your build is thread-safe. And, if your compiler has no support whatsoever for thread_local variables, then <b>SuperNOVAS</b> will not be thread-safe, just as NOVAS C isn't.</li>
<li><b>SuperNOVAS</b> functions take <code>enum</code>s as their option arguments instead of raw integers. The enums allow for some compiler checking (e.g. using the wrong enum), and make for more readable code that is easier to debug. They also make it easy to see what choices are available for each function argument, without having to consult the documentation each and every time.</li>
<li>All <b>SuperNOVAS</b> functions check for the basic validity of the supplied arguments (Such as NULL pointers, or empty strings) and will return -1 (with <code>errno</code> set, usually to <code>EINVAL</code>) if the arguments supplied are invalid (unless the NOVAS C API already defined a different return value for specific cases. If so, the NOVAS C error code is returned for compatibility).</li>
<li>All erroneous returns now set <code>errno</code> so that users can track the source of the error in the standard C way and use functions such as <code>perror()</code> and <code>strerror()</code> to print human-readable error messages.</li>
<li><b>SuperNOVAS</b> prototypes declare function pointer arguments as <code>const</code> whenever the function does not modify the data content being pointed at. This supports better programming practices that generally aim to avoid unintended data modifications.</li>
<li>Many <b>SuperNOVAS</b> functions allow <code>NULL</code> arguments, both for optional input values as well as outputs that are not required (see the <a href="https://smithsonian.github.io/SuperNOVAS/doc/html/">API Documentation</a> for specifics). This eliminates the need to declare dummy variables in your application code.</li>
<li>Many output values supplied via pointers are set to clearly invalid values in case of erroneous returns, such as <code>NAN</code> so that even if the caller forgets to check the error code, it becomes obvious that the values returned should not be used as if they were valid. (No more sneaky silent failures.)</li>
<li>All <b>SuperNOVAS</b> functions that take an input vector to produce an output vector allow the output vector argument be the same as the input vector argument. For example, <code>frame_tie(pos, J2000_TO_ICRS, pos)</code> using the same <code>pos</code> vector both as the input and the output. In this case the <code>pos</code> vector is modified in place by the call. This can greatly simplify usage, and eliminate extraneous declarations, when intermediates are not required.</li>
<li>Catalog names can be up to 6 bytes (including termination), up from 4 in NOVAS C, while keeping <code>struct</code> layouts the same as NOVAS C thanks to alignment, thus allowing cross-compatible binary exchange of <code><a class="el" href="structcat__entry.html" title="Basic astrometric data for any sidereal object located outside the solar system.">cat_entry</a></code> records with NOVAS C 3.1.</li>
<li>Changed <code><a class="el" href="target_8c.html#a411f70fb77582d750c5269fcd64b0ce2">make_object()</a></code> to retain the specified number argument (which can be different from the <code>starnumber</code> value in the supplied <code><a class="el" href="structcat__entry.html" title="Basic astrometric data for any sidereal object located outside the solar system.">cat_entry</a></code> structure).</li>
<li><code><a class="el" href="cio_8c.html#a65ffaaa2b527ed03149eadc7568f3714">cio_location()</a></code> will always return a valid value as long as neither output pointer argument is NULL. (NOVAS C 3.1 would return an error if a CIO locator file was previously opened but cannot provide the data for whatever reason).</li>
<li><code><a class="el" href="transform_8c.html#a6217852bfd7d3a58d3266d0daadfc6bc">cel2ter()</a></code> and <code><a class="el" href="transform_8c.html#ac8c5ff3cc13126aba2ec5a6cbe187a31">ter2cel()</a></code> can now process 'option'/'class' = 1 (<code>NOVAS_REFERENCE_CLASS</code>) regardless of the methodology (<code>EROT_ERA</code> or <code>EROT_GST</code>) used to input or output coordinates in GCRS.</li>
<li>More efficient paging (cache management) for <code><a class="el" href="cio_8c.html#afc894b55420495a727a90d3d85188ef4">cio_array()</a></code>, including I/O error checking.</li>
<li>IAU 2000A nutation model uses higher-order Delaunay arguments provided by <code><a class="el" href="group__earth.html#ga312b5ab1a004b179d80463a07ca7da8f" title="Compute the fundamental (a.k.a.">fund_args()</a></code>, instead of the linear model in NOVAS C 3.1.</li>
<li>IAU 2000 nutation made a bit faster, reducing the the number of floating-point multiplications necessary by skipping terms that do not contribute. Its coefficients are also packed more frugally in memory, resulting in a smaller footprint.</li>
<li>Changed the standard atmospheric model for (optical) refraction calculation to include a simple model for the annual average temperature at the site (based on latitude and elevation). This results is a slightly more educated guess of the actual refraction than the global fixed temperature of 10 &deg;C assumed by NOVAS C 3.1 regardless of observing location.</li>
<li>[<b>v1.1</b>] Improved the precision of some calculations, like <code><a class="el" href="group__earth.html#gaef1f8daaad470353648de90576aefc66" title="Returns the value of the Earth Rotation Angle (Œ∏) for a given UT1 Julian date.">era()</a></code>, <code><a class="el" href="group__earth.html#ga312b5ab1a004b179d80463a07ca7da8f" title="Compute the fundamental (a.k.a.">fund_args()</a></code>, and <code><a class="el" href="planets_8c.html#aacc6a0daf29b8bdc18f46647a94694d3" title="Returns the planetary longitude, for Mercury through Neptune, w.r.t.">planet_lon()</a></code> by being more careful about the order in which terms are accumulated and combined, resulting in a small improvement on the few uas (micro-arcsecond) level.</li>
<li>[<b>v1.1</b>] <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> now returns an error 3 if and only if the observer is at (or very close, within ~1.5m) of the observed Solar-system object.</li>
<li>[<b>v1.1</b>] <code><a class="el" href="grav_8c.html#a48f90ac20950507fad9b880a7f7f2383" title="(primarily for internal use) Computes the total gravitational deflection of light for the observed ob...">grav_def()</a></code> is simplified. It no longer uses the location type argument. Instead it will skip deflections due to a body if the observer is within ~1500 km of its center (which is below the surface for all major Solar system bodies).</li>
<li>[<b>v1.1.1</b>] For major planets (and Sun and Moon) <code><a class="el" href="group__spectral.html#gafca24d914664bb60d20fb428177f329a" title="Predicts the radial velocity of the observed object as it would be measured by spectroscopic means.">rad_vel()</a></code> and <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> will include gravitational corrections to radial velocity for light originating at the surface, and observed near Earth or at a large distance away from the source.</li>
<li>[<b>v1.3</b>] In reduced accuracy mode apply gravitational deflection for the Sun only. In prior versions, deflection corrections were applied for Earth too. However, these are below the mas-level accuracy promised in reduced accuracy mode, and without it, the calculations for <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c" title="Computes the apparent direction of a celestial object at a specified time and in a specified coordina...">place()</a></code> and <code><a class="el" href="group__apparent.html#gac365a1e015ae1f875dc5a66fd5435b2f" title="Calculates an apparent location on sky for the source.">novas_sky_pos()</a></code> are significantly faster.</li>
<li>[<b>v1.3</b>] <code><a class="el" href="group__time.html#ga7cd85bc0a0248f84d399cbbce9fe9546" title="Returns the Julian day for a given astronomical calendar date.">julian_date()</a></code> and <code><a class="el" href="group__time.html#ga044f1359abcf0a039ac6452a95729b5a" title="This function will compute a broken down date on the astronomical calendar given the Julian day input...">cal_date()</a></code> now use astronomical calendar dates instead of the fixed Gregorian dates of before. Astronomical dates are Julian/Roman calendar dates prior to the Gregorian calendar reform of 1582.</li>
<li>[<b>v1.3</b>] Use C99 <code>restrict</code> keyword to prevent pointer argument aliasing as appropriate.</li>
<li>[<b>v1.4.2</b>] Nutation models have been upgraded from the original IAU2000 model to IAU2006 (i.e. IAU2000A R06), making them dynamically consistent with the implemented IAU2006 (P03) precession model.</li>
<li>[<b>v1.5</b>] Faster IAU2000A (R06) nutation series and <code>ee_ct()</code> calculations, with a ~2x speedup.</li>
<li>[<b>v1.5</b>] Weaned off using CIO locator file internally (but still allowing users to access them if they want to).</li>
</ul>
<p></p>
</details>
<hr  />
<p><a class="anchor" id="release-schedule"></a> </p>
<h2><a class="anchor" id="autotoc_md133"></a>
Release schedule</h2>
<p>A predictable release schedule and process can help manage expectations and reduce stress on adopters and developers alike.</p>
<p><b>SuperNOVAS</b> will try to follow a quarterly release schedule. You may expect upcoming releases to be published around <b>February 1</b>, <b>May 1</b>, <b>August 1</b>, and/or <b>November 1</b> each year, on an as-needed basis. That means that if there are outstanding bugs, or new pull requests (PRs), you may expect a release that addresses these in the upcoming quarter. The dates are placeholders only, with no guarantee that a new release will actually be available every quarter. If nothing of note comes up, a potential release date may pass without a release being published.</p>
<p>New features are generally reserved for the feature releases (e.g. <b>1.x.0</b> version bumps), although they may also be rolled out in bug-fix releases as long as they do not affect the existing API &ndash; in line with the desire to keep bug-fix releases fully backwards compatible with their parent versions.</p>
<p>In the weeks and month(s) preceding releases one or more <em>release candidates</em> (e.g. <code>1.0.1-rc3</code>) will be published temporarily on GitHub, under <a href="https://github.com/Smithsonian/SuperNOVAS/releases">Releases</a>, so that changes can be tested by adopters before the releases are finalized. Please use due diligence to test such release candidates with your code when they become available to avoid unexpected surprises when the finalized release is published. Release candidates are typically available for one week only before they are superseded either by another, or by the finalized release.</p>
<hr  />
<p> Copyright (C) 2025 Attila Kov√°cs </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
