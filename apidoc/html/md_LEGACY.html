<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta charset="utf-8"/>
<meta name="description" content="SuperNOVAS C/C++ astrometry library"/>
<meta name="keywords" content="astronomy, astrometry, C, C++, C99, software library, open source, NOVAS"/>
<meta name="author" content="Attila Kovacs"/>
<meta name="copyright" content="(C)2024 Attila Kovacs" />
<meta name="robots" content="index,follow"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HLFWKSM8V9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLFWKSM8V9');
</script>
<link rel="shortcut icon" type="image/x-icon" href="/SuperNOVAS/resources/favicon.ico" />
<link rel="icon" type="image/png" sizes="192x192" href="/SuperNOVAS/resources/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="/SuperNOVAS/resources/android-chrome-512x512.png" />
<link rel="apple-touch-icon" type="image/png" href="/SuperNOVAS/resources/apple-touch-icon.png" />
<title>SuperNOVAS: Astrometric Positions the Old Way</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="smithsonian-logo-55x55.png"/></td>
  <td id="projectalign">
   <div id="projectname">SuperNOVAS<span id="projectnumber">&#160;v1.5</span>
   </div>
   <div id="projectbrief">The NOVAS C library, made better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_LEGACY.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Astrometric Positions the Old Way</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md46"></a> As of version 1.1, the SuperNOVAS library offers a new, more versatile, more intuitive, and more efficient way to calculate the astrometric positions (and velocities) of celestial sources, via observing frames (see <code>README.md</code>). However the old approach of the NOVAS C library remain viable also. This document demonstrates calculating the astrometric places of sources the old way, without using the observing frames approach that is now preferred in SuperNOVAS.</p>
<ul>
<li><a class="el" href="md_LEGACY.html#old-sidereal-example">Calculating positions for a sidereal source</a></li>
<li><a class="el" href="md_LEGACY.html#old-solsys-example">Calculating positions for a Solar-system source</a></li>
</ul>
<p><a class="anchor" id="old-sidereal-example"></a> </p>
<h1><a class="anchor" id="autotoc_md47"></a>
Calculating positions for a sidereal source</h1>
<p>A sidereal source may be anything beyond the solar-system with 'fixed' catalog coordinates. It may be a star, or a galactic molecular cloud, or a distant quasar.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Specify the object of interest</h2>
<p>First, you must provide the coordinates (which may include proper motion and parallax). Let's assume we pick a star for which we have B1950 (i.e. FK4) coordinates:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structcat__entry.html">cat_entry</a> source; <span class="comment">// Structure to contain information on sidereal source </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Let&#39;s assume we have B1950 (FK4) coordinates...</span></div>
<div class="line"><span class="comment">// 16h26m20.1918s, -26d19m23.138s (B1950), proper motion -12.11, -23.30 mas/year, </span></div>
<div class="line"><span class="comment">// parallax 5.89 mas, radial velocity -3.4 km/s.</span></div>
<div class="line"><a class="code hl_function" href="target_8c.html#a39b2e39d29f1b57c5f785284ba7ca43f">make_cat_entry</a>(<span class="stringliteral">&quot;Antares&quot;</span>, <span class="stringliteral">&quot;FK4&quot;</span>, 1, 16.43894213, -26.323094, -12.11, -23.30, 5.89, -3.4, &amp;source);</div>
<div class="ttc" id="astructcat__entry_html"><div class="ttname"><a href="structcat__entry.html">cat_entry</a></div><div class="ttdef"><b>Definition</b> novas.h:806</div></div>
<div class="ttc" id="atarget_8c_html_a39b2e39d29f1b57c5f785284ba7ca43f"><div class="ttname"><a href="target_8c.html#a39b2e39d29f1b57c5f785284ba7ca43f">make_cat_entry</a></div><div class="ttdeci">short make_cat_entry(const char *restrict star_name, const char *restrict catalog, long cat_num, double ra, double dec, double pm_ra, double pm_dec, double parallax, double rad_vel, cat_entry *star)</div><div class="ttdef"><b>Definition</b> target.c:55</div></div>
</div><!-- fragment --><p>We must convert these coordinates to the now standard ICRS system for calculations in SuperNOVAS, first by calculating equivalent J2000 coordinates, by applying the proper motion and the appropriate precession. Then, we apply a small adjustment to convert from J2000 to ICRS coordinates.</p>
<div class="fragment"><div class="line"><span class="comment">// First change the catalog coordinates (in place) to the J2000 (FK5) system... </span></div>
<div class="line"><a class="code hl_function" href="target_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a>(<a class="code hl_enumvalue" href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1">CHANGE_EPOCH</a>, NOVAS_B1950, &amp;source, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9">NOVAS_J2000</a>, <span class="stringliteral">&quot;FK5&quot;</span>, &amp;source);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then convert J2000 coordinates to ICRS (also in place). Here the dates don&#39;t matter...</span></div>
<div class="line"><a class="code hl_function" href="target_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a>(<a class="code hl_enumvalue" href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8">CHANGE_J2000_TO_ICRS</a>, 0.0, &amp;source, 0.0, <span class="stringliteral">&quot;ICRS&quot;</span>, &amp;source);</div>
<div class="ttc" id="anovas_8h_html_a7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9"><div class="ttname"><a href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651ead110200de7f232d9110467c0862733d9">NOVAS_J2000</a></div><div class="ttdeci">@ NOVAS_J2000</div><div class="ttdef"><b>Definition</b> novas.h:454</div></div>
<div class="ttc" id="anovas_8h_html_ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8"><div class="ttname"><a href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8">CHANGE_J2000_TO_ICRS</a></div><div class="ttdeci">@ CHANGE_J2000_TO_ICRS</div><div class="ttdef"><b>Definition</b> novas.h:657</div></div>
<div class="ttc" id="anovas_8h_html_ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1"><div class="ttname"><a href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1">CHANGE_EPOCH</a></div><div class="ttdeci">@ CHANGE_EPOCH</div><div class="ttdoc">The combined equivalent of PROPER_MOTION and PRECESSION together.</div><div class="ttdef"><b>Definition</b> novas.h:653</div></div>
<div class="ttc" id="atarget_8c_html_abe0c6e6fc60a49efa88c365aef8cdc50"><div class="ttname"><a href="target_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a></div><div class="ttdeci">short transform_cat(enum novas_transform_type option, double jd_tt_in, const cat_entry *in, double jd_tt_out, const char *out_id, cat_entry *out)</div><div class="ttdef"><b>Definition</b> target.c:641</div></div>
</div><!-- fragment --><p>(Naturally, you can skip the transformation steps above if you have defined your source in ICRS coordinates from the start.)</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Spefify the observer location</h2>
<p>Next, we define the location where we observe from. Here we can (but don't have to) specify local weather parameters (temperature and pressure) also for refraction correction later (in this example, we'll skip the weather):</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structobserver.html">observer</a> obs;   <span class="comment">// Structure to contain observer location </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Specify the location we are observing from</span></div>
<div class="line"><span class="comment">// 50.7374 deg N, 7.0982 deg E, 60m elevation</span></div>
<div class="line"><a class="code hl_function" href="observer_8c.html#a5eb76fc6e7be571e228d23aee3823cb9">make_observer_on_surface</a>(50.7374, 7.0982, 60.0, 0.0, 0.0, &amp;obs);</div>
<div class="ttc" id="aobserver_8c_html_a5eb76fc6e7be571e228d23aee3823cb9"><div class="ttname"><a href="observer_8c.html#a5eb76fc6e7be571e228d23aee3823cb9">make_observer_on_surface</a></div><div class="ttdeci">int make_observer_on_surface(double latitude, double longitude, double height, double temperature, double pressure, observer *restrict obs)</div><div class="ttdef"><b>Definition</b> observer.c:118</div></div>
<div class="ttc" id="astructobserver_html"><div class="ttname"><a href="structobserver.html">observer</a></div><div class="ttdef"><b>Definition</b> novas.h:1146</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md50"></a>
Specify the time of observation</h2>
<p>We also need to set the time of observation. Our clocks usually measure UTC, but for astrometry we usually need time measured based on Terrestrial Time (TT) or Barycentric Time (TDB) or UT1. For a ground-based observer, you will often have to provide NOVAS with the TT - UT1 time difference, which can be calculated from the current leap seconds and the UT1 - UTC time difference (a.k.a. DUT1):</p>
<div class="fragment"><div class="line"><span class="comment">// The current value for the leap seconds (UTC - TAI)</span></div>
<div class="line"><span class="keywordtype">int</span> leap_seconds = 37;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the DUT1 = UT1 - UTC time difference in seconds (e.g. from IERS Bulletins)</span></div>
<div class="line"><span class="keywordtype">int</span> dut1 = ...;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate the Terrestrial Time (TT) based Julian date of observation (in days)</span></div>
<div class="line"><span class="comment">// Let&#39;s say on 2024-02-06 at 14:53:06 UTC.</span></div>
<div class="line"><span class="keywordtype">double</span> jd_tt = <a class="code hl_function" href="calendar_8c.html#a7cd85bc0a0248f84d399cbbce9fe9546">julian_date</a>(2024, 2, 6, 14.885) + <a class="code hl_function" href="timescale_8c.html#ab7611704bab9ce717744a8b5575c5378">get_utc_to_tt</a>(leap_seconds) / 86400.0; </div>
<div class="line"> </div>
<div class="line"><span class="comment">// We&#39;ll also need the TT - UT1 difference, which we can obtain from what we already</span></div>
<div class="line"><span class="comment">// defined above</span></div>
<div class="line"><span class="keywordtype">double</span> ut1_to_tt = <a class="code hl_function" href="timescale_8c.html#a4d7470ca705efa1953e8b4beab77c6b6">get_ut1_to_tt</a>(leap_seconds, dut1);</div>
<div class="ttc" id="acalendar_8c_html_a7cd85bc0a0248f84d399cbbce9fe9546"><div class="ttname"><a href="calendar_8c.html#a7cd85bc0a0248f84d399cbbce9fe9546">julian_date</a></div><div class="ttdeci">double julian_date(short year, short month, short day, double hour)</div><div class="ttdef"><b>Definition</b> calendar.c:232</div></div>
<div class="ttc" id="atimescale_8c_html_a4d7470ca705efa1953e8b4beab77c6b6"><div class="ttname"><a href="timescale_8c.html#a4d7470ca705efa1953e8b4beab77c6b6">get_ut1_to_tt</a></div><div class="ttdeci">double get_ut1_to_tt(int leap_seconds, double dut1)</div><div class="ttdef"><b>Definition</b> timescale.c:436</div></div>
<div class="ttc" id="atimescale_8c_html_ab7611704bab9ce717744a8b5575c5378"><div class="ttname"><a href="timescale_8c.html#ab7611704bab9ce717744a8b5575c5378">get_utc_to_tt</a></div><div class="ttdeci">double get_utc_to_tt(int leap_seconds)</div><div class="ttdef"><b>Definition</b> timescale.c:408</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md51"></a>
Specify Earth orientation parameters</h2>
<p>Next, you may want to set the small diurnal (sub-arcsec level) corrections to Earth orientation, which are published in the <a href="https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html">IERS Bulletins</a>. The obvious utility of these values comes later, when converting positions from the celestial CIRS frame to the Earth-fixed ITRS frame. Less obviously, however, it is also needed for calculating the CIO location for CIRS coordinates when a CIO locator file is not available, or for calculations sidereal time measures etc. Therefore, it's best to set the pole offsets early on:</p>
<div class="fragment"><div class="line"><span class="comment">// Current polar offsets provided by the IERS Bulletins (in arcsec)</span></div>
<div class="line"><span class="keywordtype">double</span> dx = ...;</div>
<div class="line"><span class="keywordtype">double</span> dy = ...;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="equinox_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole</a>(jd_tt, <a class="code hl_enumvalue" href="novas_8h.html#a70c3951615b1ecf42818c79893678543ad304f43b1bf8becb63fc4d972f8b1f77">POLE_OFFSETS_X_Y</a>, dx, dy);</div>
<div class="ttc" id="aequinox_8c_html_a8937180de2ee1545d19b8fc840f35fe2"><div class="ttname"><a href="equinox_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole</a></div><div class="ttdeci">short cel_pole(double jd_tt, enum novas_pole_offset_type type, double dpole1, double dpole2)</div><div class="ttdef"><b>Definition</b> equinox.c:124</div></div>
<div class="ttc" id="anovas_8h_html_a70c3951615b1ecf42818c79893678543ad304f43b1bf8becb63fc4d972f8b1f77"><div class="ttname"><a href="novas_8h.html#a70c3951615b1ecf42818c79893678543ad304f43b1bf8becb63fc4d972f8b1f77">POLE_OFFSETS_X_Y</a></div><div class="ttdeci">@ POLE_OFFSETS_X_Y</div><div class="ttdoc">Offsets are dx, dy pairs (IAU 2006 precession-nutation model)</div><div class="ttdef"><b>Definition</b> novas.h:601</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
Calculate apparent positions on sky</h2>
<p>Now we can calculate the precise apparent position (CIRS or TOD) of the source, such as it's right ascension (R.A.) and declination, and the equatorial <em>x,y,z</em> unit vector pointing in the direction of the source (in the requested coordinate system and for the specified observing location). We also get radial velocity (for spectroscopy), and distance (e.g. for apparent-to-physical size conversion):</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structsky__pos.html">sky_pos</a> pos;   <span class="comment">// We&#39;ll return the observable positions (in CIRS) in this structure</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calculate the apparent (CIRS) topocentric positions for the above configuration</span></div>
<div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="place_8c.html#a1504058672e6e3cf24ce6b7189ede005">place_star</a>(jd_tt, &amp;source, &amp;obs, ut1_to_tt, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, <a class="code hl_enumvalue" href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660">NOVAS_FULL_ACCURACY</a>, &amp;pos);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// You should always check that the calculation was successful...</span></div>
<div class="line"><span class="keywordflow">if</span>(status) {</div>
<div class="line">  <span class="comment">// Oops, something went wrong...</span></div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="ttc" id="anovas_8h_html_a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660"><div class="ttname"><a href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660">NOVAS_FULL_ACCURACY</a></div><div class="ttdeci">@ NOVAS_FULL_ACCURACY</div><div class="ttdef"><b>Definition</b> novas.h:525</div></div>
<div class="ttc" id="anovas_8h_html_a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044"><div class="ttname"><a href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a></div><div class="ttdeci">@ NOVAS_CIRS</div><div class="ttdef"><b>Definition</b> novas.h:446</div></div>
<div class="ttc" id="aplace_8c_html_a1504058672e6e3cf24ce6b7189ede005"><div class="ttname"><a href="place_8c.html#a1504058672e6e3cf24ce6b7189ede005">place_star</a></div><div class="ttdeci">int place_star(double jd_tt, const cat_entry *restrict star, const observer *restrict obs, double ut1_to_tt, enum novas_reference_system system, enum novas_accuracy accuracy, sky_pos *restrict pos)</div><div class="ttdef"><b>Definition</b> place.c:445</div></div>
<div class="ttc" id="astructsky__pos_html"><div class="ttname"><a href="structsky__pos.html">sky_pos</a></div><div class="ttdef"><b>Definition</b> novas.h:1175</div></div>
</div><!-- fragment --><p>The <em>placement</em> of the celestial target in the observer's frame includes appropriate aberration corrections for the observer's motion, as well as appropriate gravitational deflection corrections due to the Sun and Earth, and for other major gravitating solar system bodies (in full precision mode and if a suitable planet provider function is available).</p>
<p>The calculated <code><a class="el" href="structsky__pos.html">sky_pos</a></code> structure contains all the information needed about the apparent position of the source at the given date/time of observation. We may use it to get true apparent R.A. and declination from it, or to calculate azimuth and elevation at the observing location. We'll consider these two cases separately below.</p>
<h3><a class="anchor" id="autotoc_md53"></a>
A. True apparent R.A. and declination</h3>
<p>If you want to know the apparent R.A. and declination coordinates from the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> structure you obtained, then you can follow with:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> ra, dec; <span class="comment">// [h, deg] We&#39;ll return the apparent R.A. [h] and declination [deg] in these</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert the rectangular equatorial unit vector to R.A. [h] and declination [deg]</span></div>
<div class="line"><a class="code hl_function" href="util_8c.html#a84f672dc1c37e3af374198f29cbcfba9">vector2radec</a>(pos.<a class="code hl_variable" href="structsky__pos.html#a5fd669be4d5224aa192afa368a6e3173">r_hat</a>, &amp;ra, &amp;dec);</div>
<div class="ttc" id="astructsky__pos_html_a5fd669be4d5224aa192afa368a6e3173"><div class="ttname"><a href="structsky__pos.html#a5fd669be4d5224aa192afa368a6e3173">sky_pos::r_hat</a></div><div class="ttdeci">double r_hat[3]</div><div class="ttdoc">unit vector toward object (dimensionless)</div><div class="ttdef"><b>Definition</b> novas.h:1176</div></div>
<div class="ttc" id="autil_8c_html_a84f672dc1c37e3af374198f29cbcfba9"><div class="ttname"><a href="util_8c.html#a84f672dc1c37e3af374198f29cbcfba9">vector2radec</a></div><div class="ttdeci">short vector2radec(const double *restrict pos, double *restrict ra, double *restrict dec)</div><div class="ttdef"><b>Definition</b> util.c:396</div></div>
</div><!-- fragment --><p>Alternatively, you can simply call <code><a class="el" href="place_8c.html#a0f307c2a37d594a68e99c5c8af6d50c9">radec_star()</a></code> instead of <code><a class="el" href="place_8c.html#a1504058672e6e3cf24ce6b7189ede005">place_star()</a></code> to get apparent R.A. and declination in a single step if you do not need the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> data otherwise. If you followed the less-precise old methodology (Lieske et. al. 1977) thus far, calculating TOD coordinates, you are done here.</p>
<p>If, however, you calculated the position in CIRS with the more precise IAU 2006 methodology (as we did in the example above), you have one more step to go still. The CIRS equator is the true equator of date, however its origin (CIO) is not the true equinox of date. Thus, we must correct for the difference of the origins to get the true apparent R.A.:</p>
<div class="fragment"><div class="line">ra = <a class="code hl_function" href="transform_8c.html#af90d52a6527d9b62b8ac35d8c1ac7c6b">cirs_to_app_ra</a>(jd_tt, <a class="code hl_enumvalue" href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660">NOVAS_FULL_ACCURACY</a>, ra);</div>
<div class="ttc" id="atransform_8c_html_af90d52a6527d9b62b8ac35d8c1ac7c6b"><div class="ttname"><a href="transform_8c.html#af90d52a6527d9b62b8ac35d8c1ac7c6b">cirs_to_app_ra</a></div><div class="ttdeci">double cirs_to_app_ra(double jd_tt, enum novas_accuracy accuracy, double ra)</div><div class="ttdef"><b>Definition</b> transform.c:641</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md54"></a>
B. Azimuth and elevation angles at the observing location</h3>
<p>If your goal is to calculate the astrometric azimuth and zenith distance (= 90&deg; - elevation) angles of the source at the specified observing location (without refraction correction), you can proceed from the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> data you obtained from <code><a class="el" href="place_8c.html#a1504058672e6e3cf24ce6b7189ede005">place_star()</a></code> as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> itrs[3];  <span class="comment">// ITRS position vector of source to populate</span></div>
<div class="line"><span class="keywordtype">double</span> az, zd;   <span class="comment">// [deg] local azimuth and zenith distance angles to populate</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert CIRS to Earth-fixed ITRS using the pole offsets.</span></div>
<div class="line"><a class="code hl_function" href="transform_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs</a>(jd_tt, 0.0, ut1_to_tt, <a class="code hl_enumvalue" href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660">NOVAS_FULL_ACCURACY</a>, dx, dy, pos.<a class="code hl_variable" href="structsky__pos.html#a5fd669be4d5224aa192afa368a6e3173">r_hat</a>, itrs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Finally convert ITRS to local horizontal coordinates at the observing site</span></div>
<div class="line"><a class="code hl_function" href="system_8c.html#aef3c1f8e4c443e51e65003018449768a">itrs_to_hor</a>(itrs, &amp;obs.on_surface, &amp;az, &amp;zd);</div>
<div class="ttc" id="asystem_8c_html_aef3c1f8e4c443e51e65003018449768a"><div class="ttname"><a href="system_8c.html#aef3c1f8e4c443e51e65003018449768a">itrs_to_hor</a></div><div class="ttdeci">int itrs_to_hor(const on_surface *restrict location, const double *restrict itrs, double *restrict az, double *restrict za)</div><div class="ttdef"><b>Definition</b> system.c:159</div></div>
<div class="ttc" id="atransform_8c_html_aa2768d89d499a7155f90a6fd8c176d8d"><div class="ttname"><a href="transform_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs</a></div><div class="ttdeci">int cirs_to_itrs(double jd_tt_high, double jd_tt_low, double ut1_to_tt, enum novas_accuracy accuracy, double xp, double yp, const double *in, double *out)</div><div class="ttdef"><b>Definition</b> transform.c:827</div></div>
</div><!-- fragment --><p>Above we used <code><a class="el" href="transform_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs()</a></code> function, and then converted the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> rectangular equatorial unit vector calculated in CIRS to the Earth-fixed International Terrestrial Reference system (ITRS) using the small (arcsec-level) measured variation of the pole (dx, dy) provided explicitly since <code><a class="el" href="transform_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs()</a></code> does not use the values previously set via <code><a class="el" href="equinox_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole()</a></code>. Finally, <code><a class="el" href="system_8c.html#aef3c1f8e4c443e51e65003018449768a">itrs_to_hor()</a></code> converts the ITRS coordinates to the horizontal system at the observer location.</p>
<p>If you followed the old (Lieske et al. 1977) method instead to calculate <code><a class="el" href="structsky__pos.html">sky_pos</a></code> in the less precise TOD coordinate system, then you'd simply replace the <code><a class="el" href="transform_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs()</a></code> call above with <code><a class="el" href="transform_8c.html#a4551e2ac083e34c1b2b61b3805efb9a3">tod_to_itrs()</a></code> accordingly.</p>
<p>You can additionally apply an approximate optical refraction correction for the astrometric (unrefracted) zenith angle, if you want, e.g.:</p>
<div class="fragment"><div class="line">zd -= <a class="code hl_function" href="refract_8c.html#afe1d4e96dd66676f5567a279e83e88d9">refract_astro</a>(&amp;obs.<a class="code hl_variable" href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">on_surf</a>, <a class="code hl_enumvalue" href="novas_8h.html#abe97e2d459a30db9d0f67d8c60af3b81a7ed64c314f06fdf9acfa72beb531e73d">NOVAS_STANDARD_ATMOSPHERE</a>, zd);</div>
<div class="ttc" id="anovas_8h_html_abe97e2d459a30db9d0f67d8c60af3b81a7ed64c314f06fdf9acfa72beb531e73d"><div class="ttname"><a href="novas_8h.html#abe97e2d459a30db9d0f67d8c60af3b81a7ed64c314f06fdf9acfa72beb531e73d">NOVAS_STANDARD_ATMOSPHERE</a></div><div class="ttdeci">@ NOVAS_STANDARD_ATMOSPHERE</div><div class="ttdef"><b>Definition</b> novas.h:545</div></div>
<div class="ttc" id="arefract_8c_html_afe1d4e96dd66676f5567a279e83e88d9"><div class="ttname"><a href="refract_8c.html#afe1d4e96dd66676f5567a279e83e88d9">refract_astro</a></div><div class="ttdeci">double refract_astro(const on_surface *restrict location, enum novas_refraction_model model, double zd_astro)</div><div class="ttdef"><b>Definition</b> refract.c:64</div></div>
<div class="ttc" id="astructobserver_html_a45fe4eb871c346c1b8315c4c6a41e96d"><div class="ttname"><a href="structobserver.html#a45fe4eb871c346c1b8315c4c6a41e96d">observer::on_surf</a></div><div class="ttdeci">struct novas_on_surface on_surf</div><div class="ttdef"><b>Definition</b> novas.h:1151</div></div>
</div><!-- fragment --><p><a class="anchor" id="old-solsys-example"></a> </p>
<h1><a class="anchor" id="autotoc_md55"></a>
Calculating positions for a Solar-system source</h1>
<p>Solar-system sources work similarly to the above with a few important differences.</p>
<p>First, You will have to provide one or more functions to obtain the barycentric ICRS positions for your Solar-system source(s) of interest for the specific Barycentric Dynamical Time (TDB) of observation. See section on integrating <a class="el" href="index.html#solarsystem">External Solar-system ephemeris data or services</a> with SuperNOVAS. You can specify the functions that will handle the respective ephemeris data at runtime before making the NOVAS calls that need them, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Set the function to use for regular precision planet position calculations</span></div>
<div class="line"><a class="code hl_function" href="plugin_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(my_planet_function);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the function for high-precision planet position calculations</span></div>
<div class="line"><a class="code hl_function" href="plugin_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(my_very_precise_planet_function);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the function to use for calculating all sorts of solar-system bodies</span></div>
<div class="line"><a class="code hl_function" href="plugin_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephemeris_provider_function);</div>
<div class="ttc" id="aplugin_8c_html_a418f45a11ce7f92ba0ef817558415640"><div class="ttname"><a href="plugin_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a></div><div class="ttdeci">int set_planet_provider_hp(novas_planet_provider_hp func)</div><div class="ttdef"><b>Definition</b> plugin.c:184</div></div>
<div class="ttc" id="aplugin_8c_html_a6097083c438a8d1872c2e00a66360030"><div class="ttname"><a href="plugin_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a></div><div class="ttdeci">int set_ephem_provider(novas_ephem_provider func)</div><div class="ttdef"><b>Definition</b> plugin.c:67</div></div>
<div class="ttc" id="aplugin_8c_html_a9904c454bc7148b42d0f927b82ea3973"><div class="ttname"><a href="plugin_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a></div><div class="ttdeci">int set_planet_provider(novas_planet_provider func)</div><div class="ttdef"><b>Definition</b> plugin.c:143</div></div>
</div><!-- fragment --><p>You can use <code><a class="el" href="timescale_8c.html#a129acca41760da486e1179c93cb9e86d">tt2tdb()</a></code> to convert Terrestrial Time (TT) to Barycentric Dynamic Time (TDB) for your ephemeris provider functions (they only differ when you really need extreme precision &ndash; for most applications you can used TT and TDB interchangeably in the present era):</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> jd_tdb = jd_tt + <a class="code hl_function" href="timescale_8c.html#a129acca41760da486e1179c93cb9e86d">tt2tdb</a>(jd_tt) / 86400.0;</div>
<div class="ttc" id="atimescale_8c_html_a129acca41760da486e1179c93cb9e86d"><div class="ttname"><a href="timescale_8c.html#a129acca41760da486e1179c93cb9e86d">tt2tdb</a></div><div class="ttdeci">double tt2tdb(double jd_tt)</div><div class="ttdef"><b>Definition</b> timescale.c:178</div></div>
</div><!-- fragment --><p>Instead of <code><a class="el" href="target_8c.html#a39b2e39d29f1b57c5f785284ba7ca43f">make_cat_entry()</a></code> you define your source as an <code>object</code> with an name or ID number that is used by the ephemeris service you provided. For major planets you might want to use <code><a class="el" href="target_8c.html#a4c7846be95299769f4d0377bf127bcf5">make_planet()</a></code>, if they use a <code>novas_planet_provider</code> function to access ephemeris data with their NOVAS IDs, or else <code><a class="el" href="target_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object()</a></code> for more generic ephemeris handling via a user-provided <code>novas_ephem_provider</code>. E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> mars, ceres; <span class="comment">// Hold data on solar-system bodies.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Mars will be handled by the planet provider function</span></div>
<div class="line"><a class="code hl_function" href="target_8c.html#a4c7846be95299769f4d0377bf127bcf5">make_planet</a>(<a class="code hl_enumvalue" href="novas_8h.html#a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a>, &amp;mars);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Ceres will be handled by the generic ephemeris provider function, which let&#39;s say </span></div>
<div class="line"><span class="comment">// uses the NAIF ID of 2000001</span></div>
<div class="line"><a class="code hl_function" href="target_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a>(<span class="stringliteral">&quot;Ceres&quot;</span>, 2000001, &amp;ceres);</div>
<div class="ttc" id="anovas_8h_html_a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e"><div class="ttname"><a href="novas_8h.html#a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a></div><div class="ttdeci">@ NOVAS_MARS</div><div class="ttdoc">Major planet number for Mars in NOVAS.</div><div class="ttdef"><b>Definition</b> novas.h:316</div></div>
<div class="ttc" id="atarget_8c_html_a4c7846be95299769f4d0377bf127bcf5"><div class="ttname"><a href="target_8c.html#a4c7846be95299769f4d0377bf127bcf5">make_planet</a></div><div class="ttdeci">int make_planet(enum novas_planet num, object *restrict planet)</div><div class="ttdef"><b>Definition</b> target.c:203</div></div>
<div class="ttc" id="atarget_8c_html_aa22303f98df2d63edf6d8452ff3a43b2"><div class="ttname"><a href="target_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a></div><div class="ttdeci">int make_ephem_object(const char *name, long num, object *body)</div><div class="ttdef"><b>Definition</b> target.c:439</div></div>
</div><!-- fragment --><p>Other than that, it's the same spiel as before, except using the appropriate <code><a class="el" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c">place()</a></code> for generic celestial targets instead of <code><a class="el" href="place_8c.html#a1504058672e6e3cf24ce6b7189ede005">place_star()</a></code> for the sidereal sources (or else <code><a class="el" href="place_8c.html#a918c8244e44c69f1589d9f4bf5355d16">radec_planet()</a></code> instead of <code><a class="el" href="place_8c.html#a0f307c2a37d594a68e99c5c8af6d50c9">radec_star()</a></code>). E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c">place</a>(jd_tt, &amp;mars, &amp;obs, ut1_to_tt, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, <a class="code hl_enumvalue" href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56aebffd24170ffab949609a8dcfc201660">NOVAS_FULL_ACCURACY</a>, &amp;pos);</div>
<div class="line"><span class="keywordflow">if</span>(status) {</div>
<div class="line">  <span class="comment">// Oops, something went wrong...</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="aplace_8c_html_aca09ed0d2379ac4a4841c9e3edeeee4c"><div class="ttname"><a href="place_8c.html#aca09ed0d2379ac4a4841c9e3edeeee4c">place</a></div><div class="ttdeci">short place(double jd_tt, const object *restrict source, const observer *restrict location, double ut1_to_tt, enum novas_reference_system coord_sys, enum novas_accuracy accuracy, sky_pos *restrict output)</div><div class="ttdef"><b>Definition</b> place.c:226</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
