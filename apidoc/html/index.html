<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta charset="utf-8"/>
<meta name="description" content="SuperNOVAS C/C++ astrometry library"/>
<meta name="keywords" content="astronomy, astrometry, C, C++, C99, software library, open source, NOVAS"/>
<meta name="author" content="Attila Kovacs"/>
<meta name="copyright" content="(C)2024 Attila Kovacs" />
<meta name="robots" content="index,follow"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HLFWKSM8V9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HLFWKSM8V9');
</script>
<link rel="shortcut icon" type="image/x-icon" href="/SuperNOVAS/resources/favicon.ico" />
<link rel="icon" type="image/png" sizes="192x192" href="/SuperNOVAS/resources/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="/SuperNOVAS/resources/android-chrome-512x512.png" />
<link rel="apple-touch-icon" type="image/png" href="/SuperNOVAS/resources/apple-touch-icon.png" />
<title>SuperNOVAS: SuperNOVAS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="smithsonian-logo-55x55.png"/></td>
  <td id="projectalign">
   <div id="projectname">SuperNOVAS<span id="projectnumber">&#160;v1.2</span>
   </div>
   <div id="projectbrief">The NOVAS C library, made better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SuperNOVAS </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README-orig"></a> The NOVAS C astrometry library, made better.</p>
<ul>
<li><a href="https://smithsonian.github.io/SuperNOVAS/apidoc/html/files.html">API documentation</a>.</li>
<li><a href="https://smithsonian.github.io/SuperNOVAS">SuperNOVAS pages</a> on github.io</li>
</ul>
<p><a href="https://github.com/Smithsonian/SuperNOVAS/">SuperNOVAS</a> is a C/C++ astronomy software library, providing high-precision astrometry such as one might need for running an observatory or a precise planetarium program. It is a fork of the Naval Observatory Vector Astrometry Software (<a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a>) C version 3.1, providing bug fixes, tons of extra features, while making it easier (and safer) to use also.</p>
<p>SuperNOVAS is entirely free to use without licensing restrictions. Its source code is compatible with the C99 standard, and hence should be suitable for old and new platforms alike. It is light-weight and easy to use, with full support for the IAU 2000/2006 standards for sub-microarcsecond position calculations.</p>
<p>This document has been updated for the <code>v1.2</code> and later releases.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Table of Contents</h2>
<ul>
<li><a class="el" href="index.html#introduction">Introduction</a></li>
<li><a class="el" href="index.html#fixed-issues">Fixed NOVAS C 3.1 issues</a></li>
<li><a class="el" href="index.html#compatibility">Compatibility with NOVAS C 3.1</a></li>
<li><a class="el" href="index.html#installation">Building and installation</a></li>
<li><a class="el" href="index.html#integration">Building your application with SuperNOVAS</a></li>
<li><a class="el" href="index.html#examples">Example usage</a></li>
<li><a class="el" href="index.html#tips">Tips and tricks</a></li>
<li><a class="el" href="index.html#precision">Notes on precision</a></li>
<li><a class="el" href="index.html#supernovas-features">SuperNOVAS specific features</a></li>
<li><a class="el" href="index.html#solarsystem">Incorporating Solar-system ephemeris data or services</a></li>
<li><a class="el" href="index.html#debug-support">Runtime debug support</a></li>
<li><a class="el" href="index.html#release-schedule">Release schedule</a></li>
</ul>
<hr  />
<p><a class="anchor" id="introduction"></a> </p>
<h2><a class="anchor" id="autotoc_md34"></a>
Introduction</h2>
<p>SuperNOVAS is a fork of the The Naval Observatory Vector Astrometry Software (<a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a>).</p>
<p>The primary goal of SuperNOVAS is to improve on the stock NOVAS C library via:</p>
<ul>
<li>Fixing <a class="el" href="index.html#fixed-issues">outstanding issues</a>.</li>
<li>Improved <a href="https://smithsonian.github.io/SuperNOVAS/apidoc/html/files.html">API documentation</a>.</li>
<li><a class="el" href="index.html#added-functionality">New features</a>.</li>
<li><a class="el" href="index.html#api-changes">Refining the API</a> to promote best programming practices.</li>
<li><a class="el" href="index.html#multi-threading">Thread-safe calculations</a>.</li>
<li><a class="el" href="index.html#debug-mode">Debug mode</a> with informative error tracing.</li>
<li><a href="https://codecov.io/gh/Smithsonian/SuperNOVAS">Regression testing</a> and continuous integration on GitHub.</li>
</ul>
<p>At the same time, SuperNOVAS aims to be fully backward compatible with the intended functionality of the upstream NOVAS C library, such that it can be used as a <em>build-time</em> replacement for NOVAS in your application without having to change existing (functional) code you may have written for NOVAS C.</p>
<p>SuperNOVAS is currently based on NOVAS C version 3.1. We plan to rebase SuperNOVAS to the latest upstream release of the NOVAS C library, if new releases become available.</p>
<p>SuperNOVAS is maintained by <a href="https://github.com/attipaci">Attila Kov√°cs</a> at the Center for Astrophysics | Harvard &amp; Smithsonian, and it is available through the <a href="https://github.com/Smithsonian/SuperNOVAS">Smithsonian/SuperNOVAS</a> repository on GitHub.</p>
<p>Outside contributions are very welcome. See <a href="https://github.com/Smithsonian/SuperNOVAS/CONTRIBUTING.md">how you can contribute</a> to make SuperNOVAS even better.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Related links</h3>
<ul>
<li><a href="https://aa.usno.navy.mil/software/novas_info">NOVAS</a> home page at the US Naval Observatory.</li>
<li><a href="https://calceph.imcce.fr/docs/4.0.0/html/c/index.html">CALCEPH C library</a> for integrating Solar-system ephemerides from JPL and/or in INPOP 2.0/3.0 format.</li>
<li><a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF SPICE toolkit</a> for integrating Solar-system ephemerides from JPL.</li>
<li><a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> for building CSPICE as a shared library for dynamic linking.</li>
<li><a href="https://www.minorplanetcenter.net/iau/mpc.html">IAU Minor Planet Center</a> provides up-to-date orbital elements for asteroid and comets, including for newly discovered objects.</li>
</ul>
<hr  />
<p><a class="anchor" id="fixed-issues"></a> </p>
<h2><a class="anchor" id="autotoc_md37"></a>
Fixed NOVAS C 3.1 issues</h2>
<p>The SuperNOVAS library fixes a number of outstanding issues with NOVAS C 3.1. Here is a list of issues and fixes provided by SuperNOVAS over the upstream NOVAS C 3.1 code:</p>
<ul>
<li>Fixes the <a href="https://aa.usno.navy.mil/software/novas_faq">sidereal_time bug</a>, whereby the <code><a class="el" href="novas_8c.html#a3236e72771f2c363f342547d80f5d50f">sidereal_time()</a></code> function had an incorrect unit cast. This was a documented issue of NOVAS C 3.1.</li>
<li>Fixes the <a href="https://aa.usno.navy.mil/software/novas_faq">ephem_close bug</a>, whereby <code><a class="el" href="eph__manager_8c.html#a333da81ba7453316e26f32f628fefc0e">ephem_close()</a></code> in <code><a class="el" href="eph__manager_8c.html">eph_manager.c</a></code> did not reset the <code>EPHFILE</code> pointer to NULL. This was a documented issue of NOVAS C 3.1.</li>
<li>Fixes antedating velocities and distances for light travel time in <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code>. When getting positions and velocities for Solar-system sources, it is important to use the values from the time light originated from the observed body rather than at the time that light arrives to the observer. This correction was done properly for positions, but not for velocities or distances, resulting in incorrect observed radial velocities or apparent distances being reported for spectroscopic observations or for angular-physical size conversions.</li>
<li>Fixes bug in <code><a class="el" href="novas_8c.html#aea0e1028baf14d16d9de800e36a17086">ira_equinox()</a></code> which may return the result for the wrong type of equinox (mean vs. true) if the <code>equinox</code> argument was changing from 1 to 0, and back to 1 again with the date being held the same. This affected routines downstream also, such as <code><a class="el" href="novas_8c.html#a3236e72771f2c363f342547d80f5d50f">sidereal_time()</a></code>.</li>
<li>Fixes accuracy switching bug in <code><a class="el" href="novas_8c.html#a07f83fbb8a57cf442c264ecdc979475e">cio_basis()</a></code>, <code><a class="el" href="novas_8c.html#a43141f0ea4598d6c87193c3ea594dd6c">cio_location()</a></code>, <code><a class="el" href="super_8c.html#afb3abc403e84a4821c3d00dc9186eed5">ecl2equ()</a></code>, <code><a class="el" href="novas_8c.html#aa05ecc76c1ccc0c3445f8b642d6c5311">equ2ecl_vec()</a></code>, <code><a class="el" href="novas_8c.html#a6fa1eada41005ac70290d0bb5df1ec26">ecl2equ_vec()</a></code>, <code><a class="el" href="novas_8c.html#a581ef7bb3d2261a105d7086fc1768c97">geo_posvel()</a></code>, <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code>, and <code><a class="el" href="novas_8c.html#a3236e72771f2c363f342547d80f5d50f">sidereal_time()</a></code>. All these functions returned a cached value for the other accuracy if the other input parameters are the same as a prior call, except the accuracy.</li>
<li>Fixes multiple bugs related to using cached values in <code><a class="el" href="novas_8c.html#a07f83fbb8a57cf442c264ecdc979475e">cio_basis()</a></code> with alternating CIO location reference systems. This affected many CIRS-based position calculations downstream.</li>
<li>Fixes bug in <code><a class="el" href="novas_8c.html#aa05ecc76c1ccc0c3445f8b642d6c5311">equ2ecl_vec()</a></code> and <code><a class="el" href="novas_8c.html#a6fa1eada41005ac70290d0bb5df1ec26">ecl2equ_vec()</a></code> whereby a query with <code>coord_sys = 2</code> (GCRS) has overwritten the cached mean obliquity value for <code>coord_sys = 0</code> (mean equinox of date). As a result, a subsequent call with <code>coord_sys = 0</code> and the same date as before would return the results in GCRS coordinates instead of the requested mean equinox of date coordinates.</li>
<li>Some remainder calculations in NOVAS C 3.1 used the result from <code>fmod()</code> unchecked, which resulted in angles outside of the expected [0:2&pi;] range and was also the reason why <code><a class="el" href="novas_8c.html#a410a61c67f5893584b09953fa4885fe5">cal_date()</a></code> did not work for negative JD values.</li>
<li>Fixes <code><a class="el" href="novas_8c.html#a033f1bf4b01e0e21a0e05e13c19c02f6">aberration()</a></code> returning NaN vectors if the <code>ve</code> argument is 0. It now returns the unmodified input vector appropriately instead.</li>
<li>Fixes unpopulated <code>az</code> output value in <code><a class="el" href="novas_8c.html#a5f229207d8a775119565a52f7e586cf8">equ2hor()</a></code> at zenith. While any azimuth is acceptable really, it results in unpredictable behavior. Hence, we set <code>az</code> to 0.0 for zenith to be consistent.</li>
<li>Fixes potential string overflows and eliminates associated compiler warnings.</li>
<li>[<b>v1.1</b>] Fixes division by zero bug in <code><a class="el" href="novas_8c.html#ad799864f637c483fb49491bde5a93e25">d_light()</a></code> if the first position argument is the ephemeris reference position (e.g. the Sun for <code><a class="el" href="solsys3_8c.html">solsys3.c</a></code>). The bug affects for example <code><a class="el" href="novas_8c.html#a48f90ac20950507fad9b880a7f7f2383">grav_def()</a></code>, where it effectively results in the gravitational deflection due to the Sun being skipped.</li>
<li>[<b>v1.1</b>] The NOVAS C 3.1 implementation of <code><a class="el" href="novas_8c.html#a9f76e2386515e2023172e05891c3fa28">rad_vel()</a></code> has a number of issues that produce inaccurate results. The errors are typically at or below the tens of m/s level for objects not moving at relativistic speeds.</li>
</ul>
<hr  />
<p><a class="anchor" id="compatibility"></a> </p>
<h2><a class="anchor" id="autotoc_md39"></a>
Compatibility with NOVAS C 3.1</h2>
<p>SuperNOVAS strives to maintain API compatibility with the upstream NOVAS C 3.1 library, but not binary (ABI) compatibility.</p>
<p>If you have code that was written for NOVAS C 3.1, it should work with SuperNOVAS as is, without modifications. Simply (re)build your application against SuperNOVAS, and you are good to go.</p>
<p>The lack of binary compatibility just means that you cannot drop-in replace your compiled objects (e.g. <code>novas.o</code>, or the static <code>libnovas.a</code>, or the shared <code>libnovas.so</code>) libraries, from NOVAS C 3.1 with those from SuperNOVAS. Instead, you will have to build (compile) your application referencing the SuperNOVAS headers and/or libraries from the start.</p>
<p>This is because some function signatures have changed, e.g. to use an <code>enum</code> argument instead of the nondescript <code>short int</code> argument of NOVAS C 3.1, or because we added a return value to a function that was declared <code>void</code> in NOVAS C 3.1. We also changed the <code>object</code> structure to contain a <code>long</code> ID number instead of <code>short</code> to accommodate JPL NAIF codes, for which 16-bit storage is insufficient.</p>
<hr  />
<p><a class="anchor" id="installation"></a> </p>
<h2><a class="anchor" id="autotoc_md41"></a>
Building and installation</h2>
<p>The SuperNOVAS distribution contains a GNU <code>Makefile</code>, which is suitable for compiling the library (as well as local documentation, and tests, etc.) on POSIX systems such as Linux, BSD, MacOS X, or Cygwin or WSL. (At this point we do not provide a similar native build setup for Windows, but speak up if you would like to add it yourself!)</p>
<p>Before compiling the library take a look a <code>config.mk</code> and edit it as necessary for your needs, or else define the necessary variables in the shell prior to invoking <code>make</code>. For example:</p>
<ul>
<li>Choose which planet calculator function routines are built into the library (for example to provide <code><a class="el" href="solsys3_8c.html#ab5d74f84f8e75e90dfc30ebde562d076">earth_sun_calc()</a></code> set <code>BUILTIN_SOLSYS3 = 1</code> and/or for <code><a class="el" href="solsys-ephem_8c.html#a61c60adf57c00d797fac94bb5841c271">planet_ephem_provider()</a></code> set <code>BUILTIN_SOLSYS_EPHEM = 1</code>. You can then specify these functions (or others) as your planet calculator of choice for <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code> in your application dynamically via <code><a class="el" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider()</a></code>.</li>
<li><a href="https://www.imcce.fr/recherche/equipes/asd/calceph/">CALCEPH</a> C library integration is automatic if <code>ldconfig</code> can locate the <code>libcalceph</code> shared library. You can also control CALCEPH integration manually, e.g. by setting <code>CALCEPH_SUPPORT = 1</code> in <code>config.mk</code> or in the shell prior to the build. CALCEPH integration will require an accessible installation of the CALCEPH development files (C headers and unversioned static or shared libraries depending on the needs of the build).</li>
<li><a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF CSPICE Toolkit</a> integration automatic, if <code>ldconfig</code> can locate the <code>libcspice</code> shared library. You can also control CSPICE integration manually, e.g. by setting <code>CSPICE_SUPPORT = 1</code> in <code>config.mk</code> or in the shell prior to the build. CSPICE integration will require an accessible installation of the CSPICE development files (C headers, under a <code>cspice/</code> sub-folder in the header search path, and unversioned static or shared libraries depending on the needs of the build). You might want to check out the <a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> repository for building CSPICE as a shared library.</li>
<li>Choose which stock planetary calculator module (if any) should provide a default <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> implementation for <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code> calls by setting <code>DEFAULT_SOLSYS</code> to 1 &ndash; 3 for <code><a class="el" href="solsys1_8c.html">solsys1.c</a></code> trough <code><a class="el" href="solsys3_8c.html">solsys3.c</a></code>, respectively. If you want to link your own <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> implementation(s) against the library, you should not set <code>DEFAULT_SOLSYS</code> (i.e. delete or comment out the corresponding line or else set <code>DEFAULT_SOLSYS</code> to 0).</li>
<li>You may also specify the source file that will provide a <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementation, by setting <code>DEFAULT_READEPH</code>. (The default setting uses the dummy <code>readeph0.c</code> which simply returns an error). Note, that a <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementation is a relic of NOVAS C and not generally needed. You can provide a superior ephemeris reader implementation at runtime via the <code><a class="el" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider()</a></code> call or equivalent (e.g. <code><a class="el" href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph()</a></code> or <code><a class="el" href="solsys-cspice_8c.html#a9b44218bca5fce1e9e5103494c15dde4">novas_use_cspice()</a></code>, if they are available).</li>
<li>If you want to use a CIO locator file for <code><a class="el" href="novas_8c.html#a43141f0ea4598d6c87193c3ea594dd6c">cio_location()</a></code>, you can specify the path to the CIO locator file (e.g. <code>/usr/local/share/supernovas/CIO_RA.TXT</code>) on your system e.g. by setting the <code>CIO_LOCATOR_FILE</code> shell variable prior to calling <code>make</code>. (The CIO locator file is not necessary for the functioning of the library, unless you specifically require CIO positions relative to GCRS.)</li>
<li>If your compiler does not support the C11 standard and it is not GCC &gt;=3.3, but provides some non-standard support for declaring thread-local variables, you may want to pass the keyword to use to declare variables as thread local via <code>-DTHREAD_LOCAL=...</code> added to <code>CFLAGS</code>. (Don't forget to enclose the string value in escaped quotes in <code>config.mk</code>, or unescaped if defining the <code>THREAD_LOCAL</code> shell variable prior to invoking <code>make</code>.)</li>
</ul>
<p>Additionally, you may set number of environment variables to futher customize the build, such as:</p>
<ul>
<li><code>CC</code>: The C compiler to use (default: <code>gcc</code>).</li>
<li><code>CPPFLAGS</code>: C preprocessor flags, such as externally defined compiler constants.</li>
<li><code>CFLAGS</code>: Flags to pass onto the C compiler (default: <code>-g -Os -Wall</code>). Note, <code>-Iinclude</code> will be added automatically.</li>
<li><code>CSTANDARD</code>: Optionally, specify the C standard to compile for, e.g. <code>c99</code> to compile for the C99 standard. If defined then <code>-std=$(CSTANDARD)</code> is added to <code>CFLAGS</code> automatically.</li>
<li><code>WEXTRA</code>: If set to 1, <code>-Wextra</code> is added to <code>CFLAGS</code> automatically.</li>
<li><code>LDFLAGS</code>: Extra linker flags (default is <em>not set</em>). Note, <code>-lm -lxchange</code> will be added automatically.</li>
<li><code>CHECKEXTRA</code>: Extra options to pass to <code>cppcheck</code> for the <code>make check</code> target</li>
</ul>
<p>Now you are ready to build the library:</p>
<div class="fragment"><div class="line">$ make</div>
</div><!-- fragment --><p>will compile the shared (e.g. <code>lib/libsupernovas.so</code>) libraries, produce a CIO locator data file (e.g. <code>tools/data/cio_ra.bin</code>), and compile the API documentation (into <code>apidoc/</code>) using <code>doxygen</code> (if available). Alternatively, you can build select components of the above with the <code>make</code> targets <code>shared</code>, and <code>local-dox</code> respectively. And, if unsure, you can always call <code>make help</code> to see what build targets are available.</p>
<p>After building the library you can install the above components to the desired locations on your system. For a system-wide install you may simply run:</p>
<div class="fragment"><div class="line">$ sudo make install</div>
</div><!-- fragment --><p>Or, to install in some other locations, you may set a prefix and/or <code>DESTDIR</code>. For example, to install under <code>/opt</code> instead, you can:</p>
<div class="fragment"><div class="line">$ sudo make prefix=&quot;/opt&quot; install</div>
</div><!-- fragment --><p>Or, to stage the installation (to <code>/usr</code>) under a 'build root':</p>
<div class="fragment"><div class="line">$ make DESTDIR=&quot;/tmp/stage&quot; install</div>
</div><!-- fragment --><hr  />
<p><a class="anchor" id="integration"></a> </p>
<h2><a class="anchor" id="autotoc_md43"></a>
Building your application with SuperNOVAS</h2>
<p>Provided you have installed the SuperNOVAS headers into a standard location, you can build your application against it easily. For example, to build <code>myastroapp.c</code> against SuperNOVAS, you might have a <code>Makefile</code> with contents like:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) $^ -lm -lsupernovas</div>
</div><!-- fragment --><p>If you have a legacy NOVAS C 3.1 application, it is possible that the compilation will give you errors due to missing includes for <code>stdio.h</code>, <code>stdlib.h</code>, <code>ctype.h</code> or <code>string.h</code>. This is because these headers were explicitly included by <code><a class="el" href="novas_8h.html">novas.h</a></code> in NOVAS C 3.1, but not in SuperNOVAS (at least not by default), as a matter of best practice. If this is a problem for you can 'fix' it in one of two ways: (1) Add the missing <code>#include</code> directives to your application source explicitly, or if that's not an option for you, then (2) set the <code>-DCOMPAT=1</code> compiler flag when compiling your application:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) -DCOMPAT=1 $^ -lm -lsupernovas</div>
</div><!-- fragment --><p>If your application uses optional planet or ephemeris calculator modules, you may need to specify the appropriate optional shared library also:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) $^ -lm -lsupernovas -lsolsys-calceph</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md44"></a>
Legacy linking &lt;tt&gt;solarsystem()&lt;/tt&gt; and &lt;tt&gt;readeph()&lt;/tt&gt; modules</h3>
<p>The NOVAS C way to handle planet or other ephemeris functions was to link particular modules to provide the <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> / <code><a class="el" href="solsys-ephem_8c.html#a0243c2489c22860de898115aed8ffc87">solarsystem_hp()</a></code> and <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> functions. This approach is discouraged in SuperNOVAS, since we now allow selecting different implementations at runtime, but the old way is supported for legacy applications, nevertheless.</p>
<p>To use your own existing default <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> implementation in this way, you must build the library with <code>DEFAULT_SOLSYS</code> unset (or else set to 0) in <code>config.mk</code> (see section above), and your applications <code>Makefile</code> may contain something like:</p>
<div class="fragment"><div class="line">myastroapp: myastroapp.c my_solsys.c </div>
<div class="line">  $(CC) -o $@ $(CFLAGS) $^ -lm -lsupernovas</div>
</div><!-- fragment --><p>The same principle applies to using your specific <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementation (only with <code>DEFAULT_READEPH</code> being unset in <code>config.mk</code>).</p>
<h3><a class="anchor" id="autotoc_md45"></a>
Legacy modules: a better way...</h3>
<p>Note, a better way to recycle your old planet and ephemeris calculator modules may be to rename <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> / <code><a class="el" href="solsys-ephem_8c.html#a0243c2489c22860de898115aed8ffc87">solarsystem_hp()</a></code> functions therein to e.g. <code>my_planet_calculator()</code> / <code>my_planet_calculator_hp()</code> and then in your application can specify these functions as the provider at runtime:</p>
<div class="fragment"><div class="line">set_planet_calculator(my_planet_calculator);</div>
<div class="line">set_planet_calculator(my_planet_calculator_hp);</div>
</div><!-- fragment --><p>For <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementations, it is recommended that you change both the name and the footprint to e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_ephem_provider(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, <span class="keywordtype">double</span> jd_tdb_high, <span class="keywordtype">double</span> jd_tdb_low, </div>
<div class="line">                      <span class="keyword">enum</span> <a class="code hl_enumeration" href="novas_8h.html#a208120c5fa3e12853eb37cb99d3e27be">novas_origin</a> *origin, <span class="keywordtype">double</span> *pos, <span class="keywordtype">double</span> *vel);</div>
<div class="ttc" id="anovas_8h_html_a208120c5fa3e12853eb37cb99d3e27be"><div class="ttname"><a href="novas_8h.html#a208120c5fa3e12853eb37cb99d3e27be">novas_origin</a></div><div class="ttdeci">novas_origin</div><div class="ttdef"><b>Definition</b> novas.h:531</div></div>
</div><!-- fragment --><p>and then then apply it in your application as:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephem_provider);</div>
<div class="ttc" id="anovas_8c_html_a6097083c438a8d1872c2e00a66360030"><div class="ttname"><a href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a></div><div class="ttdeci">int set_ephem_provider(novas_ephem_provider func)</div><div class="ttdef"><b>Definition</b> novas.c:5732</div></div>
</div><!-- fragment --><p>While it requires some minimal changes to the old code, the advantage of this preferred approach is (a) that you do not need to re-build the library with the <code>DEFAULT_SOLSYS</code> and <code>DEFAULT_READEPH</code> options disabled, and (b) you can switch between different planet and ephemeris calculator functions at will, during runtime.</p>
<hr  />
<p><a class="anchor" id="examples"></a> </p>
<h2><a class="anchor" id="autotoc_md47"></a>
Example usage</h2>
<ul>
<li><a class="el" href="index.html#methodologies">Note on alternative methodologies</a></li>
<li><a class="el" href="index.html#sidereal-example">Calculating positions for a sidereal source</a></li>
<li><a class="el" href="index.html#solsys-example">Calculating positions for a Solar-system source</a></li>
</ul>
<p>SuperNOVAS <b>v1.1</b> has introduced a new, more intuitive, more elegant, and more efficient approach for calculating astrometric positions of celestial objects. The guide below is geared towards this new method. However, the original NOVAS C approach remains viable also (albeit often less efficient). You may find an equivalent example usage showcasing the original NOVAS method in <a href="LEGACY.html">LEGACY.md</a>.</p>
<p><a class="anchor" id="methodologies"></a> </p>
<h3><a class="anchor" id="autotoc_md48"></a>
Note on alternative methodologies</h3>
<p>The IAU 2000 and 2006 resolutions have completely overhauled the system of astronomical coordinate transformations to enable higher precision astrometry. (Super)NOVAS supports coordinate calculations both in the old (pre IAU 2000) ways, and in the new IAU standard method. Here is an overview of how the old and new methods define some of the terms differently:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Concept   </th><th class="markdownTableHeadNone">Old standard   </th><th class="markdownTableHeadNone">New IAU standard    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Catalog coordinate system   </td><td class="markdownTableBodyNone">FK4, FK5, HIP...   </td><td class="markdownTableBodyNone">International Celestial Reference System (ICRS)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Dynamical system   </td><td class="markdownTableBodyNone">True of Date (TOD)   </td><td class="markdownTableBodyNone">Celestial Intermediate Reference System (CIRS)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Dynamical R.A. origin   </td><td class="markdownTableBodyNone">equinox of date   </td><td class="markdownTableBodyNone">Celestial Intermediate Origin (CIO)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Precession, nutation, bias   </td><td class="markdownTableBodyNone">separate, no tidal terms   </td><td class="markdownTableBodyNone">IAU 2006 precession/nutation model    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Celestial Pole offsets   </td><td class="markdownTableBodyNone">d&psi;, d&epsilon;   </td><td class="markdownTableBodyNone"><em>dx</em>, <em>dy</em>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Earth rotation measure   </td><td class="markdownTableBodyNone">Greenwich Sidereal Time (GST)   </td><td class="markdownTableBodyNone">Earth Rotation Angle (ERA)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fixed Earth System   </td><td class="markdownTableBodyNone">WGS84   </td><td class="markdownTableBodyNone">International Terrestrial Reference System (ITRS)   </td></tr>
</table>
<p>See the various enums and constants defined in <code><a class="el" href="novas_8h.html">novas.h</a></code>, as well as the descriptions on the various NOVAS routines on how they are appropriate for the old and new methodologies respectively. Figure 1 also shows the relation of the various old and new coordinate systems and the (Super)NOVAS functions for converting position / velocity vectors among them.</p>
<p>In NOVAS, the barycentric BCRS and the geocentric GCRS systems are effectively synonymous to ICRS, since the origin for positions and for velocities, in any reference system, is determined by the <code>observer</code> location, while aberration and gravitational deflection is included for apparent places only (as seen from the observer location).</p>
<p>Older catalogs, such as B1950 (FK4) or B1900 are just special cases of MOD (mean-of-date) coordinates for the B1950 and B1900 epochs, respectively.</p>
<p>TIRS (Terrestrial Intermediate Reference System) and its older equivalent PEF (Pseudo-Earth-Fixed) are not explicitly referenced in SuperNOVAS. But they can be thought of as a special case of ITRS (International Terrestrial Reference System) with zero polar offsets (<em>dx</em>, <em>dy</em>).</p>
<p>WGS84 has been superseded by ITRS for higher accuracy definitions of Earth-based locations. WGS84 matches ITRS to the 10m level globally, but it does not account for continental drifts and crustal motion. In (Super)NOVAS all Earth-fixed coordinates are effectively assumed as ITRS, whether explicitly or implicitly. There is nothing WGS84-specific in the implementation.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><img src="resources/SuperNOVAS-systems.png" alt="SuperNOVAS coordinate systems and conversions" class="inline"/>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Figure 1.</b> <em>SuperNOVAS Coordinate Systems and Conversions</em>. Functions indicated in bold face are available in NOVAS C also. All other functions are available in SuperNOVAS only. Dotted arrows indicate possible loss of precision due to the inadequacy of the old precession-nutation (Lieske et al. 1977) model.   </td></tr>
</table>
<p><a class="anchor" id="sidereal-example"></a> </p>
<h3><a class="anchor" id="autotoc_md49"></a>
Calculating positions for a sidereal source</h3>
<p>A sidereal source may be anything beyond the solar-system with 'fixed' catalog coordinates. It may be a star, or a galactic molecular cloud, or a distant quasar.</p>
<h4><a class="anchor" id="autotoc_md50"></a>
Specify the object of interest</h4>
<p>First, you must provide the coordinates (which may include proper motion and parallax). Let's assume we pick a star for which we have B1950 (i.e. FK4) coordinates:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structcat__entry.html">cat_entry</a> star; <span class="comment">// Structure to contain information on sidereal source </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Let&#39;s assume we have B1950 (FK4) coordinates...</span></div>
<div class="line"><span class="comment">// 16h26m20.1918s, -26d19m23.138s (B1950), proper motion -12.11, -23.30 mas/year, </span></div>
<div class="line"><span class="comment">// parallax 5.89 mas, radial velocity -3.4 km/s.</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a9950f7973fc3b5d40b0d0a9f4eceddac">make_cat_entry</a>(<span class="stringliteral">&quot;Antares&quot;</span>, <span class="stringliteral">&quot;FK4&quot;</span>, 1, 16.43894213, -26.323094, -12.11, -23.30, 5.89, -3.4, &amp;star);</div>
<div class="ttc" id="anovas_8c_html_a9950f7973fc3b5d40b0d0a9f4eceddac"><div class="ttname"><a href="novas_8c.html#a9950f7973fc3b5d40b0d0a9f4eceddac">make_cat_entry</a></div><div class="ttdeci">short make_cat_entry(const char *star_name, const char *catalog, long cat_num, double ra, double dec, double pm_ra, double pm_dec, double parallax, double rad_vel, cat_entry *star)</div><div class="ttdef"><b>Definition</b> novas.c:6701</div></div>
<div class="ttc" id="astructcat__entry_html"><div class="ttname"><a href="structcat__entry.html">cat_entry</a></div><div class="ttdef"><b>Definition</b> novas.h:692</div></div>
</div><!-- fragment --><p>We must convert these coordinates to the now standard ICRS system for calculations in SuperNOVAS, first by calculating equivalent J2000 coordinates, by applying the proper motion and the appropriate precession. Then, we apply a small adjustment to convert from J2000 to ICRS coordinates.</p>
<div class="fragment"><div class="line"><span class="comment">// First change the catalog coordinates (in place) to the J2000 (FK5) system... </span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a>(<a class="code hl_enumvalue" href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1">CHANGE_EPOCH</a>, <a class="code hl_define" href="novas_8h.html#a3785083ae52bbbc1e749dbedd7e5d85e">NOVAS_JD_B1950</a>, &amp;star, <a class="code hl_define" href="novas_8h.html#a31bf4a08940bfa3e97ae6a1abee80422">NOVAS_JD_J2000</a>, <span class="stringliteral">&quot;FK5&quot;</span>, &amp;star);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then convert J2000 coordinates to ICRS (also in place). Here the dates don&#39;t matter...</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a>(<a class="code hl_enumvalue" href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8">CHANGE_J2000_TO_ICRS</a>, 0.0, &amp;star, 0.0, <span class="stringliteral">&quot;ICRS&quot;</span>, &amp;star);</div>
<div class="ttc" id="anovas_8c_html_abe0c6e6fc60a49efa88c365aef8cdc50"><div class="ttname"><a href="novas_8c.html#abe0c6e6fc60a49efa88c365aef8cdc50">transform_cat</a></div><div class="ttdeci">short transform_cat(enum novas_transform_type option, double jd_tt_in, const cat_entry *in, double jd_tt_out, const char *out_id, cat_entry *out)</div><div class="ttdef"><b>Definition</b> novas.c:6209</div></div>
<div class="ttc" id="anovas_8h_html_a31bf4a08940bfa3e97ae6a1abee80422"><div class="ttname"><a href="novas_8h.html#a31bf4a08940bfa3e97ae6a1abee80422">NOVAS_JD_J2000</a></div><div class="ttdeci">#define NOVAS_JD_J2000</div><div class="ttdoc">[day] Julian date at J2000</div><div class="ttdef"><b>Definition</b> novas.h:106</div></div>
<div class="ttc" id="anovas_8h_html_a3785083ae52bbbc1e749dbedd7e5d85e"><div class="ttname"><a href="novas_8h.html#a3785083ae52bbbc1e749dbedd7e5d85e">NOVAS_JD_B1950</a></div><div class="ttdeci">#define NOVAS_JD_B1950</div><div class="ttdoc">[day] Julian date at B1950</div><div class="ttdef"><b>Definition</b> novas.h:112</div></div>
<div class="ttc" id="anovas_8h_html_ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8"><div class="ttname"><a href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a84da44f7510d8c99353b1b1c6bb4faf8">CHANGE_J2000_TO_ICRS</a></div><div class="ttdeci">@ CHANGE_J2000_TO_ICRS</div><div class="ttdef"><b>Definition</b> novas.h:570</div></div>
<div class="ttc" id="anovas_8h_html_ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1"><div class="ttname"><a href="novas_8h.html#ace5e59ce1564bf6c61946c290bb05367a882f5d97444df44485d360ce298843b1">CHANGE_EPOCH</a></div><div class="ttdeci">@ CHANGE_EPOCH</div><div class="ttdoc">The combined equivalent of PROPER_MOTION and PRECESSION together.</div><div class="ttdef"><b>Definition</b> novas.h:566</div></div>
</div><!-- fragment --><p>(Naturally, you can skip the transformation steps above if you have defined your source in ICRS coordinates from the start.) Once the catalog entry is defined in ICRS, you can proceed wrapping it in a generic source structure (which handles both catalog and Solar-system sources).</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> source;   <span class="comment">// Common structure for a sidereal or an Solar-system source</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrap it in a generic source data structure</span></div>
<div class="line"><a class="code hl_function" href="super_8c.html#ab9b7a622486f2904615ceed1ba94cd8f">make_cat_object</a>(&amp;star, &amp;source);</div>
<div class="ttc" id="asuper_8c_html_ab9b7a622486f2904615ceed1ba94cd8f"><div class="ttname"><a href="super_8c.html#ab9b7a622486f2904615ceed1ba94cd8f">make_cat_object</a></div><div class="ttdeci">int make_cat_object(const cat_entry *star, object *source)</div><div class="ttdef"><b>Definition</b> super.c:1016</div></div>
</div><!-- fragment --><p>Alternatively, for high-_z_ sources you might use <code><a class="el" href="super_8c.html#a11aa3ce6bcdda5b7065b38d6cfaf63d3">make_redshifted_cat_entry()</a></code> or <code><a class="el" href="super_8c.html#ae579a49d84696a913fd0d9f348bb5b11">make_redshifted_object()</a></code> instead, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> quasar;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 12h29m6.6997s +2d3m8.598s (ICRS) z=0.158339</span></div>
<div class="line"><a class="code hl_function" href="super_8c.html#ae579a49d84696a913fd0d9f348bb5b11">make_redshifted_object</a>(<span class="stringliteral">&quot;3c273&quot;</span>, 12.4851944, 2.0523883, 0.158339, &amp;quasar);</div>
<div class="ttc" id="asuper_8c_html_ae579a49d84696a913fd0d9f348bb5b11"><div class="ttname"><a href="super_8c.html#ae579a49d84696a913fd0d9f348bb5b11">make_redshifted_object</a></div><div class="ttdeci">int make_redshifted_object(const char *name, double ra, double dec, double z, object *source)</div><div class="ttdef"><b>Definition</b> super.c:1142</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md51"></a>
Specify the observer location</h4>
<p>Next, we define the location where we observe from. Here we can (but don't have to) specify local weather parameters (temperature and pressure) also for refraction correction later (in this example, we'll skip the weather):</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structobserver.html">observer</a> obs;    <span class="comment">// Structure to contain observer location </span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Specify the location we are observing from</span></div>
<div class="line"><span class="comment">// 50.7374 deg N, 7.0982 deg E, 60m elevation</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a00d9f6909923cd3e559c8f011ff9b794">make_observer_on_surface</a>(50.7374, 7.0982, 60.0, 0.0, 0.0, &amp;obs);</div>
<div class="ttc" id="anovas_8c_html_a00d9f6909923cd3e559c8f011ff9b794"><div class="ttname"><a href="novas_8c.html#a00d9f6909923cd3e559c8f011ff9b794">make_observer_on_surface</a></div><div class="ttdeci">int make_observer_on_surface(double latitude, double longitude, double height, double temperature, double pressure, observer *obs)</div><div class="ttdef"><b>Definition</b> novas.c:6959</div></div>
<div class="ttc" id="astructobserver_html"><div class="ttname"><a href="structobserver.html">observer</a></div><div class="ttdef"><b>Definition</b> novas.h:999</div></div>
</div><!-- fragment --><p>Similarly, you can also specify observers in Earth orbit, in Sun orbit, at the geocenter, or at the Solar-system barycenter.</p>
<h4><a class="anchor" id="autotoc_md52"></a>
Specify the time of observation</h4>
<p>Next, we set the time of observation. For a ground-based observer, you will need to provide SuperNOVAS with the UT1 - UTC time difference (a.k.a. DUT1), and the current leap seconds. Let's assume 37 leap seconds, and DUT1 = 0.114, then we can set the time of observation, for example, using the current UNIX time:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__timespec.html">novas_timespec</a> obs_time;       <span class="comment">// Structure that will define astrometric time</span></div>
<div class="line"><span class="keyword">struct </span>timespec unix_time;     <span class="comment">// Standard precision UNIX time structure</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the current system time, with up to nanosecond resolution...</span></div>
<div class="line">clock_gettime(CLOCK_REALTIME, &amp;unix_time);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the time of observation to the precise UTC-based UNIX time</span></div>
<div class="line"><a class="code hl_function" href="timescale_8c.html#abacd89aa380c85da2d3c19a7e2187df3">novas_set_unix_time</a>(unix_time.tv_sec, unix_time.tv_nsec, 37, 0.114, &amp;obs_time);</div>
<div class="ttc" id="astructnovas__timespec_html"><div class="ttname"><a href="structnovas__timespec.html">novas_timespec</a></div><div class="ttdef"><b>Definition</b> novas.h:1080</div></div>
<div class="ttc" id="atimescale_8c_html_abacd89aa380c85da2d3c19a7e2187df3"><div class="ttname"><a href="timescale_8c.html#abacd89aa380c85da2d3c19a7e2187df3">novas_set_unix_time</a></div><div class="ttdeci">int novas_set_unix_time(time_t unix_time, long nanos, int leap, double dut1, novas_timespec *time)</div><div class="ttdef"><b>Definition</b> timescale.c:425</div></div>
</div><!-- fragment --><p>Alternatively, you may set the time as a Julian date in the time measure of choice (UTC, UT1, TT, TDB, GPS, TAI, TCG, or TCB):</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> jd_tai = ...     <span class="comment">// TAI-based Julian Date </span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="timescale_8c.html#ac272a018a213965f07b21ac6facb4a62">novas_set_time</a>(<a class="code hl_enumvalue" href="novas_8h.html#aa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a>, jd_tai, leap_seconds, dut1, &amp;obs_time);</div>
<div class="ttc" id="anovas_8h_html_aa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b"><div class="ttname"><a href="novas_8h.html#aa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a></div><div class="ttdeci">@ NOVAS_TAI</div><div class="ttdoc">Innternational Atomic Time (TAI)</div><div class="ttdef"><b>Definition</b> novas.h:1056</div></div>
<div class="ttc" id="atimescale_8c_html_ac272a018a213965f07b21ac6facb4a62"><div class="ttname"><a href="timescale_8c.html#ac272a018a213965f07b21ac6facb4a62">novas_set_time</a></div><div class="ttdeci">int novas_set_time(enum novas_timescale timescale, double jd, int leap, double dut1, novas_timespec *time)</div><div class="ttdef"><b>Definition</b> timescale.c:69</div></div>
</div><!-- fragment --><p>or, for the best precision we may do the same with an integer / fractional split:</p>
<div class="fragment"><div class="line"><span class="keywordtype">long</span> ijd_tai = ...     <span class="comment">// Integer part of the TAI-based Julian Date</span></div>
<div class="line"><span class="keywordtype">double</span> fjd_tai = ...   <span class="comment">// Fractional part of the TAI-based Julian Date </span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="timescale_8c.html#a37c8f2d5e1ad2daed78d1bd7991fdba4">novas_set_split_time</a>(<a class="code hl_enumvalue" href="novas_8h.html#aa642c4ccc7195dc62fd0dc56567ebd0ba328f2523f4f064c5252f4ac858bddc4b">NOVAS_TAI</a>, ijd_tai, fjd_tai, 37, 0.114, &amp;obs_time);</div>
<div class="ttc" id="atimescale_8c_html_a37c8f2d5e1ad2daed78d1bd7991fdba4"><div class="ttname"><a href="timescale_8c.html#a37c8f2d5e1ad2daed78d1bd7991fdba4">novas_set_split_time</a></div><div class="ttdeci">int novas_set_split_time(enum novas_timescale timescale, long ijd, double fjd, int leap, double dut1, novas_timespec *time)</div><div class="ttdef"><b>Definition</b> timescale.c:114</div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md53"></a>
Set up the observing frame</h4>
<p>Next, we set up an observing frame, which is defined for a unique combination of the observer location and the time of observation:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structnovas__frame.html">novas_frame</a> obs_frame;  <span class="comment">// Structure that will define the observing frame</span></div>
<div class="line"><span class="keywordtype">double</span> dx = ...         <span class="comment">// [mas] Earth polar offset x, e.g. from IERS Bulletin A.</span></div>
<div class="line"><span class="keywordtype">double</span> dy = ...         <span class="comment">// [mas] Earth polar offset y, from same source as above.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the observing frame with the given observing parameters</span></div>
<div class="line"><a class="code hl_function" href="frames_8c.html#abfee69517c7432733c8382c88371c983">novas_make_frame</a>(<a class="code hl_enumvalue" href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846">NOVAS_REDUCED_ACCURACY</a>, &amp;obs, &amp;obs_time, dx, dy, &amp;obs_frame);</div>
<div class="ttc" id="aframes_8c_html_abfee69517c7432733c8382c88371c983"><div class="ttname"><a href="frames_8c.html#abfee69517c7432733c8382c88371c983">novas_make_frame</a></div><div class="ttdeci">int novas_make_frame(enum novas_accuracy accuracy, const observer *obs, const novas_timespec *time, double dx, double dy, novas_frame *frame)</div><div class="ttdef"><b>Definition</b> frames.c:315</div></div>
<div class="ttc" id="anovas_8h_html_a3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846"><div class="ttname"><a href="novas_8h.html#a3cba2735c32163fab062b1a904a83b56a2047c8bae25010adb60d895a83079846">NOVAS_REDUCED_ACCURACY</a></div><div class="ttdeci">@ NOVAS_REDUCED_ACCURACY</div><div class="ttdef"><b>Definition</b> novas.h:462</div></div>
<div class="ttc" id="astructnovas__frame_html"><div class="ttname"><a href="structnovas__frame.html">novas_frame</a></div><div class="ttdef"><b>Definition</b> novas.h:1131</div></div>
</div><!-- fragment --><p>Here <code>dx</code> and <code>dy</code> are small diurnal (sub-arcsec level) corrections to Earth orientation, which are published in the <a href="https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html">IERS Bulletins</a>. They are needed when converting positions from the celestial CIRS frame to the Earth-fixed ITRS frame. You may ignore these and set zeroes if sub-arcsecond precision is not required.</p>
<p>The advantage of using the observing frame, is that it enables very fast position calculations for multiple objects in that frame. So, if you need to calculate positions for thousands of sources for the same observer and time, it will be significantly faster than using the low-level NOVAS C routines instead. You can create derivative frames for different observer locations, if need be, via <code><a class="el" href="frames_8c.html#a2972b3eafa2d7f6c29cff34bad9fcf0d">novas_change_observer()</a></code>.</p>
<p>Note that without a proper ephemeris provider for the major planets, you are invariably restricted to working with <code>NOVAS_REDUCED_ACCURACY</code> frames, providing milliarcsecond precision only. To create <code>NOVAS_FULL_ACCURACY</code> frames, with sub-&mu;as precision, you will you will need a high-precision ephemeris provider for the major planets (beyond the low-precision Earth and Sun calculator included by default), to account for gravitational bending around massive planets. Without it, &mu;as accuracy cannot be ensured, in general. Therefore, attempting to construct high-accuracy frames without an appropriate high-precision ephemeris provider will result in an error from the requisite <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code> call.</p>
<h4><a class="anchor" id="autotoc_md54"></a>
Calculate an apparent place on sky</h4>
<p>Now we can calculate the apparent R.A. and declination for our source, which includes proper motion (for sidereal sources) or light-time correction (for Solar-system bodies), and also aberration corrections for the moving observer and gravitational deflection around the major Solar System bodies. You can calculate an apparent location in the coordinate system of choice (ICRS/GCRS, CIRS, J2000, MOD, or TOD):</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structsky__pos.html">sky_pos</a> apparent;    <span class="comment">// Structure containing the precise observed position</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="frames_8c.html#a4e894a83f3065bbb706212d1267dd2ab">novas_sky_pos</a>(&amp;source, &amp;obs_frame, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, &amp;apparent);</div>
<div class="ttc" id="aframes_8c_html_a4e894a83f3065bbb706212d1267dd2ab"><div class="ttname"><a href="frames_8c.html#a4e894a83f3065bbb706212d1267dd2ab">novas_sky_pos</a></div><div class="ttdeci">int novas_sky_pos(const object *object, const novas_frame *frame, enum novas_reference_system sys, sky_pos *out)</div><div class="ttdef"><b>Definition</b> frames.c:614</div></div>
<div class="ttc" id="anovas_8h_html_a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044"><div class="ttname"><a href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a></div><div class="ttdeci">@ NOVAS_CIRS</div><div class="ttdef"><b>Definition</b> novas.h:390</div></div>
<div class="ttc" id="astructsky__pos_html"><div class="ttname"><a href="structsky__pos.html">sky_pos</a></div><div class="ttdef"><b>Definition</b> novas.h:1019</div></div>
</div><!-- fragment --><p>Apart from providing precise apparent R.A. and declination coordinates, the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> structure also provides the <em>x,y,z</em> unit vector pointing in the observed direction of the source (in the designated coordinate system). We also get radial velocity (for spectroscopy), and apparent distance for Solar-system bodies (e.g. for apparent-to-physical size conversion).</p>
<p>Note, that if you want geometric positions (and/or velocities) instead, without aberration and gravitational deflection, you might use <code><a class="el" href="frames_8c.html#ae6f4d3710a277c8b284487fe175e4d49">novas_geom_posvel()</a></code> instead. And regardless, which function you use you can always easily and efficiently change the coordinate system in which your results are expressed by creating an appropriate transform via <code><a class="el" href="frames_8c.html#a4d179c8573319fc25c775ce56ba055dc">novas_make_transform()</a></code> and then using <code><a class="el" href="frames_8c.html#aadb7bc88119eed4ea54373a42e22a0d4">novas_transform_vector()</a></code> or <code>novas_transform_skypos()</code>.</p>
<h4><a class="anchor" id="autotoc_md55"></a>
Calculate azimuth and elevation angles at the observing location</h4>
<p>If your ultimate goal is to calculate the azimuth and elevation angles of the source at the specified observing location, you can proceed from the <code><a class="el" href="structsky__pos.html">sky_pos</a></code> data you obtained above (in whichever coordinate system!) as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> az, el;   <span class="comment">// [deg] local azimuth and elevation angles to populate</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert the apparent position in CIRS on sky to horizontal coordinates</span></div>
<div class="line"><a class="code hl_function" href="frames_8c.html#ae84debf8ab4d3b16feaaefdcb0ebbd08">novas_app_to_hor</a>(&amp;obs_frame, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eacbee2de517939c156e61fb5f9631e044">NOVAS_CIRS</a>, apparent.<a class="code hl_variable" href="structsky__pos.html#a713a0c71a86d92fa6892fdb2cb7c9422">ra</a>, apparent.<a class="code hl_variable" href="structsky__pos.html#ac4ae7989694321b540abb75c30eec690">dec</a>, <a class="code hl_function" href="refract_8c.html#ab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a>, &amp;az, &amp;el);</div>
<div class="ttc" id="aframes_8c_html_ae84debf8ab4d3b16feaaefdcb0ebbd08"><div class="ttname"><a href="frames_8c.html#ae84debf8ab4d3b16feaaefdcb0ebbd08">novas_app_to_hor</a></div><div class="ttdeci">int novas_app_to_hor(const novas_frame *frame, enum novas_reference_system sys, double ra, double dec, RefractionModel ref_model, double *az, double *el)</div><div class="ttdef"><b>Definition</b> frames.c:773</div></div>
<div class="ttc" id="arefract_8c_html_ab04bff3b97c132e358e11c3a5b7a3081"><div class="ttname"><a href="refract_8c.html#ab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction</a></div><div class="ttdeci">double novas_standard_refraction(double jd_tt, const on_surface *loc, enum novas_refraction_type type, double el)</div><div class="ttdef"><b>Definition</b> refract.c:98</div></div>
<div class="ttc" id="astructsky__pos_html_a713a0c71a86d92fa6892fdb2cb7c9422"><div class="ttname"><a href="structsky__pos.html#a713a0c71a86d92fa6892fdb2cb7c9422">sky_pos::ra</a></div><div class="ttdeci">double ra</div><div class="ttdoc">[h] apparent, topocentric, or astrometric right ascension (hours)</div><div class="ttdef"><b>Definition</b> novas.h:1021</div></div>
<div class="ttc" id="astructsky__pos_html_ac4ae7989694321b540abb75c30eec690"><div class="ttname"><a href="structsky__pos.html#ac4ae7989694321b540abb75c30eec690">sky_pos::dec</a></div><div class="ttdeci">double dec</div><div class="ttdoc">[deg] apparent, topocentric, or astrometric declination (degrees)</div><div class="ttdef"><b>Definition</b> novas.h:1022</div></div>
</div><!-- fragment --><p>Above we converted the apparent coordinates, assuming they were calculated in CIRS, to refracted azimuth and elevation coordinates at the observing location, using the <code><a class="el" href="refract_8c.html#ab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction()</a></code> function to provide a suitable refraction correction. We could have used <code><a class="el" href="refract_8c.html#ae4511a80a1defbb1e1fdc29c289e7de4">novas_optical_refraction()</a></code> instead to use the weather data embedded in the frame's <code>observer</code> structure, or some user-defined refraction model, or else <code>NULL</code> to calculate unrefracted elevation angles.</p>
<p><a class="anchor" id="solsys-example"></a> </p>
<h3><a class="anchor" id="autotoc_md56"></a>
Calculating positions for a Solar-system source</h3>
<p>Solar-system sources work similarly to the above with a few important differences.</p>
<p>First, You will have to provide one or more functions to obtain the barycentric ICRS positions for your Solar-system source(s) of interest for the specific Barycentric Dynamical Time (TDB) of observation. See section on integrating <a class="el" href="index.html#solarsystem">External Solar-system ephemeris data or services</a> with SuperNOVAS. You can specify the functions that will handle the respective ephemeris data at runtime before making the NOVAS calls that need them, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Set the function to use for regular precision planet position calculations</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(my_planet_function);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the function for high-precision planet position calculations</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(my_very_precise_planet_function);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the function to use for calculating all other solar-system bodies</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephemeris_provider_function);</div>
<div class="ttc" id="anovas_8c_html_a418f45a11ce7f92ba0ef817558415640"><div class="ttname"><a href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a></div><div class="ttdeci">int set_planet_provider_hp(novas_planet_provider_hp func)</div><div class="ttdef"><b>Definition</b> novas.c:739</div></div>
<div class="ttc" id="anovas_8c_html_a9904c454bc7148b42d0f927b82ea3973"><div class="ttname"><a href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a></div><div class="ttdeci">int set_planet_provider(novas_planet_provider func)</div><div class="ttdef"><b>Definition</b> novas.c:698</div></div>
</div><!-- fragment --><p>Or, if you have the CALCEPH library installed on your system, and you have built SuperNOVAS with <code>CALCEPH_SUPPORT = 1</code>, then you might call:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas-calceph_8h.html">novas-calceph.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use calceph to open se set of ephemeris files...</span></div>
<div class="line">t_calcephbin *ephem_data = calceph_open_array(...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use CALCEPH with the specified data for all Solar-system objects.</span></div>
<div class="line"><a class="code hl_function" href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph</a>(ephem_data);</div>
<div class="ttc" id="anovas-calceph_8h_html"><div class="ttname"><a href="novas-calceph_8h.html">novas-calceph.h</a></div></div>
<div class="ttc" id="asolsys-calceph_8c_html_a35fc86a939602ec910dbdfde180d7f31"><div class="ttname"><a href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph</a></div><div class="ttdeci">int novas_use_calceph(t_calcephbin *eph)</div><div class="ttdef"><b>Definition</b> solsys-calceph.c:379</div></div>
</div><!-- fragment --><p>Next, instead of <code><a class="el" href="super_8c.html#ab9b7a622486f2904615ceed1ba94cd8f">make_cat_object()</a></code> you define your source as an <code>object</code> with an name or ID number that is used by the ephemeris service you provided. For major planets you might want to use <code><a class="el" href="novas_8c.html#a618bbba887b9bc9e7df878234c66c215">make_planet()</a></code>, if they use a <code>novas_planet_provider</code> function to access ephemeris data with their NOVAS IDs, or else <code><a class="el" href="super_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object()</a></code> for more generic ephemeris handling via a user-provided <code>novas_ephem_provider</code>. E.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> mars, ceres; <span class="comment">// Hold data on solar-system bodies.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Mars will be handled by the planet provider function</span></div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a618bbba887b9bc9e7df878234c66c215">make_planet</a>(<a class="code hl_enumvalue" href="novas_8h.html#a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a>, &amp;mars);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Ceres will be handled by the generic ephemeris provider function, which let&#39;s say </span></div>
<div class="line"><span class="comment">// uses the NAIF ID of 2000001</span></div>
<div class="line"><a class="code hl_function" href="super_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a>(<span class="stringliteral">&quot;Ceres&quot;</span>, 2000001, &amp;ceres);</div>
<div class="ttc" id="anovas_8c_html_a618bbba887b9bc9e7df878234c66c215"><div class="ttname"><a href="novas_8c.html#a618bbba887b9bc9e7df878234c66c215">make_planet</a></div><div class="ttdeci">int make_planet(enum novas_planet num, object *planet)</div><div class="ttdef"><b>Definition</b> novas.c:6849</div></div>
<div class="ttc" id="anovas_8h_html_a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e"><div class="ttname"><a href="novas_8h.html#a219df36b21dc4476656e708d14d08045a479f3eb097c0aeb4ac7dc3ae2e6c376e">NOVAS_MARS</a></div><div class="ttdeci">@ NOVAS_MARS</div><div class="ttdoc">Major planet number for the Mars in NOVAS.</div><div class="ttdef"><b>Definition</b> novas.h:275</div></div>
<div class="ttc" id="asuper_8c_html_aa22303f98df2d63edf6d8452ff3a43b2"><div class="ttname"><a href="super_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object</a></div><div class="ttdeci">int make_ephem_object(const char *name, long num, object *body)</div><div class="ttdef"><b>Definition</b> super.c:1048</div></div>
</div><!-- fragment --><p>As of version 1.2 you can also define solar system sources with orbital elements (such as the most up-to-date ones provided by the <a href="https://minorplanetcenter.net/data">Minor Planet Center</a> for asteroids, comets, etc.):</p>
<div class="fragment"><div class="line"><span class="keywordtype">object</span> NEA;       <span class="comment">// e.g. a Near-Earth Asteroid</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fill in the orbital parameters (pay attention to units!)</span></div>
<div class="line"><a class="code hl_struct" href="structnovas__orbital.html">novas_orbital</a> orbit = <a class="code hl_define" href="novas_8h.html#a85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a>;</div>
<div class="line">orbit.<a class="code hl_variable" href="structnovas__orbital.html#a1031d0e0a97a340abfe0a6ab9e831045">a</a> = ...;    <span class="comment">// Major axis in AU...</span></div>
<div class="line">...           <span class="comment">// ... and the rest of the orbital elements</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create an object for that orbit</span></div>
<div class="line"><a class="code hl_function" href="super_8c.html#a3c5e215babeeba078ca7b3e9be42e555">make_orbital_object</a>(<span class="stringliteral">&quot;NEAxxx&quot;</span>, -1, &amp;orbit, &amp;NEA);</div>
<div class="ttc" id="anovas_8h_html_a85243a6b9eee259d3fb84ee1a587e065"><div class="ttname"><a href="novas_8h.html#a85243a6b9eee259d3fb84ee1a587e065">NOVAS_ORBIT_INIT</a></div><div class="ttdeci">#define NOVAS_ORBIT_INIT</div><div class="ttdef"><b>Definition</b> novas.h:806</div></div>
<div class="ttc" id="astructnovas__orbital_html"><div class="ttname"><a href="structnovas__orbital.html">novas_orbital</a></div><div class="ttdef"><b>Definition</b> novas.h:785</div></div>
<div class="ttc" id="astructnovas__orbital_html_a1031d0e0a97a340abfe0a6ab9e831045"><div class="ttname"><a href="structnovas__orbital.html#a1031d0e0a97a340abfe0a6ab9e831045">novas_orbital::a</a></div><div class="ttdeci">double a</div><div class="ttdoc">[AU] semi-major axis</div><div class="ttdef"><b>Definition</b> novas.h:788</div></div>
<div class="ttc" id="asuper_8c_html_a3c5e215babeeba078ca7b3e9be42e555"><div class="ttname"><a href="super_8c.html#a3c5e215babeeba078ca7b3e9be42e555">make_orbital_object</a></div><div class="ttdeci">int make_orbital_object(const char *name, long num, const novas_orbital *orbit, object *body)</div><div class="ttdef"><b>Definition</b> super.c:1075</div></div>
</div><!-- fragment --><p>Note, that even with orbital elements, you will, in general, require a planet calculator, to provide precise positions for the Sun or planet, around which the orbit is defined.</p>
<p>Other than that, it's the same spiel as before, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="frames_8c.html#a4e894a83f3065bbb706212d1267dd2ab">novas_sky_pos</a>(&amp;mars, &amp;obs_frame, <a class="code hl_enumvalue" href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3">NOVAS_TOD</a>, &amp;apparent);</div>
<div class="line"><span class="keywordflow">if</span>(status) {</div>
<div class="line">  <span class="comment">// Oops, something went wrong...</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="anovas_8h_html_a7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3"><div class="ttname"><a href="novas_8h.html#a7ba038ea34eb901ccfb8f785708c651eaa4bcd4fdb15ba77023241689a5608df3">NOVAS_TOD</a></div><div class="ttdeci">@ NOVAS_TOD</div><div class="ttdef"><b>Definition</b> novas.h:386</div></div>
</div><!-- fragment --><hr  />
<p><a class="anchor" id="tips"></a> </p>
<h2><a class="anchor" id="autotoc_md58"></a>
Tips and tricks</h2>
<ul>
<li><a class="el" href="index.html#accuracy-notes">Reduced accuracy shortcuts</a></li>
<li><a class="el" href="index.html#multi-threading">Multi-threaded calculations</a></li>
<li><a class="el" href="index.html#physical-units">Physical units</a></li>
</ul>
<p><a class="anchor" id="accuracy-notes"></a> </p>
<h3><a class="anchor" id="autotoc_md59"></a>
Reduced accuracy shortcuts</h3>
<p>When one does not need positions at the microarcsecond level, some shortcuts can be made to the recipe above:</p>
<ul>
<li>You can use <code>NOVAS_REDUCED_ACCURACY</code> instead of <code>NOVAS_FULL_ACCURACY</code> for the calculations. This typically has an effect at or below the milliarcsecond level only, but may be much faster to calculate.</li>
<li>You might skip the pole offsets <em>dx</em>, <em>dy</em>. These are tenths of arcsec, typically.</li>
</ul>
<p><a class="anchor" id="multi-threading"></a> </p>
<h3><a class="anchor" id="autotoc_md60"></a>
Multi-threaded calculations</h3>
<p>Some of the calculations involved can be expensive from a computational perspective. For the most typical use case however, NOVAS (and SuperNOVAS) has a trick up its sleeve: it caches the last result of intensive calculations so they may be re-used if the call is made with the same environmental parameters again (such as JD time and accuracy).</p>
<p>A direct consequence of the caching of results in NOVAS is that calculations are generally not thread-safe as implemented by the original NOVAS C 3.1 library. One thread may be in the process of returning cached values for one set of input parameters while, at the same time, another thread is saving cached values for a different set of parameters. Thus, when running calculations in more than one thread, the results returned may at times be incorrect, or more precisely they may not correspond to the requested input parameters.</p>
<p>While you should never call NOVAS C from multiple threads simultaneously, SuperNOVAS caches the results in thread local variables (provided your compiler supports it), and is therefore generally safe to use in multi-threaded applications. Just make sure that you:</p>
<ul>
<li>use a compiler which supports the C11 language standard;</li>
<li>or, compile with GCC &gt;= 3.3;</li>
<li>or else, set the appropriate non-standard keyword to use for declaring thread-local variables for your compiler in <code>config.mk</code> or in your equivalent build setup.</li>
</ul>
<p><a class="anchor" id="physical-units"></a> </p>
<h3><a class="anchor" id="autotoc_md61"></a>
Physical units</h3>
<p>The NOVAS API has been using conventional units (e.g. AU, km, day, deg, h) typically for its parameters and return values alike. Hence, SuperNOVAS follows the same conventions for its added functions and data structures also. However, when interfacing SuperNOVAS with other programs, libraries, or data files, it is often necessary to use quantities that are expressed in different units, such as SI or CGS. To facilitate such conversions, <code><a class="el" href="novas_8h.html">novas.h</a></code> provides a set of unit constants, which can be used for converting to/from SI units (and radians). For example, <code><a class="el" href="novas_8h.html">novas.h</a></code> contains the following definitions:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#define NOVAS_DAY                 86400.0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NOVAS_DEGREE              (M_PI / 180.0)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NOVAS_HOURANGLE           (M_PI / 12.0)</span></div>
</div><!-- fragment --><p>You can use these, for example, to convert quantities expressed in conventional units for NOVAS to standard (SI) values, by multiplying NOVAS quantities with the corresponding unit definition. E.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// A difference in Julian Dates [day] in seconds.</span></div>
<div class="line"><span class="keywordtype">double</span> delta_t = (tjd - tjd0) * <a class="code hl_define" href="novas_8h.html#a0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// R.A. [h] / declination [deg] converted radians (e.g. for trigonometric functions).</span></div>
<div class="line"><span class="keywordtype">double</span> ra_rad = ra_h * <a class="code hl_define" href="novas_8h.html#aee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a>;</div>
<div class="line"><span class="keywordtype">double</span> dec_rad = dec_d * <a class="code hl_define" href="novas_8h.html#a6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a>; </div>
<div class="ttc" id="anovas_8h_html_a0b0c2c5ccc61c8740de2e2ac277cd836"><div class="ttname"><a href="novas_8h.html#a0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a></div><div class="ttdeci">#define NOVAS_DAY</div><div class="ttdoc">[s] The length of a synodic day, that is 24 hours exactly.</div><div class="ttdef"><b>Definition</b> novas.h:124</div></div>
<div class="ttc" id="anovas_8h_html_a6d9698dbaf6260d7fe8a531a0e96d2a8"><div class="ttname"><a href="novas_8h.html#a6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a></div><div class="ttdeci">#define NOVAS_DEGREE</div><div class="ttdoc">[rad] A degree expressed in radians.</div><div class="ttdef"><b>Definition</b> novas.h:127</div></div>
<div class="ttc" id="anovas_8h_html_aee2680f03d1dfa4c9fbeea2be806dbf7"><div class="ttname"><a href="novas_8h.html#aee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a></div><div class="ttdeci">#define NOVAS_HOURANGLE</div><div class="ttdoc">[rad] An hour of angle expressed in radians.</div><div class="ttdef"><b>Definition</b> novas.h:136</div></div>
</div><!-- fragment --><p>And vice-versa: to convert values expressed in standard (SI) units, you can divide by the appropriate constant to 'cast' an SI value into the particular physical unit, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Increment a Julian Date [day] with some time differential [s].</span></div>
<div class="line"><span class="keywordtype">double</span> tjd = tjd0 + delta_t / <a class="code hl_define" href="novas_8h.html#a0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// convert R.A. / declination in radians to hours and degrees</span></div>
<div class="line"><span class="keywordtype">double</span> ra_h = ra_rad / <a class="code hl_define" href="novas_8h.html#aee2680f03d1dfa4c9fbeea2be806dbf7">NOVAS_HOURANGLE</a>;</div>
<div class="line"><span class="keywordtype">double</span> dec_d = dec_rad / <a class="code hl_define" href="novas_8h.html#a6d9698dbaf6260d7fe8a531a0e96d2a8">NOVAS_DEGREE</a>;</div>
</div><!-- fragment --><p>Finally, you can combine them to convert between two different conventional units, e.g.:</p>
<div class="fragment"><div class="line"><span class="comment">// Convert angle from [h] -&gt; [rad] -&gt; [deg]</span></div>
<div class="line"><span class="keywordtype">double</span> lst_d = lst_h * HOURANGLE / DEGREE; </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert [AU/day] -&gt; [m/s] (SI) -&gt; [km/s]</span></div>
<div class="line"><span class="keywordtype">double</span> v_kms = v_auday * (<a class="code hl_define" href="novas_8h.html#abc8f275a2d431e59a1ec9e276abaca1a">NOVAS_AU</a> / <a class="code hl_define" href="novas_8h.html#a0b0c2c5ccc61c8740de2e2ac277cd836">NOVAS_DAY</a>) / <a class="code hl_define" href="novas_8h.html#a0a84af1a760ed2aaa01dd93e9e22bdf1">NOVAS_KM</a></div>
<div class="ttc" id="anovas_8h_html_a0a84af1a760ed2aaa01dd93e9e22bdf1"><div class="ttname"><a href="novas_8h.html#a0a84af1a760ed2aaa01dd93e9e22bdf1">NOVAS_KM</a></div><div class="ttdeci">#define NOVAS_KM</div><div class="ttdoc">[m] A kilometer (km) in meters.</div><div class="ttdef"><b>Definition</b> novas.h:139</div></div>
<div class="ttc" id="anovas_8h_html_abc8f275a2d431e59a1ec9e276abaca1a"><div class="ttname"><a href="novas_8h.html#abc8f275a2d431e59a1ec9e276abaca1a">NOVAS_AU</a></div><div class="ttdeci">#define NOVAS_AU</div><div class="ttdef"><b>Definition</b> novas.h:144</div></div>
</div><!-- fragment --><hr  />
<p><a class="anchor" id="precision"></a> </p>
<h2><a class="anchor" id="autotoc_md63"></a>
Notes on precision</h2>
<p>Many of the (Super)NOVAS functions take an accuracy argument, which determines to what precision quantities are calculated. The argument can have one of two values, which correspond to typical precisions around:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>enum novas_accuracy</code> value   </th><th class="markdownTableHeadNone">Typical precision    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_REDUCED_ACCURACY</code>   </td><td class="markdownTableBodyNone">~ 1 milli-arcsecond (mas)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NOVAS_FULL_ACCURACY</code>   </td><td class="markdownTableBodyNone">below 1 micro-arcsecond (&mu;as)   </td></tr>
</table>
<p>Note, that some functions will not support full accuracy calculations, unless you have provided a high-precision ephemeris provider for the major planets (and any Solar-system bodies of interest), which does not come with SuperNOVAS out of the box. In the absense of a suitable high-precision ephemeris provider, some functions might return an error if called with <code>NOVAS_FULL_ACCURACY</code>.</p>
<h3><a class="anchor" id="autotoc_md64"></a>
Prerequisites to precise results</h3>
<p>The SuperNOVAS library is in principle capable of calculating positions to sub-microarcsecond, and velocities to mm/s, precision for all types of celestial sources. However, there are certain prerequisites and practical considerations before that level of accuracy is reached.</p>
<ol type="1">
<li><b>IAU 2000/2006 conventions</b>: High precision calculations will generally require that you use SuperNOVAS with the new IAU standard quantities and methods. The old ways were simply not suited for precision much below the milliarcsecond level.</li>
<li><b>Gravitational bending</b>: Calculations much below the milliarcsecond level will require to account for gravitational bending around massive Solar-system bodies, and hence will require you to provide a high-precision ephemeris provider for the major planets. Without it, there is no guarantee of achieving the desired &mu;as-level precision in general, especially when observing near massive planets (e.g. observing Jupiter's or Saturn's moons, near transit). Therefore some functions will return with an error, if used with <code>NOVAS_FULL_ACCURACY</code> in the absense of a suitable high-precision planetary ephemeris provider.</li>
<li><b>Solar-system sources</b>: Precise calculations for Solar-system sources requires precise ephemeris data for both the target object as well as for Earth, and the Sun. For the highest precision calculations you also need positions for all major planets to calculate gravitational deflection precisely. By default SuperNOVAS can only provide approximate positions for the Earth and Sun (see <code><a class="el" href="solsys3_8c.html#ab5d74f84f8e75e90dfc30ebde562d076">earth_sun_calc()</a></code> in <code><a class="el" href="solsys3_8c.html">solsys3.c</a></code>), but certainly not at the sub-microarcsecond level, and not for other solar-system sources. You will need to provide a way to interface SuperNOVAS with a suitable ephemeris source (such as the CSPICE toolkit from JPL or CALCEPH) if you want to use it to obtain precise positions for Solar-system bodies. See the <a class="el" href="index.html#solarsystem">section further below</a> for more information how you can do that.</li>
<li><b>Earth's polar motion</b>: Calculating precise positions for any Earth-based observations requires precise knowledge of Earth orientation at the time of observation. The pole is subject to predictable precession and nutation, but also small irregular variations in the orientation of the rotational axis and the rotation period (a.k.a polar wobble). The <a href="https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html">IERS Bulletins</a> provide up-to-date measurements, historical data, and near-term projections for the polar offsets and the UT1-UTC (DUT1) time difference and leap-seconds (UTC-TAI). In SuperNOVAS you can use <code><a class="el" href="novas_8c.html#a8937180de2ee1545d19b8fc840f35fe2">cel_pole()</a></code> and <code><a class="el" href="super_8c.html#a4d7470ca705efa1953e8b4beab77c6b6">get_ut1_to_tt()</a></code> functions to apply / use the published values from these to improve the astrometric precision of Earth-orientation based coordinate calculations. Without setting and using the actual polar offset values for the time of observation, positions for Earth-based observations will be accurate at the tenths of arcsecond level only.<ol type="a">
<li><b>Refraction</b>: Ground based observations are also subject to atmospheric refraction. SuperNOVAS offers the option to include approximate <em>optical</em> refraction corrections either for a standard atmosphere or more precisely using the weather parameters defined in the <code><a class="el" href="structon__surface.html">on_surface</a></code> data structure that specifies the observer locations. Note, that refraction at radio wavelengths is notably different from the included optical model, and a standard radio refraction model is included as of version 1.1. In any case you may want to skip the refraction corrections offered in this library, and instead implement your own as appropriate (or not at all).</li>
</ol>
</li>
</ol>
<hr  />
<p><a class="anchor" id="supernovas-features"></a> </p>
<h2><a class="anchor" id="autotoc_md66"></a>
SuperNOVAS specific features</h2>
<ul>
<li><a class="el" href="index.html#added-functionality">Newly added functionality</a></li>
<li><a class="el" href="index.html#api-changes">Refinements to the NOVAS C API</a></li>
</ul>
<p><a class="anchor" id="added-functionality"></a> </p>
<h3><a class="anchor" id="autotoc_md67"></a>
Newly added functionality</h3>
<p><a class="anchor" id="debug-mode"></a></p><ul>
<li>Changed to <a class="el" href="index.html#multi-threading">support for calculations in parallel threads</a> by making cached results thread-local. This works using the C11 standard <code>_Thread_local</code> or else the earlier GNU C &gt;= 3.3 standard <code>__thread</code> modifier. You can also set the preferred thread-local keyword for your compiler by passing it via <code>-DTHREAD_LOCAL=...</code> in <code>config.mk</code> to ensure that your build is thread-safe. And, if your compiler has no support whatsoever for thread_local variables, then SuperNOVAS will not be thread-safe, just as NOVAS C isn't.</li>
<li>New debug mode and error traces. Simply call <code>novas_debug(NOVAS_DEBUG_ON)</code> or <code>novas_debug(NOVAS_DEBUG_EXTRA)</code> to enable. When enabled, any error condition (such as NULL pointer arguments, or invalid input values etc.) will be reported to the standard error, complete with call tracing within the SuperNOVAS library, s.t. users can have a better idea of what exactly did not go to plan (and where). The debug messages can be disabled by passing <code>NOVAS_DEBUF_OFF</code> (0) as the argument to the same call. Here is an example error trace when your application calls <code><a class="el" href="novas_8c.html#a48f90ac20950507fad9b880a7f7f2383">grav_def()</a></code> with <code>NOVAS_FULL_ACCURACY</code> while <code>solsys3</code> provides Earth and Sun positions only and when debug mode is <code>NOVAS_DEBUG_EXTRA</code> (otherwise we'll ignore that we skipped the almost always negligible deflection due to planets): <div class="fragment"><div class="line">ERROR! earth_sun_calc: invalid or unsupported planet number: 5 [=&gt; 2]</div>
<div class="line">     @ earth_sun_calc_hp [=&gt; 2]</div>
<div class="line">     @ solarsystem_hp [=&gt; 2]</div>
<div class="line">     @ ephemeris:planet [=&gt; 12]</div>
<div class="line">     @ grav_def:Jupiter [=&gt; 12]</div>
</div><!-- fragment --></li>
<li>New runtime configuration:<ul>
<li>The planet position calculator function used by <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code> can be set at runtime via <code><a class="el" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider()</a></code>, and <code><a class="el" href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp()</a></code> (for high precision calculations). Similarly, if <code><a class="el" href="solsys-ephem_8c.html#a61c60adf57c00d797fac94bb5841c271">planet_ephem_provider()</a></code> or <code><a class="el" href="solsys-ephem_8c.html#ae19eb2bcaaa2deb9fe27fba8090724e1">planet_ephem_provider_hp()</a></code> (defined in <code><a class="el" href="solsys-ephem_8c.html">solsys-ephem.c</a></code>) are set as the planet calculator functions, then <code><a class="el" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider()</a></code> can set the user-specified function to use with these to actually read ephemeris data (e.g. from a JPL <code>.bsp</code> file).</li>
<li>If CIO locations vs GCRS are important to the user, the user may call <code><a class="el" href="novas_8c.html#a13c40b89c2cecd6a23720d181a800591">set_cio_locator_file()</a></code> at runtime to specify the location of the binary CIO interpolation table (e.g. <code>cio_ra.bin</code>) to use, even if the library was compiled with the different default CIO locator path.</li>
<li>The default low-precision nutation calculator <code><a class="el" href="nutation_8c.html#ab17083c5bc84987d4dda1172a4dab843">nu2000k()</a></code> can be replaced by another suitable IAU 2006 nutation approximation via <code><a class="el" href="novas_8c.html#a694288eb631d6a69ecf313b7b5b4a677">set_nutation_lp_provider()</a></code>. For example, the user may want to use the <code><a class="el" href="nutation_8c.html#ae1a30706385dd901d96d28c816b51c87">iau2000b()</a></code> model or some custom algorithm instead.</li>
</ul>
</li>
<li>New intuitive XYZ coordinate conversion functions:<ul>
<li>for GCRS - CIRS - ITRS (IAU 2000 standard): <code><a class="el" href="novas_8c.html#a51ea4a016336dd3cf7783061c14d165c">gcrs_to_cirs()</a></code>, <code><a class="el" href="super_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs()</a></code>, and <code><a class="el" href="super_8c.html#a12953f66c0f774284f0700ae785784d0">itrs_to_cirs()</a></code>, <code><a class="el" href="novas_8c.html#ac0ba048cd1732d0d0398397396d158bc">cirs_to_gcrs()</a></code>.</li>
<li>for GCRS - J2000 - TOD - ITRS (old methodology): <code><a class="el" href="novas_8c.html#aeea4b5085c7267714492fae6108fb975">gcrs_to_j2000()</a></code>, <code><a class="el" href="novas_8c.html#a02fa1ee652c20160055cbd2c7bd9ca63">j2000_to_tod()</a></code>, <code><a class="el" href="super_8c.html#a4551e2ac083e34c1b2b61b3805efb9a3">tod_to_itrs()</a></code>, and <code><a class="el" href="super_8c.html#a3f6ae564cfac3766a21e0754905e5f7c">itrs_to_tod()</a></code>, <code><a class="el" href="novas_8c.html#a6205edb1361e56cc0c7aed0f088f7437">tod_to_j2000()</a></code>, <code><a class="el" href="super_8c.html#a9d51ca5c972013024755c644c96d0586">j2000_to_gcrs()</a></code>.</li>
</ul>
</li>
<li>New <code><a class="el" href="super_8c.html#a296fcf0239f66eb19732f5072fed6d6e">itrs_to_hor()</a></code> and <code><a class="el" href="super_8c.html#ad290005b13558de3927e455775b32e0f">hor_to_itrs()</a></code> to convert Earth-fixed ITRS coordinates to astrometric azimuth and elevation or back. Whereas <code><a class="el" href="super_8c.html#a4551e2ac083e34c1b2b61b3805efb9a3">tod_to_itrs()</a></code> followed by <code><a class="el" href="super_8c.html#a296fcf0239f66eb19732f5072fed6d6e">itrs_to_hor()</a></code> is effectively a just a more explicit 2-step version of the existing <code><a class="el" href="novas_8c.html#a5f229207d8a775119565a52f7e586cf8">equ2hor()</a></code> for converting from TOD to to local horizontal (old methodology), the <code><a class="el" href="super_8c.html#aa2768d89d499a7155f90a6fd8c176d8d">cirs_to_itrs()</a></code> followed by <code><a class="el" href="super_8c.html#a296fcf0239f66eb19732f5072fed6d6e">itrs_to_hor()</a></code> does the same from CIRS (new IAU standard methodology), and had no prior equivalent in NOVAS C 3.1.</li>
<li>New <code><a class="el" href="super_8c.html#afb3abc403e84a4821c3d00dc9186eed5">ecl2equ()</a></code> for converting ecliptic coordinates to equatorial, complementing existing <code><a class="el" href="novas_8c.html#a98e8713c3a4cc14363246a3da757ddcd">equ2ecl()</a></code>.</li>
<li>New <code><a class="el" href="super_8c.html#af4cce5aa6c74794a0b89176037305181">gal2equ()</a></code> for converting galactic coordinates to ICRS equatorial, complementing existing <code><a class="el" href="novas_8c.html#a4afca520ede383556b549bbfb0d95c16">equ2gal()</a></code>.</li>
<li>New <code><a class="el" href="novas_8c.html#aa41408d8cbbe3cfc12930414a9c79fc7">refract_astro()</a></code> complements the existing <code><a class="el" href="novas_8c.html#a151b74255ea04462abc5503c6afddcae">refract()</a></code> but takes an unrefracted (astrometric) zenith angle as its argument.</li>
<li>New convenience functions to wrap <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> for simpler specific use: <code><a class="el" href="novas_8c.html#a078b5e764d5cf3fdca600fada992b409">place_star()</a></code>, <code><a class="el" href="super_8c.html#a4ef1b6d204e22608e964e60cf34a15ad">place_icrs()</a></code>, <code><a class="el" href="super_8c.html#acbcd90c9111cc5580a5c2bac404f7f00">place_gcrs()</a></code>, <code><a class="el" href="super_8c.html#aebad3c9b51f62cb7b31a686b5ec890a9">place_cirs()</a></code>, and <code><a class="el" href="super_8c.html#a2c8817db8a00764da4c285b32590ccfb">place_tod()</a></code>.</li>
<li>New <code><a class="el" href="novas_8c.html#aed179ad664f4ff023deb540140f3c2ef">radec_star()</a></code> and <code><a class="el" href="novas_8c.html#a11d3da697a640c39d87cf201ac54ca7c">radec_planet()</a></code> as the common point for existing functions such as <code><a class="el" href="novas_8c.html#a60ea97a77320c52b566f8e8fb5faf304">astro_star()</a></code>, <code><a class="el" href="novas_8c.html#a0f24eef523d0a8e3252002654389bd5c">local_star()</a></code>, <code><a class="el" href="novas_8c.html#af47d81c6aaa03c8af78eb251c8894bde">virtual_planet()</a></code>, <code><a class="el" href="novas_8c.html#a48cf19bbddaeeb698bb921575b15e23e">topo_planet()</a></code> etc.</li>
<li>New time conversion utilities <code><a class="el" href="novas_8c.html#a129acca41760da486e1179c93cb9e86d">tt2tdb()</a></code>, <code><a class="el" href="super_8c.html#ab7611704bab9ce717744a8b5575c5378">get_utc_to_tt()</a></code>, and <code><a class="el" href="super_8c.html#a4d7470ca705efa1953e8b4beab77c6b6">get_ut1_to_tt()</a></code> make it simpler to convert between UTC, UT1, TT, and TDB time scales, and to supply <code>ut1_to_tt</code> arguments to <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> or topocentric calculations.</li>
<li>Co-existing <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> variants. It is possible to use the different <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> implementations provided by <code><a class="el" href="solsys1_8c.html">solsys1.c</a></code>, <code><a class="el" href="solsys2_8c.html">solsys2.c</a></code>, <code><a class="el" href="solsys3_8c.html">solsys3.c</a></code> and/or <code><a class="el" href="solsys-ephem_8c.html">solsys-ephem.c</a></code> side-by-side, as they define their functionalities with distinct, non-conflicting names, e.g. <code><a class="el" href="solsys3_8c.html#ab5d74f84f8e75e90dfc30ebde562d076">earth_sun_calc()</a></code> vs <code><a class="el" href="solsys2_8c.html#aceb7bc6823b1823d8a8360517ff58f29">planet_jplint()</a></code> vs <code><a class="el" href="solsys1_8c.html#a71d2bfef45818d56e359205c57db0694">planet_eph_manager()</a></code> vs <code><a class="el" href="solsys-ephem_8c.html#a61c60adf57c00d797fac94bb5841c271">planet_ephem_provider()</a></code>. See the section on <a class="el" href="index.html#installation">Building and installation</a> further above on including a selection of these in your library build.)</li>
<li>New <code><a class="el" href="novas_8c.html#a8f832afe92680a11c3489aaa224ac2e2">novas_case_sensitive(int)</a></code> to enable (or disable) case-sensitive processing of object names. (By default NOVAS <code>object</code> names are converted to upper-case, making them effectively case-insensitive.)</li>
<li>New <code><a class="el" href="novas_8c.html#a618bbba887b9bc9e7df878234c66c215">make_planet()</a></code> and <code><a class="el" href="super_8c.html#aa22303f98df2d63edf6d8452ff3a43b2">make_ephem_object()</a></code> to make it simpler to configure Solar-system objects.</li>
</ul>
<h4><a class="anchor" id="autotoc_md68"></a>
Added in v1.1</h4>
<ul>
<li>New observing-frame based approach for calculations (<code><a class="el" href="frames_8c.html">frames.c</a></code>). A <code><a class="el" href="structnovas__frame.html">novas_frame</a></code> object uniquely defines both the place and time of observation, with a set of pre-calculated transformations and constants. Once the frame is defined it can be used very efficiently to calculate positions for multiple celestial objects with minimum additional computational cost. The frames API is also more elegant and more versatile than the low-level NOVAS C approach for performing the same kind of calculations. And, frames are inherently thread-safe since post-creation their internal state is never modified during the calculations. The following new functions were added: <code><a class="el" href="frames_8c.html#abfee69517c7432733c8382c88371c983">novas_make_frame()</a></code>, <code><a class="el" href="frames_8c.html#a2972b3eafa2d7f6c29cff34bad9fcf0d">novas_change_observer()</a></code>, <code><a class="el" href="frames_8c.html#ae6f4d3710a277c8b284487fe175e4d49">novas_geom_posvel()</a></code>, <code><a class="el" href="frames_8c.html#ad412ac774327a4120237dc3b3110f9a0">novas_geom_to_app()</a></code>, <code><a class="el" href="frames_8c.html#a4e894a83f3065bbb706212d1267dd2ab">novas_sky_pos()</a></code>, <code><a class="el" href="frames_8c.html#ae84debf8ab4d3b16feaaefdcb0ebbd08">novas_app_to_hor()</a></code>, <code><a class="el" href="frames_8c.html#a83db7db5a0ed0311610391f199b9f66c">novas_app_to_geom()</a></code>, <code><a class="el" href="frames_8c.html#a4849c7fca260cfb7c1d716566f4170ac">novas_hor_to_app()</a></code>, <code><a class="el" href="frames_8c.html#a4d179c8573319fc25c775ce56ba055dc">novas_make_transform()</a></code>, <code><a class="el" href="frames_8c.html#ad2081e123024609d3071b33b183502b7">novas_invert_transform()</a></code>, <code><a class="el" href="frames_8c.html#aadb7bc88119eed4ea54373a42e22a0d4">novas_transform_vector()</a></code>, and <code><a class="el" href="frames_8c.html#a88972e93665bb1903795bfff264c14f6">novas_transform_sky_pos()</a></code>.</li>
<li>New <code><a class="el" href="structnovas__timespec.html">novas_timespec</a></code> structure for the self-contained definition of precise astronomical time (<code><a class="el" href="timescale_8c.html">timescale.c</a></code>). You can set the time via <code><a class="el" href="timescale_8c.html#ac272a018a213965f07b21ac6facb4a62">novas_set_time()</a></code> or <code><a class="el" href="timescale_8c.html#a37c8f2d5e1ad2daed78d1bd7991fdba4">novas_set_split_time()</a></code> to a JD date in the timescale of choice (UTC, UT1, GPS, TAI, TT, TCG, TDB, or TCB), or to a UNIX time with <code><a class="el" href="timescale_8c.html#abacd89aa380c85da2d3c19a7e2187df3">novas_set_unix_time()</a></code>. Once set, you can obtain an expression of that time in any timescale of choice via <code><a class="el" href="timescale_8c.html#aa65f86f70b2ea6e77bf0799d6859ca05">novas_get_time()</a></code>, <code><a class="el" href="timescale_8c.html#ab4ea1b646b23a76936b2a6459b1bac6d">novas_get_split_time()</a></code> or <code><a class="el" href="timescale_8c.html#aa29034a9e6579d5982083c5c6ea8d773">novas_get_unix_time()</a></code>. And, you can create a new time specification by incrementing an existing one, using <code>novas_increment_time()</code>, or measure time differences via <code><a class="el" href="timescale_8c.html#abdcc8e194d79787838d1ffc064449932">novas_diff_time()</a></code>, <code><a class="el" href="timescale_8c.html#ab904df0f504d07bbf73f84e2a1c43e07">novas_diff_tcg()</a></code>, or <code><a class="el" href="timescale_8c.html#a4818ab9be2f0891091c719db01bcfa98">novas_diff_tcb()</a></code>.</li>
<li>Added <code><a class="el" href="structnovas__planet__bundle.html">novas_planet_bundle</a></code> structure to handle planet positions and velocities more elegantly (e.g. for gravitational deflection calculations).</li>
<li><code><a class="el" href="novas_8c.html#a5a62b6e1ef8840a1203c6d2a75d17152">obs_posvel()</a></code> to calculate the observer position and velocity relative to the Solar System Barycenter (SSB).</li>
<li><code><a class="el" href="novas_8c.html#acbc29fe86915ef8a3701795dc9fd9b34">obs_planets()</a></code> to calculate planet positions (relative to observer) and velocities (w.r.t. SSB).</li>
<li><code><a class="el" href="super_8c.html#aaae33249717912663bbb00be4fa4e6c3">grav_undef()</a></code> to undo gravitational bending of the observed light to obtain geometric positions from observed ones.</li>
<li><code><a class="el" href="novas_8c.html#aa798460894aa44f8564569d9ea4bf1ef">grav_planets()</a></code> and <code><a class="el" href="super_8c.html#ae68d01655c4b37b5a3e1422f0062f94c">grav_undo_planets()</a></code> functions to apply/ or undo gravitational deflection using a specific set of gravitating bodies.</li>
<li>New coordinate reference systems <code>NOVAS_MOD</code> (Mean of Date) which includes precession by not nutation and <code>NOVAS_J2000</code> for the J2000 dynamical reference system.</li>
<li>New observer locations <code>NOVAS_AIRBORNE_OBSERVER</code> and <code>NOVAS_SOLAR_SYSTEM_OBSERVER</code>, and corresponding <code><a class="el" href="super_8c.html#aa423a88cd3f434642fc89d47390184f4">make_airborne_observer()</a></code> and <code><a class="el" href="super_8c.html#a9c3f1a1bc3fd9ac6d211806913d2d529">make_solar_system_observer()</a></code> functions. Airborne observers have an Earth-fixed momentary location, defined by longitude, latitude, and altitude, the same way as for a stationary observer on Earth, but are moving relative to the surface, such as in an aircraft or balloon based observatory. Solar-system observers are similar to observers in Earth-orbit but their momentary position and velocity is defined relative to the Solar System Barycenter (SSB), instead of the geocenter.</li>
<li>Added humidity field to <code><a class="el" href="structon__surface.html">on_surface</a></code> structure, e.g. for refraction calculations at radio wavelengths. The <code><a class="el" href="novas_8c.html#a9174488cd701172531174d85ed26819b">make_on_surface()</a></code> function will set humidity to 0.0, but the user can set the field appropriately afterwards.</li>
<li>New set of built-in refraction models to use with the frame-based <code><a class="el" href="frames_8c.html#ae84debf8ab4d3b16feaaefdcb0ebbd08">novas_app_to_hor()</a></code> / <code><a class="el" href="frames_8c.html#a4849c7fca260cfb7c1d716566f4170ac">novas_hor_to_app()</a></code> functions. The models <code><a class="el" href="refract_8c.html#ab04bff3b97c132e358e11c3a5b7a3081">novas_standard_refraction()</a></code> and <code><a class="el" href="refract_8c.html#ae4511a80a1defbb1e1fdc29c289e7de4">novas_optical_refraction()</a></code> implement the same refraction model as <code><a class="el" href="novas_8c.html#a151b74255ea04462abc5503c6afddcae">refract()</a></code> in NOVAS C 3.1, with <code>NOVAS_STANDARD_ATMOSPHERE</code> and <code>NOVAS_WEATHER_AT_LOCATION</code> respectively, including the reversed direction provided by <code><a class="el" href="novas_8c.html#aa41408d8cbbe3cfc12930414a9c79fc7">refract_astro()</a></code>. The user may supply their own custom refraction model also, and may make use of the generic reversal function <code><a class="el" href="refract_8c.html#a93ac897d3f7a2f2a7f8d92f3e8cd9ea0">novas_inv_refract()</a></code> to calculate refraction in the reverse direction (observer vs astrometric elevations) as needed.</li>
<li>Added radio refraction model <code><a class="el" href="refract_8c.html#a6b49f92f8f818f2272613e3432185a39">novas_radio_refraction()</a></code> based on the formulae by Berman &amp; Rockwell 1976.</li>
<li>Added <code><a class="el" href="super_8c.html#a9cac4f3a18d4c14939519e7123b4d504">cirs_to_tod()</a></code> and <code><a class="el" href="super_8c.html#adb48b2acaf76cc3a1e3a1412cc42c232">tod_to_cirs()</a></code> functions for efficient transformation between True of Date (TOD) and Celestial Intermediate Reference System (CIRS), and vice versa.</li>
<li>Added <code><a class="el" href="super_8c.html#ab9b7a622486f2904615ceed1ba94cd8f">make_cat_object()</a></code> function to create a NOVAS celestial <code>object</code> structure from existing <code><a class="el" href="structcat__entry.html">cat_entry</a></code> data.</li>
</ul>
<h4><a class="anchor" id="autotoc_md69"></a>
Added in v1.2</h4>
<ul>
<li>New <code><a class="el" href="super_8c.html#a11aa3ce6bcdda5b7065b38d6cfaf63d3">make_redshifted_cat_entry()</a></code> and <code><a class="el" href="super_8c.html#ae579a49d84696a913fd0d9f348bb5b11">make_redshifted_object()</a></code> to simplify the creation of distant catalog sources that are characterized with a redshift measure rather than a radial velocity value.</li>
<li>New generic redshift-handling functions <code><a class="el" href="super_8c.html#aa54cd00024b294d38fa29433c017c65f">novas_v2z()</a></code>, <code><a class="el" href="novas_8c.html#a63621cea3b4985c1bfcc4514a7aa3fb1">novas_z2v()</a></code>,</li>
<li>New functions to calculate and apply additional gravitational redshift corrections for light that originates near massive gravitating bodies (other than major planets, or Sun or Moon), or for observers located near massive gravitating bodies (other than the Sun and Earth). The added functions are <code><a class="el" href="super_8c.html#a3ce6b306bc183387d0aaac97abbd82e8">grav_redshift()</a></code>, <code>redhift_vrad()</code>, <code><a class="el" href="super_8c.html#aea89203030ca831260dec18f83081d23">unredshift_vrad()</a></code>, <code><a class="el" href="super_8c.html#a493ab751eee5804db77157c37e94e5c3">novas_z_add()</a></code>, and <code><a class="el" href="super_8c.html#a1130ad2ce520e948c71f03a25a713075">novas_z_inv()</a></code>.</li>
<li>CALCEPH integration: <code><a class="el" href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph()</a></code> and/or <code><a class="el" href="solsys-calceph_8c.html#ab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets()</a></code> to specify and use ephemeris data via CALCEPH for Solar-system sources in general, and for major planets specifically; and <code><a class="el" href="solsys-calceph_8c.html#a5531b937a5bb5491cb475d2536346ad8">novas_calceph_use_ids()</a></code> to specify whether <code><a class="el" href="structobject.html#a7d578acc2a3e88ef2435fe0e88d01a74" title="enum novas_planet, or minor planet ID (e.g. NAIF), or star catalog ID.">object.number</a></code> in <code>NOVAS_EPHEM_OBJECT</code> type objects is a NAIF ID (default) or else a CALCEPH ID number of the Solar-system body.</li>
<li>NAIF CSPICE integration: <code><a class="el" href="solsys-cspice_8c.html#a9b44218bca5fce1e9e5103494c15dde4">novas_use_cspice()</a></code>, <code><a class="el" href="solsys-cspice_8c.html#a943549e395b19f6a91064e3d6fa1c577">novas_use_cspice_planets()</a></code>, <code><a class="el" href="solsys-cspice_8c.html#afb078e1df9b5b08999d24e68d7b4ecdc">novas_use_cspice_ephem()</a></code> to use the NAIF CSPICE library for all Solar-system sources, major planets only, or for other bodies only. <code>NOVAS_EPHEM_OBJECTS</code> should use NAIF IDs with CSPICE (or else -1 for name-based lookup). Also provides <code><a class="el" href="solsys-cspice_8c.html#ae02d26964099f56c375dc78172ad135b">cspice_add_kernel()</a></code> and <code><a class="el" href="solsys-cspice_8c.html#a38e3b3155cad3b3822fbc3e553060ab1">cspice_remove_kernel()</a></code>.</li>
<li>NAIF/NOVAS ID conversions for major planets (and Sun, Moon, SSB...): <code><a class="el" href="naif_8c.html#ab51ac9bdf7736e1c1582e0981046daf3">novas_to_naif_planet()</a></code>, <code><a class="el" href="naif_8c.html#ac3eb54acf22dc155879163de89c6865e">novas_to_dexxx_planet()</a></code>, and <code><a class="el" href="naif_8c.html#a1c4b3f67a3b82808dd16ae43dfaf0f86">naif_to_novas_planet()</a></code>.</li>
<li>Access to custom ephemeris provider functions: <code><a class="el" href="novas_8c.html#a0f0a786b5614a788c02b37a462eae2d2">get_planet_provider()</a></code> and <code><a class="el" href="novas_8c.html#ae45badb450c1ca73920d982e12346c5b">get_planet_provider_hp()</a></code>.</li>
<li>Added <code><a class="el" href="super_8c.html#a92e869b101bd41e31ac6d3a2419bb0a3">novas_planet_for_name()</a></code> function to return the NOVAS planet ID for a given (case insensitive) name.</li>
<li>Added support for using orbital elements. <code><a class="el" href="structobject.html#a2cc80aad5c0303449e2412b122504a10" title="NOVAS object type.">object.type</a></code> can now be set to <code>NOVAS_ORBITAL_OBJECT</code>, whose orbit can be defined by the set of <code><a class="el" href="structnovas__orbital.html">novas_orbital</a></code>, relative to a <code><a class="el" href="structnovas__orbital__system.html">novas_orbital_system</a></code>. You can initialize an <code>object</code> with a set of orbital elements using <code><a class="el" href="super_8c.html#a3c5e215babeeba078ca7b3e9be42e555">make_orbital_object()</a></code>, and for planetary satellite orbits you might use <code><a class="el" href="super_8c.html#aee0ed43252017745574fa1e4b84a7b11">novas_set_orbsys_pole()</a></code>. For orbital objects, <code><a class="el" href="novas_8c.html#a3221fff69d0ca52ae4694ec3ab0368ad">ephemeris()</a></code> will call on the new <code><a class="el" href="novas_8c.html#a445ad14faede9dc912601de27fb52bc0">novas_orbit_posvel()</a></code> to calculate positions. While orbital elements do not always yield precise positions, they can for shorter periods, provided that the orbital elements are up-to-date. For example, the Minor Planer Center (MPC) publishes accurate orbital elements for all known asteroids and comets regularly. For newly discovered objects, this may be the only and/or most accurate information available anywhere.</li>
<li>Added <code>NOVAS_EMB</code> (Earth-Moon Barycenter) and <code>NOVAS_PLUTO_BARYCENTER</code> to <code>enum novas_planets</code> to distinguish from the corresponding planet centers in calculations.</li>
<li>Added <code><a class="el" href="novas_8c.html#a9c900b81a718a184281a8a0b733b4db7">gcrs_to_tod()</a></code> / <code><a class="el" href="novas_8c.html#a6871e7fecde44084c7b4e1b8dda5ac70">tod_to_gcrs()</a></code> and <code><a class="el" href="novas_8c.html#a75de6cca190c5fbc3056db726f317c7f">gcrs_to_mod()</a></code> / <code><a class="el" href="novas_8c.html#ad9cc07f0e6af9339096e15a440b113e5">mod_to_gcrs()</a></code> vector conversion functions for convenience.</li>
<li>Added various <code>object</code> initializer macros in <code><a class="el" href="novas_8h.html">novas.h</a></code> for the major planets, Sun, Moon, and barycenters, e.g. <code>NOVAS_EARTH_INIT</code> or <code>NOVAS_SSB_INIT</code>. These wrap the parametric <code><a class="el" href="novas_8h.html#ad34a88c2c04b624f8f85fc86e7935967">NOVAS_PLANET_INIT(num, name)</a></code> macro, and can be used to simplify the initialization of NOVAS <code>object</code>s.</li>
<li>Added more physical unit constants to <code><a class="el" href="novas_8h.html">novas.h</a></code>.</li>
</ul>
<p><a class="anchor" id="api-changes"></a> </p>
<h3><a class="anchor" id="autotoc_md70"></a>
Refinements to the NOVAS C API</h3>
<ul>
<li>SuperNOVAS functions take <code>enum</code>s as their option arguments instead of raw integers. These enums are defined in <code><a class="el" href="novas_8h.html">novas.h</a></code>. The same header also defines a number of useful constants. The enums allow for some compiler checking, and make for more readable code that is easier to debug. They also make it easy to see what choices are available for each function argument, without having to consult the documentation each and every time.</li>
<li>All SuperNOVAS functions check for the basic validity of the supplied arguments (Such as NULL pointers or illegal duplicate arguments) and will return -1 (with <code>errno</code> set, usually to <code>EINVAL</code>) if the arguments supplied are invalid (unless the NOVAS C API already defined a different return value for specific cases. If so, the NOVAS C error code is returned for compatibility).</li>
<li>All erroneous returns now set <code>errno</code> so that users can track the source of the error in the standard C way and use functions such as <code>perror()</code> and <code>strerror()</code> to print human-readable error messages.</li>
<li>SuperNOVAS prototypes declare function pointer arguments as <code>const</code> whenever the function does not modify the data content being pointed at. This supports better programming practices that generally aim to avoid unintended data modifications.</li>
<li>Many SuperNOVAS functions allow <code>NULL</code> arguments, both for optional input values as well as outputs that are not required (see the <a href="https://smithsonian.github.io/SuperNOVAS/apidoc/html/">API Documentation</a> for specifics). This eliminates the need to declare dummy variables in your application code.</li>
<li>Many output values supplied via pointers are set to clearly invalid values in case of erroneous returns, such as <code>NAN</code> so that even if the caller forgets to check the error code, it becomes obvious that the values returned should not be used as if they were valid. (No more sneaky silent failures.)</li>
<li>All SuperNOVAS functions that take an input vector to produce an output vector allow the output vector argument be the same as the input vector argument. For example, <code>frame_tie(pos, J2000_TO_ICRS, pos)</code> using the same <code>pos</code> vector both as the input and the output. In this case the <code>pos</code> vector is modified in place by the call. This can greatly simplify usage, and eliminate extraneous declarations, when intermediates are not required.</li>
<li>Catalog names can be up to 6 bytes (including termination), up from 4 in NOVAS C, while keeping <code>struct</code> layouts the same as NOVAS C thanks to alignment, thus allowing cross-compatible binary exchange of <code><a class="el" href="structcat__entry.html">cat_entry</a></code> records with NOVAS C 3.1.</li>
<li>Changed <code><a class="el" href="novas_8c.html#a411f70fb77582d750c5269fcd64b0ce2">make_object()</a></code> to retain the specified number argument (which can be different from the <code>starnumber</code> value in the supplied <code><a class="el" href="structcat__entry.html">cat_entry</a></code> structure).</li>
<li><code><a class="el" href="novas_8c.html#a43141f0ea4598d6c87193c3ea594dd6c">cio_location()</a></code> will always return a valid value as long as neither output pointer argument is NULL. (NOVAS C 3.1 would return an error if a CIO locator file was previously opened but cannot provide the data for whatever reason).</li>
<li><code><a class="el" href="novas_8c.html#a95f02377ce41d4e251654449dda82986">cel2ter()</a></code> and <code><a class="el" href="novas_8c.html#a6b662ff99b35db19c9b6b24a1ae9264f">ter2cel()</a></code> can now process 'option'/'class' = 1 (<code>NOVAS_REFERENCE_CLASS</code>) regardless of the methodology (<code>EROT_ERA</code> or <code>EROT_GST</code>) used to input or output coordinates in GCRS.</li>
<li>More efficient paging (cache management) for <code><a class="el" href="novas_8c.html#a2ed632ae8df4a3737c200c96fe2362e2">cio_array()</a></code>, including I/O error checking.</li>
<li>IAU 2000A nutation model uses higher-order Delaunay arguments provided by <code><a class="el" href="novas_8c.html#aaac686274606e79ba666f94306eece8b">fund_args()</a></code>, instead of the linear model in NOVAS C 3.1.</li>
<li>IAU 2000 nutation made a bit faster, reducing the the number of floating-point multiplications necessary by skipping terms that do not contribute. Its coefficients are also packed more frugally in memory, resulting in a smaller footprint.</li>
<li>Changed the standard atmospheric model for (optical) refraction calculation to include a simple model for the annual average temperature at the site (based on latitude and elevation). This results is a slightly more educated guess of the actual refraction than the global fixed temperature of 10 &deg;C assumed by NOVAC C 3.1 regardless of observing location.</li>
<li>[<b>v1.1</b>] Improved precision of some calculations, like <code><a class="el" href="novas_8c.html#aef1f8daaad470353648de90576aefc66">era()</a></code>, <code><a class="el" href="novas_8c.html#aaac686274606e79ba666f94306eece8b">fund_args()</a></code>, and <code><a class="el" href="novas_8c.html#aacc6a0daf29b8bdc18f46647a94694d3">planet_lon()</a></code> by being more careful about the order in which terms are accumulated and combined, resulting in a small improvement on the few uas (micro-arcsecond) level.</li>
<li>[<b>v1.1</b>] <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> now returns an error 3 if and only if the observer is at (or very close, within ~1.5m) of the observed Solar-system object.</li>
<li>[<b>v1.1</b>] <code><a class="el" href="novas_8c.html#a48f90ac20950507fad9b880a7f7f2383">grav_def()</a></code> is simplified. It no longer uses the location type argument. Instead it will skip deflections due to a body if the observer is within ~1500 km of its center (which is below the surface for all major Solar system bodies).</li>
<li>[<b>v1.1.1</b>] For major planets (and Sun and Moon) <code><a class="el" href="novas_8c.html#a9f76e2386515e2023172e05891c3fa28">rad_vel()</a></code> and <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> will include gravitational corrections to radial velocity for light originating at the surface, and observed near Earth or at a large distance away from the source.</li>
</ul>
<hr  />
<p><a class="anchor" id="solarsystem"></a> </p>
<h2><a class="anchor" id="autotoc_md72"></a>
Incorporating Solar-system ephemeris data or services</h2>
<p>If you want to use SuperNOVAS to calculate positions for a range of Solar-system objects, and/or to do it with precision, you will have to interface it to a suitable provider of ephemeris data. Given the NOVAS C heritage, and some added SuperNOVAS flexibility in this area, you have several options for going about it. These are listed from the most practical (and preferred) to the least so (the old ways).</p>
<p>NASA/JPL provides <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/">generic ephemerides</a> for the major planets, satellites thereof, the 300 largest asteroids, the Lagrange points, and some Earth orbiting stations. For example, <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de440.bsp">DE440</a> covers the major planets, and the Sun, Moon, and barycenters for times between 1550 AD and 2650 AD. Or, you can use the <a href="https://ssd.jpl.nasa.gov/horizons/">JPL HORIZONS</a> system (via the commnad-line / telnet or API interfaces) to generate custom ephemerides (SPK/BSP) for just about all known solar systems bodies, down to the tiniest rocks.</p>
<ul>
<li><a class="el" href="index.html#calceph-integration">Optional CALCEPH integration</a></li>
<li><a class="el" href="index.html#cspice-integration">Optional NAIF CSPICE toolkit integration</a></li>
<li><a class="el" href="index.html#universal-ephemerides">Universal ephemeris data / service integration</a></li>
<li><a class="el" href="index.html#builtin-ephem-readers">Legacy support for (older) JPL major planet ephemerides</a></li>
<li><a class="el" href="index.html#explicit-ephem-linking">Legacy linking of custom ephemeris functions</a></li>
</ul>
<p><a class="anchor" id="calceph-integration"></a> </p>
<h3><a class="anchor" id="autotoc_md73"></a>
Optional CALCEPH integration</h3>
<p>The <a href="https://www.imcce.fr/recherche/equipes/asd/calceph/">CALCEPH</a> library provides easy-to-use access to JPL and INPOP ephemeris files from C/C++. As of version 1.2, we provide optional support for interfacing SuperNOVAS with the the CALCEPH C library for handling Solar-system objects.</p>
<p>Prior to building SuperNOVAS simply set <code>CALCEPH_SUPPORT</code> to 1 in <code>config.mk</code> or in your environment. Depending on the build target, it will build <code>libsolsys-calceph.so[.1]</code> (target <code>shared</code>) or <code>libsolsys-calceph.a</code> (target <code>static</code>) libraries or <code>solsys-calceph.o</code> (target <code>solsys</code>), which provide the <code><a class="el" href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph()</a></code> and <code><a class="el" href="solsys-calceph_8c.html#ab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets()</a></code>, and <code><a class="el" href="solsys-calceph_8c.html#a5531b937a5bb5491cb475d2536346ad8">novas_calceph_use_ids()</a></code> functions.</p>
<p>Of course, you will need access to the CALCEPH C development files (C headers and unversioned <code>libcalceph.so</code> or <code>.a</code> library) for the build to succeed. Here is an example on how you'd use CALCEPH with SuperNOVAS in your application code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas-calceph_8h.html">novas-calceph.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can open a set of JPL/INPOP ephemeris files with CALCEPH...</span></div>
<div class="line">t_calcephbin *eph = calceph_open_array(...);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then use them as your generic SuperNOVAS ephemeris provider</span></div>
<div class="line"><span class="keywordtype">int</span> status = <a class="code hl_function" href="solsys-calceph_8c.html#a35fc86a939602ec910dbdfde180d7f31">novas_use_calceph</a>(eph);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// Ooops something went wrong...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Optionally you may use a separate ephemeris dataset for major planets</span></div>
<div class="line"><span class="comment">// (or if planet ephemeris was included in &#39;eph&#39; above, you don&#39;t have to) </span></div>
<div class="line">t_calcephbin *pleph = calceph_open(...);</div>
<div class="line">status = <a class="code hl_function" href="solsys-calceph_8c.html#ab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets</a>(pleph);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// Ooops something went wrong...</span></div>
<div class="line">}</div>
<div class="ttc" id="anovas_8h_html"><div class="ttname"><a href="novas_8h.html">novas.h</a></div></div>
<div class="ttc" id="asolsys-calceph_8c_html_ab86ec03898e658c86c671a8b6399e331"><div class="ttname"><a href="solsys-calceph_8c.html#ab86ec03898e658c86c671a8b6399e331">novas_use_calceph_planets</a></div><div class="ttdeci">int novas_use_calceph_planets(t_calcephbin *eph)</div><div class="ttdef"><b>Definition</b> solsys-calceph.c:420</div></div>
</div><!-- fragment --><p>All modern JPL (SPK) ephemeris files should work with the <code>solsys-calceph</code> plugin. When linking your application, add <code>-lsolsys-calceph</code> to your link flags (or else link with <code>solsys-calceph.o</code>). That's all there is to it.</p>
<p><a class="anchor" id="cspice-integration"></a> </p>
<h3><a class="anchor" id="autotoc_md74"></a>
Optional NAIF CSPICE toolkit integration</h3>
<p>The <a href="https://naif.jpl.nasa.gov/naif/toolkit.html">NAIF CSPICE Toolkit</a> is the canonical standard library for JPL ephemeris files from C/C++. As of version 1.2, we provide optional support for interfacing SuperNOVAS with CSPICE for handling Solar-system objects.</p>
<p>Prior to building SuperNOVAS simply set <code>CSPICE_SUPPORT</code> to 1 in <code>config.mk</code> or in your environment. Depending on the build target, it will build <code>libsolsys-cspice.so[.1]</code> (target <code>shared</code>) or <code>libsolsys-cspice.a</code> (target <code>static</code>) libraries or <code>solsys-cspice.o</code> (target <code>solsys</code>), which provide the <code><a class="el" href="solsys-cspice_8c.html#a9b44218bca5fce1e9e5103494c15dde4">novas_use_cspice()</a></code>, <code><a class="el" href="solsys-cspice_8c.html#a943549e395b19f6a91064e3d6fa1c577">novas_use_cspice_planets()</a></code>, and <code><a class="el" href="solsys-cspice_8c.html#afb078e1df9b5b08999d24e68d7b4ecdc">novas_use_cspice_ephem()</a></code> functions to enable CSPICE for providing data for all Solar-system sources, or for major planets only, or for other bodies only, respectively. You can also manage the active kernels with the <code><a class="el" href="solsys-cspice_8c.html#ae02d26964099f56c375dc78172ad135b">cspice_add_kernel()</a></code> and <code><a class="el" href="solsys-cspice_8c.html#a38e3b3155cad3b3822fbc3e553060ab1">cspice_remove_kernel()</a></code> functions.</p>
<p>Of course, you will need access to the CSPICE development files (C headers, installed under a <code>cspice/</code> directory of an header search location, and the unversioned <code>libcspice.so</code> or <code>.a</code> library) for the build to succeed. You may want to check out the <a href="https://github.com/Smithsonian/cspice-sharedlib">Smithsonian/cspice-sharedlib</a> GitHub repository to help you build CSPICE with shared libraries and dynamically linked tools.</p>
<p>Here is an example on how you might use CSPICE with SuperNOVAS in your application code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas_8h.html">novas.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="novas-cspice_8h.html">novas-cspice.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can load the desired kernels for CSPICE</span></div>
<div class="line"><span class="comment">// E.g. load DE440s and the Mars satellites from /data/ephem:</span></div>
<div class="line"><span class="keywordtype">int</span> status;</div>
<div class="line"> </div>
<div class="line">status = <a class="code hl_function" href="solsys-cspice_8c.html#ae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a>(<span class="stringliteral">&quot;/data/ephem/de440s.bsp&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(status &lt; 0) {</div>
<div class="line">  <span class="comment">// oops, the kernels must not have loaded...</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load additional kernels as needed...</span></div>
<div class="line">status = <a class="code hl_function" href="solsys-cspice_8c.html#ae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a>(<span class="stringliteral">&quot;/data/ephem/mar097.bsp&quot;</span>);</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Then use CSPICE as your SuperNOVAS ephemeris provider</span></div>
<div class="line">novas_use_cspice();</div>
<div class="ttc" id="anovas-cspice_8h_html"><div class="ttname"><a href="novas-cspice_8h.html">novas-cspice.h</a></div></div>
<div class="ttc" id="asolsys-cspice_8c_html_ae02d26964099f56c375dc78172ad135b"><div class="ttname"><a href="solsys-cspice_8c.html#ae02d26964099f56c375dc78172ad135b">cspice_add_kernel</a></div><div class="ttdeci">int cspice_add_kernel(const char *filename)</div><div class="ttdef"><b>Definition</b> solsys-cspice.c:127</div></div>
</div><!-- fragment --><p>All JPL ephemeris data will work with the <code>solsys-cspice</code> plugin. When linking your application, add <code>-lsolsys-cspice</code> to your link flags (or else link with <code>solsys-cspice.o</code>). That's all there is to it.</p>
<p><a class="anchor" id="universal-ephemerides"></a> </p>
<h3><a class="anchor" id="autotoc_md75"></a>
Universal ephemeris data / service integration</h3>
<p>Possibly the most universal way to integrate ephemeris data with SuperNOVAS is to write your own <code>novas_ephem_provider</code>, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_ephem_reader(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, <span class="keywordtype">double</span> jd_tdb_high, <span class="keywordtype">double</span> jd_tdb_low, </div>
<div class="line">                    <span class="keyword">enum</span> <a class="code hl_enumeration" href="novas_8h.html#a208120c5fa3e12853eb37cb99d3e27be">novas_origin</a> *origin, <span class="keywordtype">double</span> *pos, <span class="keywordtype">double</span> *vel) {</div>
<div class="line">  <span class="comment">// Your custom ephemeris reader implementation here</span></div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>which takes an object ID number (such as a NAIF) an object name, and a split TDB date (for precision) as it inputs, and returns the type of origin with corresponding ICRS position and velocity vectors in the supplied pointer locations. The function can use either the ID number or the name to identify the object or file (whatever is the most appropriate for the implementation and for the supplied parameters). The positions and velocities may be returned either relative to the SSB or relative to the heliocenter, and accordingly, your function should set the value pointed at by origin to <code>NOVAS_BARYCENTER</code> or <code>NOVAS_HELIOCENTER</code> accordingly. Positions and velocities are rectangular ICRS <em>x,y,z</em> vectors in units of AU and AU/day respectively.</p>
<p>This way you can easily integrate current ephemeris data, e.g. for the Minor Planet Center (MPC), or whatever other ephemeris service you prefer.</p>
<p>Once you have your adapter function, you can set it as your ephemeris service via <code><a class="el" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider()</a></code>:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="novas_8c.html#a6097083c438a8d1872c2e00a66360030">set_ephem_provider</a>(my_ephem_reader);</div>
</div><!-- fragment --><p>By default, your custom <code>my_ephem_reader</code> function will be used for 'minor planets' only (i.e. anything other than the major planets, the Sun, Moon, Solar-system Barycenter...). But, you can use the same function for the mentioned 'major planets' also via:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(<a class="code hl_function" href="solsys-ephem_8c.html#a61c60adf57c00d797fac94bb5841c271">planet_ephem_provider</a>);</div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(<a class="code hl_function" href="solsys-ephem_8c.html#ae19eb2bcaaa2deb9fe27fba8090724e1">planet_ephem_provider_hp</a>);</div>
<div class="ttc" id="asolsys-ephem_8c_html_a61c60adf57c00d797fac94bb5841c271"><div class="ttname"><a href="solsys-ephem_8c.html#a61c60adf57c00d797fac94bb5841c271">planet_ephem_provider</a></div><div class="ttdeci">short planet_ephem_provider(double jd_tdb, enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys-ephem.c:105</div></div>
<div class="ttc" id="asolsys-ephem_8c_html_ae19eb2bcaaa2deb9fe27fba8090724e1"><div class="ttname"><a href="solsys-ephem_8c.html#ae19eb2bcaaa2deb9fe27fba8090724e1">planet_ephem_provider_hp</a></div><div class="ttdeci">short planet_ephem_provider_hp(const double jd_tdb[2], enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys-ephem.c:46</div></div>
</div><!-- fragment --><p>provided you compiled SuperNOVAS with <code>BUILTIN_SOLSYS_EPHEM = 1</code> (in <code>config.mk</code>), or else you link your code against <code><a class="el" href="solsys-ephem_8c.html">solsys-ephem.c</a></code> explicitly. Easy-peasy.</p>
<p><a class="anchor" id="builtin-ephem-readers"></a> </p>
<h3><a class="anchor" id="autotoc_md76"></a>
Legacy support for (older) JPL major planet ephemerides</h3>
<p>If you only need support for major planets, you may be able to use one of the modules included with the distribution. The legacy NOVAS modules <code><a class="el" href="solsys1_8c.html">solsys1.c</a></code> and <code><a class="el" href="solsys2_8c.html">solsys2.c</a></code> provide built-in support to older JPL ephemerides (DE200 to DE421), either via the <code>eph_manager</code> interface of <code><a class="el" href="solsys1_8c.html">solsys1.c</a></code> or via the FORTRAN <code>pleph</code> interface with <code><a class="el" href="solsys2_8c.html">solsys2.c</a></code>.</p>
<h4><a class="anchor" id="autotoc_md77"></a>
Planets via &lt;tt&gt;eph_manager&lt;/tt&gt;</h4>
<p>To use the <code>eph_manager</code> interface for planet 1997 JPL planet ephemeris (DE200 through DE421), you must either build SuperNOVAS with <code>BUILTIN_SOLSYS1 = 1</code> in <code>config.mk</code>, or else link your application with <code><a class="el" href="solsys1_8c.html">solsys1.c</a></code> and <code><a class="el" href="eph__manager_8c.html">eph_manager.c</a></code> from SuperNOVAS explicitly. If you want <code>eph_manager</code> to be your default ephemeris provider (the old way) you might also want to set <code>DEFAULT_SOLSYS = 1</code> in <code>config.mk</code>. Otherwise, your application should set <code>eph_manager</code> as your planetary ephemeris provider at runtime via:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(<a class="code hl_function" href="solsys1_8c.html#a71d2bfef45818d56e359205c57db0694">planet_eph_manager</a>);</div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(<a class="code hl_function" href="solsys1_8c.html#acacfbde919107d0514da5c7d8508917b">planet_eph_manager_hp</a>);</div>
<div class="ttc" id="asolsys1_8c_html_a71d2bfef45818d56e359205c57db0694"><div class="ttname"><a href="solsys1_8c.html#a71d2bfef45818d56e359205c57db0694">planet_eph_manager</a></div><div class="ttdeci">short planet_eph_manager(double jd_tdb, enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys1.c:171</div></div>
<div class="ttc" id="asolsys1_8c_html_acacfbde919107d0514da5c7d8508917b"><div class="ttname"><a href="solsys1_8c.html#acacfbde919107d0514da5c7d8508917b">planet_eph_manager_hp</a></div><div class="ttdeci">short planet_eph_manager_hp(const double jd_tdb[2], enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys1.c:80</div></div>
</div><!-- fragment --><p>Either way, before you can use the ephemeris, you must also open the relevant ephemeris data file with <code><a class="el" href="eph__manager_8c.html#aabd581657809499fb433e4f9f56ace80">ephem_open()</a></code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> de_number;          <span class="comment">// The DE number, e.g. 405 for DE405</span></div>
<div class="line"><span class="keywordtype">double</span> from_jd, to_jd;  <span class="comment">// [day] Julian date range of the ephemeris data</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="eph__manager_8c.html#aabd581657809499fb433e4f9f56ace80">ephem_open</a>(<span class="stringliteral">&quot;path-to/de405.bsp&quot;</span>, &amp;from_jd, &amp;to_jd, &amp;de_number);</div>
<div class="ttc" id="aeph__manager_8c_html_aabd581657809499fb433e4f9f56ace80"><div class="ttname"><a href="eph__manager_8c.html#aabd581657809499fb433e4f9f56ace80">ephem_open</a></div><div class="ttdeci">short ephem_open(const char *ephem_name, double *jd_begin, double *jd_end, short *de_number)</div><div class="ttdef"><b>Definition</b> eph_manager.c:85</div></div>
</div><!-- fragment --><p>And, when you are done using the ephemeris file, you should close it with</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="eph__manager_8c.html#a333da81ba7453316e26f32f628fefc0e">ephem_close</a>();</div>
<div class="ttc" id="aeph__manager_8c_html_a333da81ba7453316e26f32f628fefc0e"><div class="ttname"><a href="eph__manager_8c.html#a333da81ba7453316e26f32f628fefc0e">ephem_close</a></div><div class="ttdeci">short ephem_close(void)</div><div class="ttdef"><b>Definition</b> eph_manager.c:224</div></div>
</div><!-- fragment --><p>Note, that at any given time <code>eph_manager</code> can have only one ephemeris data file opened. You cannot use it to retrieve data from multiple ephemeris input files at the same time. (But you can with CALCEPH or the CSPICE toolkit, either of which you can interface as discussed further above!)</p>
<p>That's all, except the warning that this method will not work with newer JPL ephemeris data, beyond DE421.</p>
<h4><a class="anchor" id="autotoc_md78"></a>
Planets via JPL's &lt;tt&gt;pleph&lt;/tt&gt; FORTRAN interface</h4>
<p>To interface eith the JPL PLEPH library (FORTRAN) for planet ephemerides, you must either build SuperNOVAS with <code>BUILTIN_SOLSYS2 = 1</code> in <code>config.mk</code>, or else link your application with <code><a class="el" href="solsys2_8c.html">solsys2.c</a></code> and your appropriately modified <code>jplint.f</code> (from the <code>examples</code> sub-directory) explicitly, together with the JPL PLEPH library. If you want this to be your default ephemeris provider (the old way) you might also want to set <code>DEFAULT_SOLSYS = 2</code> in <code>config.mk</code>. Otherwise, your application should set your planetary ephemeris provider at runtime via:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="novas_8c.html#a9904c454bc7148b42d0f927b82ea3973">set_planet_provider</a>(<a class="code hl_function" href="solsys2_8c.html#aceb7bc6823b1823d8a8360517ff58f29">planet_jplint</a>);</div>
<div class="line"><a class="code hl_function" href="novas_8c.html#a418f45a11ce7f92ba0ef817558415640">set_planet_provider_hp</a>(<a class="code hl_function" href="solsys2_8c.html#a399a5363ddf93d662886e6e4692d03ad">planet_jplint_hp</a>);</div>
<div class="ttc" id="asolsys2_8c_html_a399a5363ddf93d662886e6e4692d03ad"><div class="ttname"><a href="solsys2_8c.html#a399a5363ddf93d662886e6e4692d03ad">planet_jplint_hp</a></div><div class="ttdeci">short planet_jplint_hp(const double jd_tdb[2], enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys2.c:178</div></div>
<div class="ttc" id="asolsys2_8c_html_aceb7bc6823b1823d8a8360517ff58f29"><div class="ttname"><a href="solsys2_8c.html#aceb7bc6823b1823d8a8360517ff58f29">planet_jplint</a></div><div class="ttdeci">short planet_jplint(double jd_tdb, enum novas_planet body, enum novas_origin origin, double *position, double *velocity)</div><div class="ttdef"><b>Definition</b> solsys2.c:87</div></div>
</div><!-- fragment --><p>Integrating JPL ephemeris data this way can be arduous. You will need to compile and link FORTRAN with C (not the end of the world), but you may also have to modify <code>jplint.f</code> (providing the intermediate FORTRAN <code><a class="el" href="solsys2_8c.html#ab53652c0e203b166427464ee1691c236" title="Function prototype for the FORTRAN subroutine jplint in jplint.f.">jplint_()</a></code> / <code><a class="el" href="solsys2_8c.html#a14752a69e14c399d5ee82e83f22acf68" title="Function prototype for the FORTRAN subroutine jplihp in jplint.f.">jplihp_()</a></code> interfaces to <code>pleph_()</code>) to work with the version of <code>pleph.f</code> that you will be using. Unless you already have code that relies on this method, you are probably better off choosing one of the other ways for integrating planetary ephemeris data with SuperNOVAS.</p>
<p><a class="anchor" id="explicit-ephem-linking"></a> </p>
<h3><a class="anchor" id="autotoc_md79"></a>
Legacy linking of custom ephemeris functions</h3>
<p>Finally, if none of the above is appealing, and you are fond of the old ways, you may compile SuperNOVAS with the <code>DEFAULT_SOLSYS</code> option disabled (commented, removed, or else set to 0), and then link your own implementation of <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> and <code><a class="el" href="solsys-ephem_8c.html#a0243c2489c22860de898115aed8ffc87">solarsystem_hp()</a></code> calls with your application.</p>
<p>For Solar-system objects other than the major planets, you may also provide your own <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementation. (In this case you will want to set <code>DEFAULT_READEPH</code> in <code>config.mk</code> to specify your source code for that function before building the SuperNOVAS library, or else disable that option entirely (e.g. by commenting or removing it), and link your application explicitly with your <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementation.</p>
<p>The downside of this approach is that your SuperNOVAS library will not be usable without invariably providing a <code><a class="el" href="solsys-ephem_8c.html#a5e2d599b1dc7a0e87bfd29dbd6413398">solarsystem()</a></code> / <code><a class="el" href="solsys-ephem_8c.html#a0243c2489c22860de898115aed8ffc87">solarsystem_hp()</a></code> and/or <code><a class="el" href="solarsystem_8h.html#abb70fdad016c3a2ea45990eaa16b9245">readeph()</a></code> implementations for <em>every</em> application that you will want to use SuperNOVAS with. This is why the runtime configuration of the ephemeris provider functions is the best and most generic way to add your preferred implementations while also providing some minimum default implementations for <em>other users</em> of the library, who may not need <em>your</em> ephemeris service, or have no need for planet data beyond the approximate positions for the Earth and Sun.</p>
<hr  />
<p><a class="anchor" id="debug-support"></a> </p>
<h2><a class="anchor" id="autotoc_md81"></a>
Runtime debug support</h2>
<p>You can enable or disable debugging output to <code>stderr</code> with <code><a class="el" href="novas_8c.html#a5f35633b872751df4dacd2fb2cbe4ac3">novas_debug(enum novas_debug_mode)</a></code>, where the argument is one of the defined constants from <code><a class="el" href="novas_8h.html">novas.h</a></code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>novas_debug_mode</code> value   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_OFF</code>   </td><td class="markdownTableBodyNone">No debugging output (<em>default</em>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_ON</code>   </td><td class="markdownTableBodyNone">Prints error messages and traces to <code>stderr</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NOVAS_DEBUG_EXTRA</code>   </td><td class="markdownTableBodyNone">Same as above but with stricter error checking   </td></tr>
</table>
<p>The main difference between <code>NOVAS_DEBUG_ON</code> and <code>NOVAS_DEBUG_EXTRA</code> is that the latter will treat minor issues as errors also, while the former may ignore them. For example, <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> will return normally by default if it cannot calculate gravitational bending around massive planets in full accuracy mode. It is unlikely that this omission would significantly alter the result in most cases, except for some very specific ones when observing in a direction close to a major planet. Thus, with <code>NOVAS_DEBUG_ON</code>, <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> go about as usual even if the Jupiter's position is not known. However, <code>NOVAS_DEBUG_EXTRA</code> will not give it a free pass, and will make <code><a class="el" href="novas_8c.html#a263de1618d80fcc737984951fa97c5a3">place()</a></code> return an error (and print the trace) if it cannot properly account for gravitational bending around the major planets as it is expected to.</p>
<hr  />
<p><a class="anchor" id="release-schedule"></a> </p>
<h2><a class="anchor" id="autotoc_md83"></a>
Release schedule</h2>
<p>A predictable release schedule and process can help manage expectations and reduce stress on adopters and developers alike.</p>
<p>Releases of the library shall follow a quarterly release schedule. You may expect upcoming releases to be published around <b>February 1</b>, <b>May 1</b>, <b>August 1</b>, and/or <b>November 1</b> each year, on an as-needed basis. That means that if there are outstanding bugs, or new pull requests (PRs), you may expect a release that addresses these in the upcoming quarter. The dates are placeholders only, with no guarantee that a new release will actually be available every quarter. If nothing of note comes up, a potential release date may pass without a release being published.</p>
<p><em>Feature releases</em> (e.g. <b>1.x.0</b> version bumps) are provided at least 6 months apart, to reduce stress on adopters who may need/want to tweak their code to integrate these. Between feature releases, <em>bug fix releases</em> (without significant API changes) may be provided as needed to address issues. New features are generally reserved for the feature releases, although they may also be rolled out in bug-fix releases as long as they do not affect the existing API &ndash; in line with the desire to keep bug-fix releases fully backwards compatible with their parent versions.</p>
<p>In the weeks and month(s) preceding releases one or more <em>release candidates</em> (e.g. <code>1.0.1-rc3</code>) will be published temporarily on GitHub, under <a href="https://github.com/Smithsonian/SuperNOVAS/releases">Releases</a>, so that changes can be tested by adopters before the releases are finalized. Please use due diligence to test such release candidates with your code when they become available to avoid unexpected surprises when the finalized release is published. Release candidates are typically available for one week only before they are superseded either by another, or by the finalized release.</p>
<hr  />
<p> Copyright (C) 2024 Attila Kov√°cs </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
